<link rel="stylesheet" href="/plugins/server/mf_cloud/template/admin/css/mf-cloud.css">

<!-- =======内容区域======= -->
<div class="common_config">
  <com-config>
    <div class="t-card">
      <t-tabs v-model="tabs" @change="changeTab">
        <!-- 周期设置 -->
        <t-tab-panel value="duration" :label="lang.mf_duration">
          <div class="box limit-table">
            <div class="com-top">
              <p class="tit">{{lang.mf_duration}}<span class="cycle-tip"
                  v-if="isShowCycleTip">({{lang.empty_cycle_tip}})</span></p>
              <div class="right">
                <t-button class="add-btn" @click='changeRadio'>{{lang.cycle_ratio}}</t-button>
                <t-button class="add-btn" @click='addCycle' :disabled="isAgent">{{lang.add_cycle}}</t-button>
              </div>
            </div>
            <p class="s-tip" style="line-height: 1;margin-top: -10px;">{{lang.mf_tip30}}</p>
            <t-table row-key="id" :data="cycleData" size="medium" :columns="cycleColumns" :hover="hover"
              :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #price_factor="{row}">
                {{row.price_factor.toFixed(2)}}
              </template>
              <template #unit="{row}">
                <span v-if="row.num">{{row.num}}</span>{{lang[row.unit]}}
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span>
              </template>
              <template #ratio="{row}">
                <span>{{row.ratio || '--'}}</span>
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editCycle(row)"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('cycle',row)" :class="{'server-disabled': isAgent}"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
          </div>
        </t-tab-panel>
        <!-- 计算配置 -->
        <t-tab-panel value="calc" :label="lang.mf_calc">
          <div class="box limit-table" v-if="lang">
            <div class="com-top">
              <p class="tit">{{lang.cpu_config}}</p>
              <t-button class="add-btn" @click="addCalc('cpu')" :disabled="isAgent">{{lang.order_text53}}CPU</t-button>
            </div>
            <t-table row-key="id" :data="cpuList" size="medium" :columns="cpuColumns" :hover="hover"
              :loading="cpuLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #value="{row}">
                {{row.value}}
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span>
                <template v-if="row.duration">/{{row.duration}}</template>
                &nbsp;{{lang.rise}}
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editCalc(row, 'cpu')"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('c_cpu',row)" :class="{'server-disabled': isAgent}"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
            <div class="com-top" style="margin-top: 30px;">
              <p class="tit">
                {{lang.memory_config}}<template v-if="memoryType">-{{memoryType}}{{lang.mf_way}}</template>
              </p>
              <t-button class="add-btn" @click="addCalc('memory')"
                :disabled="isAgent">{{lang.order_text53}}{{lang.memory}}</t-button>
            </div>
            <t-table row-key="id" :data="memoryList" size="medium" :columns="calcMemeryColumns" :hover="hover"
              :loading="memoryLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #value="{row}">
                <template v-if="row.type === 'radio'">
                  {{row.value}}
                </template>
                <template v-else>
                  {{row.min_value}}-{{row.max_value}}
                </template>
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span><template
                  v-if="row.duration">/{{row.duration}}</template>
                &nbsp;{{lang.rise}}
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editCalc(row, 'memory')"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('memory',row)" :class="{'server-disabled': isAgent}"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
          </div>
        </t-tab-panel>
        <!-- 数据中心 -->
        <t-tab-panel value="data_center" :label="lang.data_center_config">
          <div class="box data-box">
            <div class="com-top">
              <p class="tit">{{lang.data_center}}</p>
              <div class="r-btn">
                <t-button class="add-btn" @click='handleGlobal' :disabled="isAgent"
                  v-if="hasFirewall && isFirewallProduct">{{lang.mf_tip49}}
                </t-button>
                <t-button class="add-btn" @click='addData' :disabled="isAgent">{{lang.invoice_btn6}}{{lang.data_center}}
                </t-button>
                <div class="add-btn line-btn" @click='addLine' :class="{'server-disabled': isAgent}">
                  {{lang.invoice_btn6}}{{lang.line}}
                </div>
              </div>
            </div>
            <t-table row-key="id" :data="dataList" size="medium" :columns="dataColumns" :hover="hover"
              :loading="dataLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #area="{row}">
                <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                  <t-icon name="edit-1" @click.native="editData(row)"></t-icon>
                </t-tooltip>
                {{row.area}}
              </template>
              <template #line="{row}">
                <template v-if="row.line.length > 0">
                  <div class="item line-item" v-for="(item,index) in row.line">
                    <span class="txt" :title="item.name">{{item.name}}</span>
                    <t-switch :custom-value="[0,1]" v-model="item.hidden" :label="[lang.mf_show, lang.mf_hide]"
                      @change="changeShowLine($event,item)" :disabled="isAgent">
                    </t-switch>
                  </div>
                </template>
                <span class="p12" v-else>--</span>
              </template>
              <template #gpu_name="{row}">
                <span>{{row.gpu_name || '--'}}</span>
                <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                  <t-icon name="edit-1" @click="editGpu(row)"></t-icon>
                </t-tooltip>
                <t-tooltip v-if="row.gpu_name" :content="lang.delete" :show-arrow="false" theme="light">
                  <t-icon name="delete" @click="delGpu(row)" :class="{'server-disabled': isAgent}"></t-icon>
                </t-tooltip>
              </template>
              <template #price="{row}">
                <template v-if="row.line.length > 0">
                  <div class="item" v-for="(item,index) in row.line">
                    {{currency_prefix}}{{item.price}}
                    <template v-if="item.duration">/{{item.duration}}</template>
                    {{lang.rise}}&nbsp;&nbsp;{{lang['mf_'+item.bill_type]}}
                  </div>
                </template>
                <span class="p12" v-else>--</span>
              </template>
              <template #op="{row}">
                <template v-if="row.line.length > 0">
                  <div class="com-opt item" v-for="(item,index) in row.line">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editLine(item)"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('c_line',item)"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
                <div v-else style="padding: 12px 24px;" class="com-opt">
                  <t-tooltip :content="`${lang.delete}${lang.data_center}`" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('data',row)" :class="{'server-disabled': isAgent}"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
            <div class="config-tip">
              <span class="notes">{{lang.mf_notes}}</span>
              <p class="notes-txt">
                {{lang.mf_tip6}}<br>
                {{lang.mf_tip7}}<br>
                {{lang.mf_tip8}}<br>
              </p>
            </div>
          </div>
        </t-tab-panel>
        <!-- 存储设置 -->
        <t-tab-panel value="store" :label="lang.mf_store">
          <div class="box store-box limit-table1">
            <p class="t-top">
              {{lang.mf_tip10}}<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{lang.mf_tip11}}<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{lang.mf_tip22}}
            </p>
            <!-- 系统盘 -->
            <div class="com-top">
              <p class="tit">
                {{lang.system_disk_config}}
                <template v-if="systemDisk.length >0">-{{lang['mf_'+systemDisk[0].type]}}{{lang.mf_way}}</template>
              </p>
              <t-button class="add-btn" @click="addCalc('system_disk')" :disabled="isAgent">
                {{lang.order_text53}}{{lang.system_disk_size}}
              </t-button>
            </div>
            <t-table row-key="id" :data="systemDisk" size="medium" :columns="systemDiskColumns" :hover="hover"
              :loading="systemLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #value="{row}">
                <template v-if="row.type === 'radio'">
                  {{row.value}}
                </template>
                <template v-else>
                  {{row.min_value}}-{{row.max_value}}
                </template>
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price * 1).toFixed(2)}}</span>&nbsp;{{lang.rise}}
              </template>
              <template #type="{row}">
                {{row.other_config.disk_type || lang.default}}
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-icon name="edit-1" @click="editCalc(row, 'system_disk')"></t-icon>
                  <t-icon name="delete" @click="comDel('system_disk',row)"
                    :class="{'server-disabled': isAgent}"></t-icon>
                </div>
              </template>
            </t-table>
            <!-- 数据盘 -->
            <div class="com-top" style="margin-top: 30px;">
              <p class="tit">
                {{lang.data_disk_config}}
                <template v-if="dataDisk.length > 0">-{{lang['mf_'+dataDisk[0].type]}}{{lang.mf_way}}</template>
              </p>
              <t-button class="add-btn" @click="addCalc('data_disk')"
                :disabled="isAgent">{{lang.order_text53}}{{lang.data_disk}}</t-button>
            </div>
            <t-table row-key="id" :data="dataDisk" size="medium" :columns="diskColumns" :hover="hover"
              :loading="dataLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #value="{row}">
                <template v-if="row.type === 'radio'">
                  {{row.value}}
                </template>
                <template v-else>
                  {{row.min_value}}-{{row.max_value}}
                </template>
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price * 1).toFixed(2)}}</span>&nbsp;{{lang.rise}}
              </template>
              <template #type="{row}">
                {{row.other_config.disk_type || lang.default}}
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-icon name="edit-1" @click="editCalc(row, 'data_disk')"></t-icon>
                  <t-icon name="delete" @click="comDel('data_disk',row)" :class="{'server-disabled': isAgent}"></t-icon>
                </div>
              </template>
            </t-table>

            <!-- 数据盘新购数量限制 -->
            <div class="disk-limit-box">
              <p class="item free-disk-box">
                <!-- 免费数据盘 -->
                <span>{{lang.free_data_disk}}</span>
                <t-switch :custom-value="[1,0]" v-model="otherForm.free_disk_switch" size="small"
                  @change="changeFreeDiskLimit($event,'switch')" :disabled="isAgent">
                </t-switch>
                <t-select v-model="otherForm.free_disk_type" :disabled="isAgent" @change="changeFreeDiskLimit"
                  :placeholder="lang.please_select_free_disk_type">
                  <t-option :key="item.value" :value="item.value" :label="item.name" v-for="item in dataDiskType">
                  </t-option>
                </t-select>
                <t-input-number v-model="otherForm.free_disk_size" :min="1" :max="1048576" theme="normal"
                  v-show="otherForm.free_disk_switch" class="freeSuffix" :decimal-places="0"
                  :placeholder="lang.free_data_tip" @blur="changeFreeDiskLimit($event,'num')" :disabled="isAgent">
                </t-input-number>
                <t-tooltip :content="lang.mf_tip35 + '\n' + lang.mf_tip36" :show-arrow="false" theme="light"
                  placement="top-left">
                  <t-icon name="help-circle"></t-icon>
                </t-tooltip>
              </p>
              <p class="item">
                <span>{{lang.disk_limit_num}}</span>
                <t-switch :custom-value="[1,0]" v-model="otherForm.disk_limit_switch" size="small"
                  @change="changeDiskLimit($event,'switch')" :disabled="isAgent"></t-switch>
                <t-input-number v-model="otherForm.disk_limit_num" :min="1" :max="16" theme="normal"
                  v-show="otherForm.disk_limit_switch" :decimal-places="0" :placeholder="lang.disk_limit_tip"
                  @blur="changeDiskLimit($event,'num')" :disabled="isAgent"></t-input-number>
              </p>

            </div>

            <!-- 性能限制 -->
            <p class="limit">
              <span>{{lang.disk_limit_enable}}</span>
              <t-switch :custom-value="[1,0]" :value="store_limit" size="small" @change="changeLimit"
                :disabled="isAgent">
              </t-switch>
              <span v-if="store_limit">{{lang.mf_tip20}}</span>
            </p>
            <div v-show="store_limit">
              <div class="com-top">
                <p class="tit">
                  {{lang.system_disk_nature}}<template v-if="systemType">-{{systemType}}{{lang.mf_way}}</template>
                </p>
                <t-button class="add-btn" @click="addCalc('system_disk_limit')" :disabled="isAgent">
                  {{lang.order_text53}}{{lang.disk_limit_enable}}
                </t-button>
              </div>
              <t-table row-key="id" :data="systemLimitList" size="medium" :columns="natureColumns" :hover="hover"
                :loading="systemLimitLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                :hide-sort-tips="true">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #capacity_size="{row}">
                  {{row.min_value}}-{{row.max_value}}
                </template>
                <template #price="{row}">
                  <span>{{currency_prefix}}{{row.price}}</span>&nbsp;{{lang.rise}}
                </template>
                <template #type="{row}">
                  {{row.other_config.disk_type}}
                </template>
                <template #op="{row}">
                  <div class="com-opt">
                    <t-icon name="edit-1" @click="editCalc(row, 'system_disk_limit')"></t-icon>
                    <t-icon name="delete" @click="comDel('system_disk_limit',row)"
                      :class="{'server-disabled': isAgent}"></t-icon>
                  </div>
                </template>
              </t-table>
              <div class="com-top" style="margin-top: 30px;">
                <p class="tit">
                  {{lang.data_disk_nature}}<template v-if="systemType">-{{systemType}}{{lang.mf_way}}</template>
                </p>
                <t-button class="add-btn" @click="addCalc('data_disk_limit')" :disabled="isAgent">
                  {{lang.order_text53}}{{lang.disk_limit_enable}}
                </t-button>
              </div>
              <t-table row-key="id" :data="diskLimitList" size="medium" :columns="natureColumns" :hover="hover"
                :loading="diskLimitLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                :hide-sort-tips="true">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #capacity_size="{row}">
                  {{row.min_value}}-{{row.max_value}}
                </template>
                <template #price="{row}">
                  <span>{{currency_prefix}}{{row.price}}</span>&nbsp;{{lang.rise}}
                </template>
                <template #type="{row}">
                  {{row.other_config.disk_type}}
                </template>
                <template #op="{row}">
                  <div class="com-opt">
                    <t-icon name="edit-1" @click="editCalc(row, 'data_disk_limit')"></t-icon>
                    <t-icon name="delete" @click="comDel('data_disk_limit',row)"
                      :class="{'server-disabled': isAgent}"></t-icon>
                  </div>
                </template>
              </t-table>
            </div>
          </div>
        </t-tab-panel>
        <!-- 配置限制 -->
        <t-tab-panel value="limit" :label="lang.advanced_rules">
          <div class="box limit-box">
            <div class="com-top">
              <t-button class="add-btn" @click="addLimit"
                :disabled="isAgent">{{lang.order_text53}}{{lang.mf_rule}}</t-button>
              <span class="limit-tip">
                <img :src="`/plugins/server/mf_cloud/template/admin/img/warning.svg`" alt="">
                {{lang.mf_tip19}}
              </span>
            </div>
            <div class="limit-item">
              <t-table row-key="id" :data="limitData" size="medium" :columns="limitColumns" :hover="hover"
                :loading="limitLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                :hide-sort-tips="true" class="config-table">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #rule="{row}">
                  <p v-for="(item,index) in calcLimitRules(row.rule)" :key="index" class="rule-item">
                    {{calcLimitName(item[0])}}
                    <span v-show="item[1].opt === 'neq'" class="red">{{lang.mf_neq}}</span>：
                    <span v-if="item[0] === 'cpu'">
                      <span v-for="(sub,sInd) in item[1].value" :key="sInd">
                        <span v-show="sInd !== 0">，</span>{{sub}}{{lang.cores}}
                      </span>
                    </span>
                    <span v-if="item[0] === 'memory'">
                      <template v-if="item[1].max">
                        {{item[1].min}}{{memory_unit}}~{{item[1].max ? item[1].max + memory_unit :
                        lang.mf_limitless}}
                      </template>
                      <template v-else>
                        <span v-for="(sub,sInd) in item[1].value" :key="sInd">
                          <span v-show="sInd !== 0">，</span>{{sub}}{{memory_unit}}
                        </span>
                      </template>
                    </span>
                    <span v-if="item[0] === 'data_center' || item[0] === 'image'">
                      <span v-for="(sub,sInd) in item[1].name" :key="sInd">
                        <span v-show="sInd !== 0">，</span>{{sub}}
                      </span>
                    </span>
                  </p>
                </template>
                <template #result="{row}">
                  <p v-for="(item,index) in calcLimitRules(row.result)" :key="index" class="rule-item">
                    {{calcLimitName(item[0])}}
                    <span v-show="item[1][0].opt === 'neq'" class="red">{{lang.mf_neq}}</span>：
                    <template v-if="item[0] === 'cpu'">
                      <span v-for="(sub,sInd) in item[1]" :key="sInd">
                        <span v-for="(el, val) in sub.value" :key="val">
                          <span v-show="val !== 0">，</span>{{el}}{{lang.cores}}
                        </span>；
                      </span>
                    </template>
                    <span v-if="item[0] === 'memory'">
                      <span v-for="(sub,sInd) in item[1]" :key="sInd">
                        <template v-if="memoryList[0]?.type !== 'radio'">
                          {{sub.min}}{{memory_unit}}~{{sub.max ? sub.max + memory_unit : lang.mf_limitless}}；
                        </template>
                        <template v-else>
                          <span v-for="(el, val) in sub.value" :key="val">
                            <span v-show="val !== 0">，</span>{{el}}{{memory_unit}}
                          </span>；
                        </template>
                      </span>
                    </span>
                    <span v-if="item[0] === 'image'">
                      <span v-for="(sub,sInd) in item[1]" :key="sInd">
                        <span v-for="(el, val) in sub.name" :key="val">
                          <span v-show="val !== 0">，</span>{{el}}
                        </span>；
                      </span>
                    </span>
                    <span v-if="item[0] === 'system_disk'">
                      <span v-for="(sub,sInd) in item[1]" :key="sInd">
                        {{sub.min}}GB~{{sub.max ? sub.max + 'GB' : lang.mf_limitless}}；
                      </span>
                    </span>
                  </p>
                </template>
                <template #op="{row}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.mf_copy" :show-arrow="false" theme="light">
                      <t-icon name="file-copy" size="18px" @click="editLimit(row, 'copy')" class="common-look"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit" class="common-look" @click="editLimit(row, 'update')"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" class="common-look" @click="comDel('limit',row)"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
            </div>
          </div>
        </t-tab-panel>
        <!-- 操作系统 -->
        <t-tab-panel value="system" :label="lang.opt_system">
          <div class="box">
            <div class="top-opt">
              <div class="item">
                <t-select v-model="systemParams.image_group_id" class="select"
                  :placeholder="`${lang.select}${lang.system_classify}`" clearable>
                  <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in systemGroup">
                  </t-option>
                </t-select>
                <t-input v-model="systemParams.keywords" class="ml_10" clearable
                  :placeholder="`${lang.input}${lang.system_name}`" @clear="clearKey"
                  @keypress.enter.native="getSystemList"></t-input>
                <t-button class="ml_10" @click="getSystemList">{{lang.search}}</t-button>
              </div>
              <div class="item">
                <t-button @click="classManage" :disabled="isAgent">{{lang.news_classific}}{{lang.manage}}</t-button>
                <t-button @click="handelPullOs('net')" theme="default" class="ml_10" :disabled="isAgent">
                  {{lang.get_system}}
                </t-button>
                <t-button @click="handelPullOs('local')" theme="default" class="ml_10" :disabled="isAgent">
                  {{lang.get_local_system}}
                </t-button>
                <div class="add-system ml_10" @click="createNewSys" :class="{'server-disabled': isAgent}">
                  {{lang.add}}{{lang.system}}
                </div>
              </div>
            </div>
            <!-- 批量删除 -->
            <div class="top-opt">
              <t-button @click="deleteBatch" :disabled="isAgent">{{lang.batch_delete}}</t-button>
            </div>
            <t-table row-key="id" :data="systemList" size="medium" :columns="systemColumns" :hover="hover"
              :loading="loading" table-layout="auto" display-type="fixed-width" :hide-sort-tips="true"
              drag-sort="row-handler" @drag-sort="onDragSort" :selected-row-keys="selectedRowKeys"
              @select-change="rehandleSelectChange">
              <template #drag="{row}">
                <t-icon name="move" style="cursor: move;"></t-icon>
              </template>
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #image_group_name="{row}">
                <span class="class-name">
                  <img :src="`/plugins/server/mf_cloud/template/admin/img/${row.icon}.svg`" alt="" class="icon">
                  {{row.image_group_name}}
                </span>
              </template>
              <template #charge="{row}">
                <t-switch size="small" :custom-value="[1,0]" v-model="row.charge" @change="changeSystemStatus(row)"
                  :disabled="isAgent">
                </t-switch>
              </template>
              <template #price="{row}">
                {{currency_prefix}}&nbsp;{{row.price}}
              </template>
              <template #enable="{row}">
                <t-switch size="small" :custom-value="[1,0]" v-model="row.enable" :disabled="isAgent"
                  @change="changeSystemStatus(row)">
                </t-switch>
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-icon name="edit-1" @click="editSystem(row)"></t-icon>
                  <t-icon name="delete" @click="comDel('system',row)" :class="{'server-disabled': isAgent}"></t-icon>
                </div>
              </template>
            </t-table>
          </div>
        </t-tab-panel>
        <!-- 套餐配置 -->
        <t-tab-panel value="recommend" :label="lang.package_config">
          <div class="box">
            <div class="com-top">
              <p class="tit">
                {{lang.package_config}}
              </p>
              <div class="right">
                <t-button class="add-btn" @click="handlerRange">{{lang.upgrade_range}}</t-button>
                <t-button class="add-btn" @click="addRecommend" :disabled="isAgent">{{lang.order_text53}}</t-button>
              </div>
            </div>
            <t-table row-key="id" :data="recommendList" size="medium" :columns="calcModelColumns" :hover="hover"
              :loading="dataLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #value="{row}">
                <template v-if="row.type === 'radio'">
                  {{row.value}}
                </template>
                <template v-else>
                  {{row.min_value}}-{{row.max_value}}
                </template>
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span>
                <template v-if="row.duration">/{{row.duration}}</template>
                &nbsp;{{lang.rise}}
              </template>
              <template #hidden="{row}">
                <t-switch size="medium" :custom-value="[0,1]" v-model="row.hidden" :disabled="isAgent"
                  @change="onChange(row)"></t-switch>
              </template>
              <template #ontrial="{row}">
                <t-switch size="medium" :custom-value="[1,0]" :disabled="isAgent" v-model="row.ontrial"
                  @change="ontrialChange(row)"></t-switch>
              </template>
              <template #ontrial_price="{row}">
                <span v-if="row.ontrial === 1">{{currency_prefix}}{{(row.ontrial_price*1).toFixed(2)}}</span>
                <span v-else>--</span>
              </template>
              <template #ontrial_qty="{row}">
                <span v-if="row.ontrial === 1 && row.ontrial_stock_control === 1">{{row.ontrial_qty}}</span>
                <span v-else>--</span>
              </template>
              <template #upgrade_show="{row}">
                <t-switch size="medium" :custom-value="[1,0]" v-model="row.upgrade_show" @change="onChangeUpgrade(row)"
                  :disabled="isAgent"></t-switch>
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editRecommend(row)"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('recommend',row)"
                      :class="{'server-disabled': isAgent}"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
            <div class="bot-tip">
              <p>
                {{lang.mf_package_tip8}}
                <t-switch :custom-value="[1,0]" v-model="otherForm.no_upgrade_tip_show" size="small"
                  @change="changeUpgradeTip" :disabled="isAgent"></t-switch>
              </p>
              <p>
                {{lang.mf_only_package}}
                <t-switch :custom-value="[1,0]" v-model="otherForm.only_sale_recommend_config" size="small"
                  @change="changeOnlyPackage" :disabled="isAgent"></t-switch>
                <span class="s-tip">{{lang.mf_package_tip1}}</span>
              </p>
              <p class="s-tip">{{lang.mf_package_tip2}}</p>
            </div>
          </div>
        </t-tab-panel>
        <!-- 试用设置 -->
        <t-tab-panel value="ontrial" :label="lang.ontrial_text1" v-if="!isAgent">
          <div class="box ontrial-box">
            <t-form label-width="160px" label-align="left" :data="payOntrialForm" ref="payOntrialRef"
              @submit="submitOntral" :rules="ontralRules" class="ontrial-form">
              <div class="ontrial-open">
                <span>{{lang.ontrial_text4}}</span>
                <t-switch :custom-value="[1,0]" v-model="payOntrialForm.status"
                  :label="[lang.ontrial_text2,lang.ontrial_text3]">
                </t-switch>
              </div>
              <template v-if="payOntrialForm.status === 1">
                <t-form-item :label="lang.ontrial_text5">
                  <t-form-item label=" " label-width="0px" style="margin-right: 0;">
                    <t-input-number style="width: 120px;" v-model="payOntrialForm.cycle_num" name="cycle_num"
                      :placeholder="lang.ontrial_text5" theme="normal" :min="0" :decimal-places="0">
                    </t-input-number>
                  </t-form-item>
                  <t-form-item label=" " label-width="0px">
                    <t-select v-model="payOntrialForm.cycle_type">
                      <t-option :value="item.value" :label="item.label" v-for="(item,index) in cycleTypeOptions"
                        :key="item.value">
                      </t-option>
                    </t-select>
                  </t-form-item>
                </t-form-item>
                <t-form-item :label="lang.ontrial_text6">
                  <t-radio-group v-model="payOntrialForm.client_limit">
                    <t-radio :value="item.value" v-for="item in clientLimitOptions"
                      :key="item.value">{{item.label}}</t-radio>
                  </t-radio-group>
                </t-form-item>
                <t-form-item :label="lang.ontrial_text13" :help="lang.ontrial_text14">
                  <t-checkbox-group v-model="payOntrialForm.account_limit">
                    <t-checkbox :value="item.value" v-for="item in accountLimitOptions"
                      :key="item.value">{{item.label}}</t-checkbox>
                  </t-checkbox-group>
                </t-form-item>
                <t-form-item :label="lang.ontrial_text15" :help="lang.ontrial_text16">
                  <com-tree-select @choosepro="chooseDelPro" :multiple="true" style="width: 360px;"
                    :value="payOntrialForm.old_client_exclusive">
                  </com-tree-select>
                </t-form-item>
                <t-form-item :label="lang.ontrial_text17">
                  <t-input-number v-model="payOntrialForm.max" name="max" style="width: 200px;"
                    :placeholder="lang.ontrial_text17" theme="normal" :min="0" :decimal-places="0"
                    :suffix="lang.ontrial_text18">
                  </t-input-number>
                </t-form-item>
              </template>
              <t-form-item label=" " label-width="0px">
                <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                </t-button>
              </t-form-item>
            </t-form>
          </div>
        </t-tab-panel>
        <!-- 其他设置 -->
        <t-tab-panel value="other" :label="lang.other_setting">
          <div class="box other-box">
            <t-form :data="otherForm" ref="otherConfig" @submit="submitConfig" :rules="dataRules" class="other-form">
              <!-- 选择版本 -->
              <t-form-item :label="`${lang.confirm}${lang.version}`" label-align="top">
                <t-select v-model="otherForm.type" :disabled="isAgent">
                  <t-option :value="item.value" :label="item.label" v-for="(item,index) in versionArr"
                    :key="index"></t-option>
                </t-select>
              </t-form-item>
              <t-form-item label="">
                <t-checkbox v-model="otherForm.manual_manage"
                  :disabled="isAgent">{{lang.manual_manage_product}}</t-checkbox>
                <t-tooltip :content="lang.manual_manage_product_tip" :show-arrow="false" theme="light"
                  placement="top-left">
                  <t-icon name="help-circle"></t-icon>
                </t-tooltip>
              </t-form-item>
              <!-- <t-form-item :label="lang.mf_tip5" label-align="top" v-if="otherForm.type !== 'hyperv'">
                <t-input v-model="otherForm.ipv6_num" :placeholder="lang.mf_tip5"></t-input>
              </t-form-item> -->
              <template v-if="otherForm.type !== 'hyperv'">
                <t-form-item :label="`NAT${lang.forward}`" label-align="top">
                  <t-input v-model="otherForm.nat_acl_limit" :disabled="isAgent"
                    :placeholder="`NAT${lang.forward}`"></t-input>
                </t-form-item>
                <t-form-item label="">
                  <t-checkbox v-model="otherForm.default_nat_acl"
                    :disabled="isAgent">{{lang.default_nat_acl}}</t-checkbox>
                  <span class="s-tip">{{lang.default_nat_acl_tip}}</span>
                </t-form-item>
                <t-form-item :label="lang.nat_web" label-align="top">
                  <t-input v-model="otherForm.nat_web_limit" :disabled="isAgent" :placeholder="lang.nat_web"></t-input>
                </t-form-item>
                <t-form-item label="">
                  <t-checkbox v-model="otherForm.default_nat_web"
                    :disabled="isAgent">{{lang.default_nat_web}}</t-checkbox>
                  <span class="s-tip">{{lang.default_nat_web_tip}}</span>
                </t-form-item>
                <t-form-item :label="lang.niccard" label-align="top">
                  <t-select v-model="otherForm.niccard" :disabled="isAgent">
                    <t-option :value="0" :label="lang.default" :key="0"></t-option>
                    <t-option :value="1" label="Realtek 8139" :key="1"></t-option>
                    <t-option :value="2" label="Intel PRO/1000" :key="2"></t-option>
                    <t-option :value="3" label="Virtio" :key="3"></t-option>
                  </t-select>
                </t-form-item>
                <t-form-item :label="lang.cpu_model" label-align="top">
                  <t-select v-model="otherForm.cpu_model" :disabled="isAgent">
                    <t-option :value="0" :label="lang.default" :key="0"></t-option>
                    <t-option :value="1" label="host-passthrough" :key="1"></t-option>
                    <t-option :value="2" label="host-model" :key="2"></t-option>
                    <t-option :value="3" label="custom" :key="3"></t-option>
                  </t-select>
                </t-form-item>
                <t-form-item :label="lang.enable_rules" label-align="top" style="width:250px;">
                  <t-select v-model="otherForm.node_priority" :disabled="isAgent">
                    <t-option v-for="item in rulesList" :value="item.value" :label="item.label" :key="item.value">
                    </t-option>
                  </t-select>
                </t-form-item>
                <t-form-item :label="lang.mf_tip48" label-align="top">
                  <t-select v-model="otherForm.duration_id" :disabled="isAgent" multiple clearable
                    :min-collapsed-num="1">
                    <t-option v-for="item in cycleData" :value="item.id" :label="item.name" :key="item.id">
                    </t-option>
                  </t-select>
                </t-form-item>
                <t-form-item :label="lang.virtualization">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.ip_mac_bind" size="small" :disabled="isAgent">
                  </t-switch>
                  <t-tooltip :content="lang.mf_tip34" :show-arrow="false" theme="light" placement="top-left">
                    <t-icon name="help-circle"></t-icon>
                  </t-tooltip>
                </t-form-item>
                <t-form-item :label="lang.default_ipv4">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.default_one_ipv4" size="small" :disabled="isAgent">
                  </t-switch>
                  <t-tooltip :content="lang.default_ipv4_tip" :show-arrow="false" theme="light" placement="top-left">
                    <t-icon name="help-circle"></t-icon>
                  </t-tooltip>
                </t-form-item>
                <t-form-item :label="lang.allow_ssh">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.support_ssh_key" size="small" :disabled="isAgent">
                  </t-switch>
                  <t-tooltip :content="lang.ssh_tip" :show-arrow="false" theme="light" placement="top-left">
                    <t-icon name="help-circle"></t-icon>
                  </t-tooltip>
                </t-form-item>
              </template>
              <!-- ssh端口 -->
              <t-form-item label-align="top" class="ssh-port">
                <template #label>
                  {{lang.ssh_port_config}}
                  <t-popup attach="#sshPop">
                    <div id="sshPop">
                      <t-icon name="help-circle" id="sshPop"></t-icon>
                    </div>
                    <template #content>
                      <div class="pop-item">
                        <p class="txt">{{lang.default}}：</p>
                        <p class="txt">Windows 3389/Linux 22</p>
                      </div>
                      <div class="pop-item">
                        <p class="txt">{{lang.random_port}}：</p>
                        <p class="txt">{{lang.random_port_tip1}}</p>
                        <p class="txt">{{lang.random_port_tip2}}</p>
                      </div>
                      <div class="pop-item">
                        <p class="txt">{{lang.specify_port}}：</p>
                        <p class="txt">{{lang.specify_port_tip1}}</p>
                      </div>
                    </template>
                  </t-popup>
                </template>
                <div class="radio-group">
                  <t-radio-group v-model="otherForm.rand_ssh_port" :disabled="isAgent">
                    <t-radio :value="0">{{lang.default}}</t-radio>
                    <t-radio :value="1">{{lang.random_port}}</t-radio>
                    <t-radio :value="2">{{lang.specify_port}}</t-radio>
                  </t-radio-group>
                </div>
                <!-- 随机范围 -->
                <div class="port-box" v-if="otherForm.rand_ssh_port === 1">
                  <p class="item">
                    <span class="txt">{{lang.random_range}}</span>
                    <t-form-item label="" :required-mark="false" name="rand_ssh_port_start">
                      <t-input-number v-model="otherForm.rand_ssh_port_start" :placeholder="lang.start_port"
                        theme="normal" :min="100" :max="65534" :decimal-places="0"
                        @blur="changeNum($event, 100, 65534, 'rand_ssh_port_start')" :disabled="isAgent">
                      </t-input-number>
                    </t-form-item>
                  </p>
                  <p class="item">
                    <span class="txt"></span>
                    <t-form-item label="" :required-mark="false" name="rand_ssh_port_end">
                      <t-input-number v-model="otherForm.rand_ssh_port_end" :placeholder="lang.end_port" theme="normal"
                        :min="101" :max="65535" :decimal-places="0" :disabled="isAgent"
                        @blur="changeNum($event, 101, 65535, 'rand_ssh_port_end')">
                      </t-input-number>
                    </t-form-item>
                  </p>
                </div>
                <!-- 指定端口 -->
                <div class="port-box" v-if="otherForm.rand_ssh_port === 2">
                  <p class="item">
                    <span class="txt">Windows</span>
                    <t-form-item label="" :required-mark="false" name="rand_ssh_port_windows">
                      <t-input-number v-model="otherForm.rand_ssh_port_windows" theme="normal" :min="1" :max="65535"
                        :decimal-places="0" @blur="changePort($event, 'rand_ssh_port_windows')"
                        :disabled="isAgent"></t-input-number>
                    </t-form-item>
                  </p>
                  <p class="item">
                    <span class="txt">Linux</span>
                    <t-form-item label="" :required-mark="false" name="rand_ssh_port_linux">
                      <t-input-number v-model="otherForm.rand_ssh_port_linux" theme="normal" :min="1" :max="65535"
                        :decimal-places="0" @blur="changePort($event, 'rand_ssh_port_linux')"
                        :disabled="isAgent"></t-input-number>
                    </t-form-item>
                  </p>
                </div>
              </t-form-item>

              <t-form-item :label="lang.is_need_code1">
                <t-switch :custom-value="[1,0]" v-model="otherForm.reset_password_sms_verify" size="small">
                </t-switch>
              </t-form-item>
              <t-form-item :label="lang.is_need_code2">
                <t-switch :custom-value="[1,0]" v-model="otherForm.reinstall_sms_verify" size="small">
                </t-switch>
              </t-form-item>
              <t-form-item :label="lang.net_type" v-if="otherForm.type === 'host'">
                <div class="net_type">
                  <div class="check">
                    <t-checkbox v-model="otherForm.support_normal_network"
                      :disabled="isAgent">{{lang.normal_network}}</t-checkbox>
                  </div>
                  <div class="check">
                    <t-checkbox v-model="otherForm.support_vpc_network"
                      :disabled="isAgent">{{lang.vpc_network}}</t-checkbox>
                    <div v-if="otherForm.support_vpc_network" class="public_ip">
                      <t-switch :custom-value="[1,0]" v-model="otherForm.support_public_ip" size="small" disabled>
                      </t-switch>
                      {{lang.support_public_ip}}
                    </div>
                  </div>
                </div>
              </t-form-item>
              <!-- 备份管理 -->
              <t-form-item :label="lang.backup_manage">
                <t-switch :custom-value="[1,0]" v-model="otherForm.backup_enable" size="small" :disabled="isAgent">
                </t-switch>
                <!-- <t-tooltip :content="lang.backup_tip" :show-arrow="false" theme="light" placement="top-left">
                  <t-icon name="help-circle"></t-icon>
                </t-tooltip> -->
              </t-form-item>
              <t-table row-key="id" :data="backList" size="medium" :columns="backupColumns" :hover="hover"
                :loading="backLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                :hide-sort-tips="true" class="back-table" bordered :loading="backLoading"
                v-show="otherForm.backup_enable" style="margin-bottom: 40px;">
                <template #num="{row}">
                  <t-input-number v-model="row.num" theme="column" :min="1" :max="999" style="width: 88px" auto
                    :disabled="!row.status">
                  </t-input-number>
                </template>
                <template #id="{row,rowIndex}">
                  {{rowIndex + 1}}
                </template>
                <template #price="{row,rowIndex}">
                  <t-input-number v-model="row.price" theme="column" :min="0" :step="1.00" :decimal-places="2"
                    :disabled="!row.status" :label="currency_prefix" style="width: 120px;">
                  </t-input-number>
                  <template v-if="!isAgent">
                    <div class="com-icon" v-if="rowIndex === backList.length-1 && backList.length < 5"
                      @click="addGroup('backup')">
                      <t-icon name="add"></t-icon>
                    </div>
                    <template v-if="row.status">
                      <div class="com-icon" @click="closeEdit(row,rowIndex, 'backup')"
                        v-if="!(rowIndex === 0 && !row.id)">
                        <t-icon name="close"></t-icon>
                      </div>
                    </template>
                    <template v-else>
                      <div class="com-icon" @click="openEdit('backup',rowIndex)">
                        <t-icon name="edit"></t-icon>
                      </div>
                      <!--  v-if="rowIndex !== 0" -->
                      <div class="com-icon" @click="deleteBackup('backup',rowIndex)" v-if="rowIndex !== 0">
                        <t-icon name="remove"></t-icon>
                      </div>
                    </template>
                  </template>
                </template>
                <template #available="{row}">
                  <t-switch :custom-value="[1,0]" v-model="row.enable" @click.native="changeSwitch(row)">
                  </t-switch>
                </template>
              </t-table>
              <!-- 快照管理管理 -->
              <template v-if="otherForm.type !== 'hyperv'">
                <t-form-item :label="lang.snap_manage">
                  <t-switch :custom-value="[1,0]" v-model="otherForm.snap_enable" size="small" :disabled="isAgent">
                  </t-switch>
                  <!-- <t-tooltip :content="lang.snap_tip" :show-arrow="false" theme="light" placement="top-left">
                    <t-icon name="help-circle"></t-icon>
                  </t-tooltip> -->
                </t-form-item>
                <t-table row-key="id" :data="snapList" size="medium" :columns="backupColumns" :hover="hover"
                  :loading="snapLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                  :hide-sort-tips="true" class="back-table" bordered v-show="otherForm.snap_enable"
                  style="margin-bottom: 40px;">
                  <template #num="{row}">
                    <t-input-number v-model="row.num" theme="column" :min="1" :max="999" style="width: 88px"
                      :disabled="!row.status">
                    </t-input-number>
                  </template>
                  <template #id="{row,rowIndex}">
                    {{rowIndex + 1}}
                  </template>
                  <template #price="{row,rowIndex}">
                    <t-input-number v-model="row.price" theme="column" :min="0" :step="1.00" :decimal-places="2"
                      style="width: 120px;" :disabled="!row.status" :label="currency_prefix">
                    </t-input-number>
                    <template v-if="!isAgent">
                      <div class="com-icon" v-if="rowIndex === snapList.length-1 && snapList.length < 5"
                        @click="addGroup('snap')">
                        <t-icon name="add"></t-icon>
                      </div>
                      <template v-if="row.status">
                        <div class="com-icon" @click="closeEdit(row,rowIndex, 'snap')"
                          v-if="!(rowIndex === 0 && !row.id)">
                          <t-icon name="close"></t-icon>
                        </div>
                      </template>
                      <template v-else>
                        <div class="com-icon" @click="openEdit('snap',rowIndex)">
                          <t-icon name="edit"></t-icon>
                        </div>
                        <div class="com-icon" @click="deleteBackup('snap',rowIndex)" v-if="rowIndex !== 0">
                          <t-icon name="remove"></t-icon>
                        </div>
                      </template>
                    </template>
                  </template>
                  <template #available="{row}">
                    <t-switch :custom-value="[1,0]" v-model="row.enable" @click.native="changeSwitch(row)">
                    </t-switch>
                  </template>
                </t-table>
              </template>

              <!-- 资源包 -->
              <template v-if="otherForm.is_agent">
                <t-form-item :label="lang.agent_docking">
                </t-form-item>
                <div class="resource-add" v-if="resourceList.length === 0 " @click="addResourece">
                  <t-icon name="add"></t-icon>
                </div>
                <t-table row-key="id" :data="resourceList" size="medium" :columns="resourceColumns" :hover="hover"
                  :loading="snapLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                  :hide-sort-tips="true" class="back-table" bordered style="margin-bottom: 40px;" v-else>
                  <template #rid="{row}">
                    <t-input v-model="row.rid" :disabled="!row.status">
                    </t-input>
                  </template>
                  <template #id="{row,rowIndex}">
                    {{rowIndex + 1}}
                  </template>
                  <template #name="{row,rowIndex}">
                    <t-input v-model="row.name" :disabled="!row.status">
                    </t-input>
                    <template v-if="row.status">
                      <div class="com-icon" @click="closeEdit(row,rowIndex, 'resource')">
                        <t-icon name="close"></t-icon>
                      </div>
                    </template>
                    <template v-else>
                      <div class="com-icon" @click="openEdit('resource',rowIndex)">
                        <t-icon name="edit"></t-icon>
                      </div>
                      <div class="com-icon" @click="deleteBackup('resource',rowIndex)">
                        <t-icon name="remove"></t-icon>
                      </div>
                    </template>
                    <div class="com-icon" @click="addGroup('resource')"
                      v-if="rowIndex === resourceList.length-1 || resourceList.length === 1 ">
                      <t-icon name="add"></t-icon>
                    </div>
                  </template>
                  <template #available="{row}">
                    <t-switch :custom-value="[1,0]" v-model="row.enable" @click.native="changeSwitch(row)">
                    </t-switch>
                  </template>
                </t-table>
              </template>
              <t-popconfirm :visible="showConfirm" theme="default" :content="deleteTip">
                <t-button theme="primary" type="submit" :loading="submitLoading" class="submit"
                  :style="{'margin-top': otherForm.snap_enable ?  '0' : '5px'}">{{lang.hold}}
                </t-button>
                <t-button slot="confirmBtn" size="small" theme="primary" @click="handlerConfig">{{lang.sure}}</t-button>
                <t-button slot="cancelBtn" size="small" variant="text" style="margin-left: 12px"
                  @click="showConfirm = false">{{lang.cancel}}</t-button>
              </t-popconfirm>
            </t-form>
          </div>
        </t-tab-panel>
      </t-tabs>
    </div>
    <!-- 新增/修改 周期 -->
    <t-dialog :header="comTitle" :visible.sync="cycleModel" :footer="false" width="600" @close="closeData"
      :close-on-overlay-click="false">
      <t-form :data="cycleForm" ref="cycleForm" @submit="submitCycle" :rules="cycleRules" class="cycle-form"
        v-if="cycleModel">
        <t-form-item :label="lang.cycle_name" name="name">
          <t-input v-model="cycleForm.name" :placeholder="`${lang.input}${lang.cycle_name}${multiliTip}`"
            :disabled="isAgent"></t-input>
        </t-form-item>
        <t-form-item :label="lang.cycle_time" class="required">
          <t-form-item class="cycle_time" name="num" style="margin-bottom: 0;" :required-mark="false">
            <t-input v-model="cycleForm.num" :placeholder="lang.input+lang.cycle_time" :disabled="isAgent"></t-input>
          </t-form-item>
          <t-form-item :required-mark="false">
            <t-select v-model="cycleForm.unit" :disabled="isAgent">
              <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in cycleTime">
              </t-option>
            </t-select>
          </t-form-item>
        </t-form-item>
        <t-form-item :label="lang.price_factor" name="price_factor">
          <t-input-number v-model="cycleForm.price_factor" :placeholder="lang.input+lang.factor" theme="normal"
            :decimal-places="2" :min="0" :max="9999">
          </t-input-number>
        </t-form-item>
        <t-form-item label=" " class="empty-item">
          <span>{{lang.mf_tip39}}</span>
        </t-form-item>
        <t-form-item :label="lang.cycle_price">
          <t-input-number v-model="cycleForm.price" :placeholder="lang.input+lang.price" theme="normal"
            :decimal-places="2" :min="0">
          </t-input-number>
        </t-form-item>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="cycleModel=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 周期比例 -->
    <t-dialog :header="lang.cycle_ratio" :visible.sync="ratioModel" :footer="false" width="600"
      :close-on-overlay-click="false">
      <t-table row-key="id" :data="ratioData" size="medium" :columns="ratioColumns" :hover="hover" :loading="loading"
        :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width" :hide-sort-tips="true">
        <template #unit="{row}">
          <span>{{row.num}}{{lang[row.unit]}}</span>
        </template>
        <template #ratio="{row}">
          <t-input-number v-model="row.ratio" :placeholder="lang.input+lang.mf_ratio" theme="normal" :decimal-places="2"
            :min="0.01">
          </t-input-number>
        </template>
      </t-table>
      <div class="ratio-tip">
        <p>*{{lang.mf_notes}}</p>
        <p>{{lang.mf_ratio_tip1}}</p>
        <p>{{lang.mf_ratio_tip2}}</p>
        <p>{{lang.mf_ratio_tip3}}</p>
        <p>{{lang.mf_ratio_tip4}}</p>
      </div>
      <div class="com-f-btn">
        <t-button theme="primary" @click="saveRatio" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="ratioModel=false">{{lang.cancel}}</t-button>
      </div>
    </t-dialog>
    <!-- 新增/编辑系统 -->
    <t-dialog :header="comTitle" :visible.sync="systemModel" :footer="false" width="600" @close="closeData"
      :close-on-overlay-click="false">
      <t-form :data="createSystem" ref="cycleForm" @submit="submitSystem" :rules="cycleRules" class="system-form"
        v-if="systemModel">
        <t-form-item :label="lang.system_classify" name="image_group_id">
          <t-select v-model="createSystem.image_group_id" class="select" :disabled="isAgent"
            :placeholder="`${lang.select}${lang.system_classify}`" clearable>
            <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in systemGroup">
            </t-option>
          </t-select>
        </t-form-item>
        <t-form-item :label="lang.system_name" name="name" :rules="[
          { required: true, message: lang.input + lang.system_name, type: 'error' },
          ]">
          <t-input v-model="createSystem.name" :placeholder="`${lang.input}${lang.system_name}${multiliTip}`"
            :disabled="isAgent"></t-input>
        </t-form-item>
        <t-form-item :label="lang.opt_system + 'ID'" name="rel_image_id">
          <t-input v-model="createSystem.rel_image_id" :placeholder="lang.input+lang.opt_system + 'ID'"
            :disabled="isAgent"></t-input>
        </t-form-item>
        <t-form-item :label="lang.mf_charge">
          <t-switch size="small" :custom-value="[1,0]" v-model="createSystem.charge" :disabled="isAgent">
          </t-switch>
        </t-form-item>
        <t-form-item :label="lang.price" v-if="createSystem.charge" name="price">
          <t-input v-model="createSystem.price" :placeholder="lang.input+lang.price"></t-input>
        </t-form-item>
        <t-form-item :label="lang.mf_enable">
          <t-switch size="small" :custom-value="[1,0]" v-model="createSystem.enable" :disabled="isAgent">
          </t-switch>
        </t-form-item>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="systemModel=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/编辑分类管理-->
    <t-dialog :header="`${lang.classific_manage}`" :visible.sync="classModel" :footer="false" width="600"
      @close="closeData" :close-on-overlay-click="false" class="class-dialog">
      <t-form :data="classParams" ref="classForm" @submit="submitSystemGroup" :rules="cycleRules" v-if="classModel">
        <t-form-item :label="lang.system_name" name="name" :rules="[
          { required: true, message: lang.input + lang.system_name, type: 'error', trigger: 'blur' }]">
          <t-input v-model="classParams.name" placeholder=" "></t-input>
        </t-form-item>
        <t-form-item :label="lang.mf_icon" name="icon">
          <t-select v-model="classParams.icon" :popup-props="popupProps" class="custom-select"
            :placeholder="`${lang.select}${lang.mf_icon}`" clearable>
            <img class="s-icon" :class="{noIcon: !classParams.icon}" slot="prefixIcon" style="margin-right: 8px"
              :src="`/plugins/server/mf_cloud/template/admin/img/${classParams.icon}.svg`" />
            <t-option :key="index" :value="item.value" :label="item.label" v-for="(item,index) in iconSelecet"
              class="custom-icon">
              <img :src="item.label" alt="" class="icon">
            </t-option>
          </t-select>
          <t-button theme="primary" type="submit" :loading="submitLoading" style="margin-left: 14px;">{{lang.hold}}
          </t-button>
        </t-form-item>
      </t-form>
      <!-- 分类表格 -->
      <t-table row-key="id" :data="systemGroup" size="medium" :columns="groupColumns" :hover="hover" :loading="loading"
        table-layout="auto" display-type="fixed-width" :hide-sort-tips="true" max-height="450px"
        style="margin-top: 30px;" drag-sort="row-handler" @drag-sort="changeSort">
        <template slot="sortIcon">
          <t-icon name="caret-down-small"></t-icon>
        </template>
        <template #drag="{row}">
          <t-icon name="move"></t-icon>
        </template>
        <template #image_group_name="{row}">
          <span class="class-name">
            <img :src="`/plugins/server/mf_cloud/template/admin/img/${row.icon}.svg`" alt="" class="icon">
            {{row.name}}
          </span>
        </template>
        <template #op="{row}">
          <div class="com-opt">
            <t-icon name="edit-1" @click="editGroup(row)"></t-icon>
            <t-icon name="delete" @click="comDel('group',row)"></t-icon>
          </div>
        </template>
      </t-table>
    </t-dialog>

    <!-- 新增/修改 cpu / memory , system, data -->
    <t-dialog :header="comTitle" :visible.sync="calcModel" :footer="false" width="600" @close="closeData"
      :close-on-overlay-click="false" class="cpuDialog">
      <t-form :data="calcForm" ref="cycleForm" @submit="submitCalc" :rules="calcRules" class="cycle-form"
        v-if="calcModel">
        <t-form-item :label="lang.mf_cores" name="cpuValue" v-if="calcType === 'cpu'">
          <t-input v-model="calcForm.cpuValue" :placeholder="lang.input+lang.mf_cores" :disabled="isAgent"></t-input>
        </t-form-item>
        <!-- 配置方式 -->
        <t-form-item :label="`${lang.config}${lang.mf_way}`" name="type" v-if="calcType !== 'cpu'" class="mem-congfig">
          <t-form-item>
            <t-select v-model="calcForm.type" :placeholder="`${lang.select}${lang.config}${lang.mf_way}`"
              :disabled="disabledWay">
              <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in configType">
              </t-option>
            </t-select>
          </t-form-item>
          <t-form-item>
            <div class="config-tip">
              <span class="notes">{{lang.mf_notes}}</span>
              <p class="notes-txt">
                {{lang.mf_tip6}}<br>
                {{lang.mf_tip7}}<br>
                {{lang.mf_tip8}}<br>
              </p>
            </div>
          </t-form-item>
        </t-form-item>
        <!-- 内存单位 -->
        <t-form-item :label="lang.memory_unit" v-if="calcType === 'memory'">
          <t-radio-group v-model="calcForm.memory_unit" :disabled="memoryList.length > 0">
            <t-radio value="GB">GB</t-radio>
            <t-radio value="MB">MB</t-radio>
          </t-radio-group>
        </t-form-item>
        <!-- 内存/系统盘/数据盘 -->
        <t-form-item :label="calcName(calcType) + '(' + calcUnit +')'" v-if="calcType !== 'cpu'">
          <t-form-item v-if="calcForm.type === 'radio'" name="value" :required-mark="false" style="width: 100%;" :rules="[
        { required: true, message: `${lang.input}` + calcName(calcType), type: 'error' },
        {
          pattern: /^([1-9][0-9]*)$/, message: lang.input + lang.verify16, type: 'warning'
        },
        {
          validator: val => calcRange(val),
           message: calcType === 'memory' ? (calcForm.memory_unit === 'GB' ? `${lang.input}1-512${lang.verify18}` :
           `${lang.input}128-524288${lang.verify18}`)
           :`${lang.input}1-1048576${lang.verify18}`  , type: 'warning'
        }
        ]">
            <t-input v-model="calcForm.value" :placeholder="lang.input+calcName(calcType)"
              :disabled="isAgent"></t-input>
          </t-form-item>
          <t-form-item v-else class="mul-select">
            <t-form-item label=" " name="min_value" :required-mark="false" :rules="[
          { required: true, message: `${lang.input}` + calcName(calcType), type: 'error' },
          {
            pattern: /^([1-9][0-9]*)$/, message: lang.input + lang.verify16, type: 'warning'
          },
          {
            validator: val => calcRange(val),
             message: calcType === 'memory' ? (calcForm.memory_unit === 'GB' ? `${lang.input}1-512${lang.verify18}` : `${lang.input}128-524288${lang.verify1}`)
             :`${lang.input}1-1048576${lang.verify18}`  , type: 'warning'
          }
          ]">
              <t-input v-model="calcForm.min_value" :placeholder="lang.min_value" @blur="changeMin($event, 'calcForm')"
                :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item label=" " name="max_value" :required-mark="false" :rules="[
          { required: true, message: `${lang.input}` + calcName(calcType), type: 'error' },
          {
            pattern: /^([1-9][0-9]*)$/, message: lang.input + lang.verify16, type: 'warning'
          },
          {
            validator: val => calcRange(val),
             message: calcType === 'memory' ? (calcForm.memory_unit === 'GB' ? `${lang.input}1-512${lang.verify18}`
             : `${lang.input}128-524288${lang.verify1}`)
             :`${lang.input}1-1048576${lang.verify18}`  , type: 'warning'
          }
          ]">
              <t-input v-model="calcForm.max_value" :placeholder="lang.max_value" @blur="changeMax($event, 'calcForm')"
                :disabled="isAgent"></t-input>
            </t-form-item>
          </t-form-item>
        </t-form-item>
        <!-- 周期价格 -->
        <t-form-item :label="lang.price_config">
          <div class="price-box">
            <div class="item" v-for="(item,index) in calcForm.price" :key="item.id">
              <p class="txt">{{item.name}}</p>
              <p class="num">
                <!-- 循环验证 -->
                <t-form-item :name="`price[${index}].price`"
                  :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                  <t-input v-model="item.price"
                    :placeholder="(calcForm.type === 'step' || calcForm.type === 'total') ? calcPlaceh: lang.input+lang.money"
                    @blur="blurPrice($event,index,'calcForm')"></t-input>
                </t-form-item>
              </p>
            </div>
            <!-- 自动填充 -->
            <div class="item">
              <p class="txt"></p>
              <p class="num"><t-button size="small" :disabled="isShowFill(calcForm.price)"
                  @click="autoFill('calcForm',calcForm.price)">{{lang.autofill}}</t-button>
              </p>
            </div>
          </div>
        </t-form-item>
        <p class="advance_config" v-if="calcType !== 'memory'" @click="changeAdvance">
          {{lang.advance_config}}
          <template>
            <t-icon :name="isAdvance ? 'chevron-up' : 'chevron-down'"></t-icon>
          </template>
        </p>
        <!-- 高级设置 -->
        <div class="advance_box" v-show="isAdvance">
          <template v-if="calcType === 'cpu'">
            <t-form-item :label="lang.mf_tip3" label-align="top" v-if="otherForm.type !== 'hyperv'">
              <t-input v-model="calcForm.other_config.advanced_cpu" :placeholder="lang.input"
                :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="lang.mf_tip4" label-align="top">
              <t-input v-model="calcForm.other_config.cpu_limit" :placeholder="lang.input"
                :disabled="isAgent"></t-input>
            </t-form-item>
            <!-- <t-form-item :label="lang.mf_tip5" label-align="top">
            <t-input v-model="calcForm.other_config.ipv6_num" :placeholder="lang.input"></t-input>
          </t-form-item> -->
          </template>
          <template v-if="calcType === 'system_disk' || calcType === 'data_disk'">
            <t-form-item :label="lang.disk_type" label-align="top">
              <t-input v-model="calcForm.other_config.disk_type" :placeholder="`${lang.input}${multiliTip}`"
                :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="lang.store_id" label-align="top">
              <t-input v-model="calcForm.other_config.store_id" :placeholder="lang.input" :disabled="isAgent"></t-input>
            </t-form-item>
          </template>
        </div>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="calcModel=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/修改 存储配置-性能配置-->
    <t-dialog :header="comTitle" :visible.sync="natureModel" :footer="false" width="600" @close="closeData"
      :close-on-overlay-click="false" class="natureModel">
      <t-form :data="calcForm" ref="calcForm" @submit="submitNature" :rules="calcRules" class="cycle-form"
        v-if="natureModel">
        <t-form-item :label="lang.capacity_size" class="required">
          <t-form-item label=" " name="min_value" :required-mark="false" class="cycle_time">
            <t-input v-model="calcForm.min_value" :placeholder="lang.input+lang.min_value"
              @blur="changeMin($event, 'calcForm')" :disabled="isAgent"></t-input>
          </t-form-item>
          <t-form-item label=" " name="max_value" :required-mark="false" class="cycle_time">
            <t-input v-model="calcForm.max_value" :placeholder="lang.input+lang.max_value"
              @blur="changeMax($event, 'calcForm')" :disabled="isAgent"></t-input>
          </t-form-item>
        </t-form-item>
        <template v-if="otherForm.type !== 'hyperv'">
          <t-form-item :label="lang.random_read" name="read_bytes">
            <t-input v-model="calcForm.read_bytes" :placeholder="lang.input" :disabled="isAgent"></t-input>
          </t-form-item>
          <t-form-item :label="lang.random_write" name="write_bytes">
            <t-input v-model="calcForm.write_bytes" :placeholder="lang.input" :disabled="isAgent"></t-input>
          </t-form-item>
        </template>
        <t-form-item :label="lang.read_iops" name="read_iops">
          <t-input v-model="calcForm.read_iops" :placeholder="lang.input" :disabled="isAgent"></t-input>
        </t-form-item>
        <t-form-item :label="lang.write_iops" name="write_iops">
          <t-input v-model="calcForm.write_iops" :placeholder="lang.input" :disabled="isAgent"></t-input>
        </t-form-item>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading" :disabled="isAgent">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="natureModel=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>

    <!-- 新增/修改数据中心弹窗 -->
    <t-dialog :header="comTitle" :visible.sync="dataModel" :footer="false" width="635" @close="closeData">
      <t-form :data="dataForm" ref="dataForm" @submit="submitData" :rules="dataRules" class="data-form"
        v-if="dataModel">
        <t-form-item :label="lang.country_area" class="required">
          <t-form-item name="country_id" class="configs" :required-mark="false">
            <t-select v-model="dataForm.country_id" class="flow-type"
              :placeholder="`${lang.select}${lang.country_area}${multiliTip}`" filterable :disabled="isAgent"
              :popup-props="{ overlayClassName: `custom-data`, overlayInnerStyle: (trigger) => ({ width: `${trigger.offsetWidth}px` })}">
              <img class="s-icon" :class="{'noIcon': !dataForm.country_id }" slot="prefixIcon" :src="calcIcon" />
              <t-option :key="item.id" :value="item.id" :label="calcCountryName(item)" v-for="item in countryList"
                class="custom-icon">
                <img :src="`${host}/upload/common/country/${item.iso}.png`" alt="" class="icon">
                {{calcCountryName(item)}}
              </t-option>
            </t-select>
          </t-form-item>
          <t-form-item label="" name="city" class="configs" :required-mark="false" :rules="[
        { required: true, message: lang.input + lang.city, type: 'error' }]">
            <t-input v-model="dataForm.city" :placeholder="`${lang.input}${lang.city}${multiliTip}`"
              :disabled="isAgent"></t-input>
          </t-form-item>
        </t-form-item>
        <t-form-item :label="`${lang.area}${lang.nickname}`" name="area">
          <t-input v-model="dataForm.area" :placeholder="`${lang.input}${lang.area}${lang.nickname}${multiliTip}`"
            :disabled="isAgent">
          </t-input>
        </t-form-item>
        <t-form-item :label="lang.cloud_config" name="cloud_config">
          <t-form-item name="cloud_config" class="configs" style="margin-right: 10px;margin-bottom: 0;"
            :required-mark="false">
            <t-select v-model="dataForm.cloud_config" class="flow-type" @change="changeType" :disabled="isAgent">
              <t-option :key="item.value" :value="item.value" :label="item.lable" v-for="item in dataConfig">
              </t-option>
            </t-select>
          </t-form-item>
          <t-form-item name="cloud_config_id" class="configs" :required-mark="false"
            :rules="[{ required: true, message: lang.input + lang[dataForm.cloud_config] + 'ID', type: 'error' },]">
            <t-input v-model="dataForm.cloud_config_id" :placeholder="lang.input+lang[dataForm.cloud_config] + 'ID'"
              class="flow" :disabled="isAgent">
            </t-input>
          </t-form-item>
        </t-form-item>
        <t-form-item :label="lang.sort" name="order">
          <t-input-number v-model="dataForm.order" theme="normal" :max="999" :min="0" :decimal-places="0"
            :placeholder="`${lang.input}${lang.sort}ID`"></t-input-number>
        </t-form-item>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="closeData">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/修改 GPU -->
    <t-dialog :header="'GPU' + lang.box_title46" :visible.sync="gpuModel" :footer="false" width="1100"
      @close="closeData" class="line-form" :close-on-overlay-click="false" placement="center">
      <t-form :data="gpuForm" ref="gpuForm" @submit="submitGpu" :rules="dataRules" class="data-form">
        <div class="gpu-top" style="display: flex; align-items: center; justify-content:space-between;">
          <div style="width: 50%;">{{lang.data_center}}：{{gpuForm.city}}-{{gpuForm.area}}</div>
          <t-form-item style="width: 50%;" :label="`GPU${lang.box_title46}${lang.nickname}`" label-align="top"
            name="gpu_name">
            <t-input v-model="gpuForm.gpu_name" :placeholder="`${lang.input}GPU${lang.box_title46}${multiliTip}`"
              :disabled="isAgent">
            </t-input>
          </t-form-item>
        </div>
        <div class="config">
          <div class="con">
            <div class="c-item">
              <!-- GPU价格配置 -->
              <div class="com-top">
                <span>{{lang.gpu_price_setting}}</span>
                <div class="add-btn gray" @click="addGpuSub" v-if="!isAgent">
                  {{lang.order_text53}}
                </div>
              </div>

              <t-table row-key="id" :data="gpuForm.gpu_data" size="medium" :columns="calcColums('line_gpu')"
                :hover="hover" :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'"
                display-type="fixed-width" :hide-sort-tips="true">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #fir="{row}">
                  {{row.value}}
                </template>
                <template #price="{row}">
                  {{currency_prefix}}
                  <template v-if="lineType === 'add'">
                    {{calcPrice(row.price)}}
                  </template>
                  <template v-else>
                    {{(row.price*1).toFixed(2)}}
                    <template v-if="row.duration">/{{row.duration}}</template>
                  </template>
                  &nbsp;{{lang.rise}}
                </template>
                <template #op="{row,rowIndex}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editGpuItem(row)"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="delGpuItem(row)" :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
            </div>
            <!-- 右侧 -->
            <div class="c-item">
              <div class="empty" v-show="!lineRight">
                <p>{{lang.mf_tip12}}</p>
              </div>
              <!-- 新增、编辑线路子项 -->
              <div class="opt" v-if="lineRight">
                <t-form :data="gpuForm" ref="cycleForm" @submit="submitGpuSub" :rules="calcRules" class="sub-form"
                  label-align="top">
                  <div class="scroll">
                    <!-- gpu -->
                    <t-form-item :label="`GPU${lang.auth_num}`" name="value"
                      :rules="calcReg(`IP${lang.auth_num}`,0,100)">
                      <t-input v-model="gpuForm.value" :placeholder="`${lang.input}GPU${lang.auth_num}`"
                        :disabled="isAgent"></t-input>
                    </t-form-item>
                    <!-- 周期价格 -->
                    <t-form-item :label="lang.price">
                      <div class="price-box">
                        <div class="item" v-for="(item,index) in gpuForm.price" :key="item.id">
                          <p class="txt">{{item.name}}</p>
                          <p class="num">
                            <!-- 循环验证 -->
                            <t-form-item :name="`price[${index}].price`"
                              :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                              <t-input v-model="item.price" :placeholder="lang.input + lang.money"
                                @blur="blurGpuPrice($event,index)"></t-input>
                            </t-form-item>
                          </p>
                        </div>
                        <!-- 自动填充 -->
                        <div class="item">
                          <p class="txt"></p>
                          <p class="num"><t-button size="small" :disabled="isShowFill(gpuForm.price)"
                              @click="autoFill('gpuForm',gpuForm.price)">{{lang.autofill}}</t-button>
                          </p>
                        </div>
                      </div>
                    </t-form-item>
                  </div>
                  <div class="com-btn">
                    <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                    </t-button>
                    <t-button theme="default" variant="base" @click="lineRight=false">{{lang.back}}</t-button>
                  </div>
                </t-form>
              </div>
            </div>

          </div>
          <div class="bot-opt" :class="{'hide-opt': lineRight}">
            <div class="b-item">
              <div class="com-btn">
                <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                </t-button>
                <t-button theme="default" variant="base" @click="closeData">{{lang.cancel}}</t-button>
              </div>
            </div>
          </div>
        </div>
      </t-form>
    </t-dialog>

    <!-- 新增/修改 商品初始防御策略 -->
    <t-dialog :header="lang.mf_tip49" :visible.sync="defenceModel" :footer="false" width="1100" @close="closeData"
      class="line-form defence-model" :close-on-overlay-click="false" placement="center">
      <t-form :data="defenceForm" ref="defenceForm" @submit="submitGlobalRule" :rules="dataRules" class="data-form"
        label-align="left">
        <div class="top">
          <t-form-item :label="lang.mf_tip50" label-width="auto">
            <t-switch :custom-value="[1,0]" :value="defenceForm.sync_firewall_rule" @change="changeSyncRule">
            </t-switch>
          </t-form-item>
        </div>
        <div class="config">
          <div class="con">
            <template v-if="defenceForm.sync_firewall_rule">
              <div class="c-item">
                <div class="com-top">
                  <span></span>
                  <div class="add-btn gray" @click="getAllRules" v-if="!isAgent">
                    {{lang.mf_tip51}}
                  </div>
                </div>
                <t-table row-key="id" :data="checkedFirewallRule" size="medium" :columns="calcColums('global_defence')"
                  :hover="hover" :loading="checkRuleloading" :table-layout="tableLayout ? 'auto' : 'fixed'"
                  drag-sort="row-handler" @drag-sort="onGlobalDefenceDragSort" display-type="fixed-width"
                  :hide-sort-tips="true" max-height="420px" class="rule-table">
                  <template slot="sortIcon">
                    <t-icon name="caret-down-small"></t-icon>
                  </template>
                  <template #drag="{row}">
                    <t-icon name="move"></t-icon>
                  </template>
                  <template #fir="{row}">
                    {{row.defense_peak}}
                  </template>

                  <template #price="{row}">
                    {{currency_prefix}}
                    <template v-if="lineType === 'add'">
                      {{calcPrice(row.price)}}
                    </template>
                    <template v-else>
                      {{(row.price*1).toFixed(2)}}
                      <template v-if="row.duration">/{{row.duration}}</template>
                    </template>
                    &nbsp;{{lang.rise}}
                  </template>
                  <template #op="{row,rowIndex}">
                    <div class="com-opt">
                      <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                        <t-icon name="edit-1" @click="editRuleItem(row)"></t-icon>
                      </t-tooltip>
                      <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                        <t-icon name="delete" @click="delRuleItem(row)" :class="{'server-disabled': isAgent}">
                        </t-icon>
                      </t-tooltip>
                    </div>
                  </template>
                </t-table>
                <t-form-item :label="lang.mf_tip53" label-width="auto" v-show="checkedFirewallRule.length"
                  name="order_default_defence"
                  :rules="checkedFirewallRule.length ? [ { required: true, message: lang.mf_tip59, type: 'error' } ] : [{required: false}]">
                  <t-select v-model="defenceForm.order_default_defence" class="choose-default">
                    <t-option v-for="item in checkedFirewallRule" :value="item.value" :label="item.defense_peak"
                      :key="item.value">
                    </t-option>
                  </t-select>
                </t-form-item>
              </div>
              <!-- 右侧 -->
              <div class="c-item">
                <div class="empty" v-show="!lineRight">
                  <p>{{lang.mf_tip12}}</p>
                </div>
                <!-- 新增、编辑线路子项 -->
                <div class="opt" v-if="lineRight">
                  <t-form :data="gpuForm" ref="cycleForm" @submit="submitRuleSub" :rules="calcRules" class="sub-form"
                    label-align="top">
                    <div class="scroll">
                      <!-- 导入防御规则 -->
                      <template v-if="optType === 'add'">
                        <t-form-item :label="lang.mf_tip61" label-width="auto" label-align="left" class="required">
                          <t-select v-model="defenceForm.firewall_type" @change="changeFirewallType">
                            <t-option v-for="item in allFirewallRuleType" :value="item.type" :label="item.name"
                              :key="item.type">
                            </t-option>
                          </t-select>
                        </t-form-item>
                        <div class="import-rule">
                          <t-button @click="importRule">{{lang.mf_tip54}}</t-button>
                        </div>
                        <t-table row-key="id" :data="allFirewallRule" size="medium" :columns="allFirewallColumns"
                          :hover="hover" :loading="firewallLoading" table-layout="auto" display-type="fixed-width"
                          :hide-sort-tips="true" @select-change="rehandleSelectRule" :selected-row-keys="checkRuleId"
                          max-height="370px" class="rule-table">
                          <template slot="sortIcon">
                            <t-icon name="caret-down-small"></t-icon>
                          </template>
                        </t-table>
                        <p class="s-tip">{{lang.mf_tip56}}</p>
                        <p class="s-tip">{{lang.mf_tip57}}</p>
                        <p class="s-tip">{{lang.mf_tip58}}</p>
                      </template>
                      <!-- 编辑 -->
                      <template v-else>
                        <t-form-item :label="lang.mf_tip55">
                          <t-input v-model="defencePeak" disabled></t-input>
                        </t-form-item>
                        <t-form-item :label="lang.mf_tip52">
                          <t-input v-model="defenceRuleName" disabled></t-input>
                        </t-form-item>
                        <!-- 周期价格 -->
                        <t-form-item :label="lang.price">
                          <div class="price-box">
                            <div class="item" v-for="(item,index) in defenceForm.price" :key="item.id">
                              <p class="txt">{{item.name}}</p>
                              <p class="num">
                                <!-- 循环验证 -->
                                <t-form-item :name="`price[${index}].price`"
                                  :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                                  <t-input v-model="item.price" :placeholder="lang.input + lang.money"
                                    @blur="blurPrice($event,index, 'defenceForm')"></t-input>
                                </t-form-item>
                              </p>
                            </div>
                            <!-- 自动填充 -->
                            <div class="item">
                              <p class="txt"></p>
                              <p class="num"><t-button size="small" :disabled="isShowFill(defenceForm.price)"
                                  @click="autoFill('defenceForm',defenceForm.price)">{{lang.autofill}}</t-button>
                              </p>
                            </div>
                          </div>
                        </t-form-item>
                      </template>
                    </div>
                    <div class="com-btn">
                      <t-button theme="primary" type="submit" :loading="submitLoading"
                        v-show="optType !== 'add'">{{lang.hold}}
                      </t-button>
                      <t-button theme="default" variant="base" @click="lineRight=false">{{lang.back}}</t-button>
                    </div>
                  </t-form>
                </div>
              </div>
            </template>
          </div>
          <div class="bot-opt" :class="{'hide-opt': lineRight && optType !== 'add'}">
            <div class="b-item">
              <div class="com-btn">
                <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                </t-button>
                <t-button theme="default" variant="base" @click="defenceModel = false">{{lang.cancel}}</t-button>
              </div>
            </div>
          </div>
        </div>
      </t-form>
    </t-dialog>

    <!-- 新增/修改 线路 -->
    <t-dialog :header="lang.line" :visible.sync="lineModel" :footer="false" width="1100" @close="closeData"
      class="line-form" :close-on-overlay-click="false" placement="center">
      <t-form :data="lineForm" ref="lineForm" @submit="submitLine" :rules="dataRules" class="data-form"
        v-if="lineModel">
        <div class="top">
          <div class="sort">
            <t-form-item :label="lang.country_area" class="required" v-if="lineType === 'add'" label-width="120px">
              <t-form-item name="country_id" class="configs" :required-mark="false">
                <t-select v-model="lineForm.country_id" class="flow-type" :placeholder="lang.select+lang.country_area"
                  filterable @change="changeCountry"
                  :popup-props="{ overlayClassName: `custom-data`, overlayInnerStyle: (trigger) => ({ width: `${trigger.offsetWidth}px` })}">
                  <img class="s-icon" :class="{'noIcon': !dataForm.country_id && !lineForm.country_id }"
                    slot="prefixIcon" :src="calcIcon1" />
                  <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in countrySelect"
                    class="custom-icon">
                    <img :src="`${host}/upload/common/country/${item.iso}.png`" alt="" class="icon">
                    {{item.name}}
                  </t-option>
                </t-select>
              </t-form-item>
              <t-form-item label="" name="city" class="configs" :required-mark="false">
                <t-select v-model="lineForm.city" class="flow-type" @change="changeCity"
                  :placeholder="lang.select+lang.city">
                  <t-option :key="c" :value="city.name" :label="city.name" v-for="(city, c) in calcCity">
                  </t-option>
                </t-select>
              </t-form-item>
              <t-form-item label="" name="data_center_id" class="configs" :required-mark="false">
                <t-select v-model="lineForm.data_center_id" class="flow-type" :placeholder="lang.select+lang.area">
                  <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in calcArea">
                  </t-option>
                </t-select>
              </t-form-item>
            </t-form-item>
          </div>
          <div class="sort">
            <t-form-item :label="lang.line_name" name="name" class="line-name" label-width="120px" :rules="[
            { required: true, message: `${lang.input}${lang.line_name}`, type: 'error' },]">
              <t-input v-model="lineForm.name" :placeholder="`${lang.input}${lang.line_name}${multiliTip}`"></t-input>
            </t-form-item>
            <t-form-item :label="lang.sort" name="order" label-width="120px">
              <t-input-number v-model="lineForm.order" theme="normal" :max="999" :min="0" :decimal-places="0"
                :placeholder="`${lang.input}${lang.sort}`"></t-input-number>
            </t-form-item>
          </div>
        </div>
        <div class="bg"></div>
        <div class="config">
          <p class="p-tit">
            {{lang.bw_price_config}}
            <t-checkbox v-model="lineForm.link_clone" :disabled="isAgent">{{lang.link_clone}}</t-checkbox>
          </p>
          <div class="con">
            <!-- 左侧 -->
            <div class="c-item">
              <t-form-item :label="`${lang.billing_way}`" name="bill_type" label-align="left" class="required"
                v-if="lineType === 'add'">
                <t-select v-model="lineForm.bill_type" class="bill-type" @change="lineRight=false">
                  <t-option key="bw" value="bw" :label="lang.mf_bw"></t-option>
                  <t-option key="flow" value="flow" :label="lang.mf_flow" v-if="otherForm.type !== 'hyperv'"></t-option>
                </t-select>
              </t-form-item>
              <!-- bw_data -->
              <template v-if="lineForm.bill_type === 'bw'">
                <div class="com-top">
                  <p class="tit">
                    {{lang.billing_way}}
                    <template v-if="calcSubTitle(lineForm.bw_data)">
                      {{calcSubTitle(lineForm.bw_data)}}
                    </template>
                  </p>
                  <div class="add-btn gray" @click="addLineSub('line_bw')" :class="{'server-disabled': isAgent}">
                    {{lang.order_text53}}
                  </div>
                </div>
                <t-table row-key="id" :data="lineForm.bw_data" size="medium" :columns="bwColumns" :hover="hover"
                  :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                  :hide-sort-tips="true">
                  <template slot="sortIcon">
                    <t-icon name="caret-down-small"></t-icon>
                  </template>
                  <template #fir="{row}">
                    <template v-if="row.type==='radio'">
                      {{row.value}}
                    </template>
                    <template v-else>
                      {{row.min_value}}-{{row.max_value}}
                    </template>
                  </template>
                  <template #price="{row}">
                    <!-- 新增线路的时候本地处理显示 -->
                    {{currency_prefix}}
                    <template v-if="lineType === 'add'">
                      {{calcPrice(row.price)}}
                    </template>
                    <template v-else>
                      {{(row.price*1).toFixed(2)}}
                      <template v-if="row.duration">/{{row.duration}}</template>
                    </template>
                    &nbsp;{{lang.rise}}
                  </template>
                  <template #op="{row, rowIndex}">
                    <div class="com-opt">
                      <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                        <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_bw')"></t-icon>
                      </t-tooltip>
                      <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                        <t-icon name="delete" @click="comDel('line_bw',row,rowIndex)"
                          :class="{'server-disabled': isAgent}"></t-icon>
                      </t-tooltip>
                    </div>
                  </template>
                </t-table>
                <p class="advance_config" @click="bw_ip_show = !bw_ip_show" v-if="!isAgent">
                  {{lang.advance_config}}
                  <template>
                    <t-icon :name="bw_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                  </template>
                </p>
                <!-- 高级设置 -->
                <div class="advance_box" v-show="bw_ip_show && !isAgent">
                  <t-form-item :label="`IP${lang.group}`" label-align="top">
                    <t-input v-model="lineForm.bw_ip_group" :placeholder="lang.input"></t-input>
                  </t-form-item>
                </div>
              </template>
              <!-- 流量 -->
              <template v-else>
                <div class="com-top">
                  <p class="tit">
                    {{lang.traffic_billing}}
                    <template v-if="calcSubTitle(lineForm.flow_data)"></template>
                  </p>
                  <div class="add-btn gray" @click="addLineSub('line_flow')" :class="{'server-disabled': isAgent}">
                    {{lang.order_text53}}
                  </div>
                </div>
                <t-table row-key="id" :data="lineForm.flow_data" size="medium" :columns="calcColums('flow')"
                  :hover="hover" :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'"
                  display-type="fixed-width" :hide-sort-tips="true">
                  <template slot="sortIcon">
                    <t-icon name="caret-down-small"></t-icon>
                  </template>
                  <template #fir="{row}">
                    {{row.value}}
                  </template>
                  <template #price="{row}">
                    <!-- 新增线路的时候本地处理显示 -->
                    {{currency_prefix}}
                    <template v-if="lineType === 'add'">
                      {{calcPrice(row.price)}}
                    </template>
                    <template v-else>
                      {{(row.price*1).toFixed(2)}}
                      <template v-if="row.duration">/{{row.duration}}</template>
                    </template>
                    &nbsp;{{lang.rise}}
                  </template>
                  <template #op="{row, rowIndex}">
                    <div class="com-opt">
                      <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                        <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_flow')"></t-icon>
                      </t-tooltip>
                      <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                        <t-icon name="delete" @click="comDel('line_flow',row, rowIndex)"
                          :class="{'server-disabled': isAgent}"></t-icon>
                      </t-tooltip>
                    </div>
                  </template>
                </t-table>
                <p class="advance_config" @click="bw_ip_show = !bw_ip_show" v-if="!isAgent">
                  {{lang.advance_config}}
                  <template>
                    <t-icon :name="bw_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                  </template>
                </p>
                <!-- 高级设置 -->
                <div class="advance_box" v-show="bw_ip_show && !isAgent">
                  <t-form-item :label="`IP${lang.group}`" label-align="top">
                    <t-input v-model="lineForm.bw_ip_group" :placeholder="lang.input"></t-input>
                  </t-form-item>
                </div>
                <p class="s-tip">{{lang.mf_tip21}}</p>
              </template>
              <!-- 防护价格配置 -->
              <div class="com-top">
                <p class="tit">
                  <t-form-item :label="lang.protect_price_config">
                    <t-switch :custom-value="[1,0]" v-model="lineForm.defence_enable" size="small" :disabled="isAgent"
                      @change="changeLineDefenceEnable">
                    </t-switch>
                  </t-form-item>
                </p>
                <div class="add-btn gray" @click="addLineSub('line_defence')"
                  v-show="lineForm.defence_enable && lineForm.sync_firewall_rule === 0"
                  :class="{'server-disabled': isAgent}">
                  {{lang.order_text53}}
                </div>
              </div>
              <!-- 全局防火墙 -->
              <div class="com-top firewall" v-show="lineForm.defence_enable && hasFirewall && isFirewallProduct">
                <p class="tit">
                  <t-form-item :label="lang.mf_tip50">
                    <t-switch :custom-value="[1,0]" :value="lineForm.sync_firewall_rule" size="small"
                      :disabled="isAgent" @change="changeLineFirewallRule">
                    </t-switch>
                  </t-form-item>
                </p>
                <div class="add-btn gray" @click="getAllRules" v-show="lineForm.sync_firewall_rule"
                  :class="{'server-disabled': isAgent}">
                  {{lang.mf_tip51}}
                </div>
              </div>
              <t-table row-key="id" :data="lineForm.defence_data" size="medium" :columns="calcColums('defence')"
                :hover="hover" :loading="checkRuleloading" :table-layout="tableLayout ? 'auto' : 'fixed'"
                drag-sort="row-handler" @drag-sort="onDefenceDragSort" display-type="fixed-width" :hide-sort-tips="true"
                v-show="lineForm.defence_enable" max-height="300">
                <template #drag="{row}">
                  <t-icon name="move"></t-icon>
                </template>
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #fir="{row}">
                  {{ lineForm.sync_firewall_rule ? row.defense_peak : row.value }}
                </template>
                <template #price="{row}">
                  <!-- 新增线路的时候本地处理显示 -->
                  {{currency_prefix}}
                  <template v-if="lineType === 'add'">
                    {{calcPrice(row.price)}}
                  </template>
                  <template v-else>
                    {{(row.price*1).toFixed(2)}}
                    <template v-if="row.duration">/{{row.duration}}</template>
                  </template>
                  &nbsp;{{lang.rise}}
                </template>
                <template #op="{row,rowIndex}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1"
                        @click="editSubItem(row,rowIndex,'line_defence', row.firewall_type)"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('line_defence',row,rowIndex)"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
              <!-- 线路选择默认防御 -->
              <t-form-item :label="lang.mf_tip53" label-width="auto"
                v-show="lineForm.defence_enable && lineForm.sync_firewall_rule && isFirewallProduct" class="mt20">
                <t-select v-model="lineForm.order_default_defence" class="choose-default">
                  <t-option v-for="item in lineForm.defence_data" :value="item.value" :label="item.defense_peak"
                    :key="item.value">
                  </t-option>
                </t-select>
              </t-form-item>
              <div v-show="lineForm.defence_enable">
                <p class="advance_config" @click="defence_ip_show = !defence_ip_show " v-if="!isAgent">
                  {{lang.advance_config}}
                  <template>
                    <t-icon :name="defence_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                  </template>
                </p>
                <!-- 高级设置 -->
                <div class="advance_box" v-show="defence_ip_show && !isAgent">
                  <t-form-item :label="`IP${lang.group}`" label-align="top">
                    <t-input v-model="lineForm.defence_ip_group" :placeholder="lang.input"></t-input>
                  </t-form-item>
                </div>
              </div>
              <!-- 附加IPV4价格配置 -->
              <div class="com-top">
                <p class="tit">
                  <t-form-item :label="lang.ipv4_config">
                    <t-switch :custom-value="[1,0]" v-model="lineForm.ip_enable" size="small" :disabled="isAgent">
                    </t-switch>
                  </t-form-item>
                </p>
                <div class="add-btn gray" @click="addLineSub('line_ip', 'ipv4')" v-show="lineForm.ip_enable"
                  :class="{'server-disabled': isAgent}">
                  {{lang.order_text53}}
                </div>
              </div>
              <t-table row-key="id" :data="lineForm.ip_data" size="medium" :columns="calcColums('ipv4')" :hover="hover"
                :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                :hide-sort-tips="true" v-show="lineForm.ip_enable">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #fir="{row}">
                  <template v-if="row.type==='radio'">
                    {{row.value}}
                  </template>
                  <template v-else>
                    {{row.min_value}}-{{row.max_value}}
                  </template>
                </template>
                <template #price="{row}">
                  <!-- 新增线路的时候本地处理显示 -->
                  {{currency_prefix}}
                  <template v-if="lineType === 'add'">
                    {{calcPrice(row.price)}}
                  </template>
                  <template v-else>
                    {{(row.price*1).toFixed(2)}}
                    <template v-if="row.duration">/{{row.duration}}</template>
                  </template>
                  &nbsp;{{lang.rise}}
                </template>
                <template #op="{row,rowIndex}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_ip', 'ipv4')"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('line_ip',row,rowIndex,'ipv4')"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
              <!-- 附加IPV6价格配置 -->
              <div class="com-top">
                <p class="tit">
                  <t-form-item :label="lang.ipv6_config">
                    <t-switch :custom-value="[1,0]" v-model="lineForm.ipv6_enable" size="small" :disabled="isAgent">
                    </t-switch>
                  </t-form-item>
                </p>
                <div class="add-btn gray" @click="addLineSub('line_ip', 'ipv6')" :class="{'server-disabled': isAgent}"
                  v-show="lineForm.ipv6_enable">
                  {{lang.order_text53}}
                </div>
              </div>
              <t-table row-key="id" :data="lineForm.ipv6_data" size="medium" :columns="calcColums('ipv6')"
                :hover="hover" :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'"
                display-type="fixed-width" :hide-sort-tips="true" v-show="lineForm.ipv6_enable">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #fir="{row}">
                  <template v-if="row.type==='radio'">
                    {{row.value}}
                  </template>
                  <template v-else>
                    {{row.min_value}}-{{row.max_value}}
                  </template>
                </template>
                <template #price="{row}">
                  <!-- 新增线路的时候本地处理显示 -->
                  {{currency_prefix}}
                  <template v-if="lineType === 'add'">
                    {{calcPrice(row.price)}}
                  </template>
                  <template v-else>
                    {{(row.price*1).toFixed(2)}}
                    <template v-if="row.duration">/{{row.duration}}</template>
                  </template>
                  &nbsp;{{lang.rise}}
                </template>
                <template #op="{row,rowIndex}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_ip', 'ipv6')"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('line_ip',row,rowIndex, 'ipv6')"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
            </div>
            <!-- 右侧 -->
            <div class="c-item">
              <div class="empty" v-show="!lineRight">
                <p>{{lang.mf_tip12}}</p>
              </div>
              <!-- 新增、编辑线路子项 -->
              <div class="opt" v-if="lineRight">
                <t-form :data="subForm" ref="cycleForm" @submit="submitSub" :rules="calcRules" class="sub-form"
                  label-align="top">
                  <div class="scroll">
                    <!-- 配置方式 -->
                    <t-form-item :label="`${lang.billing_way}`" name="type"
                      v-if="subType === 'line_bw' || subType === 'line_ip'" class="mem-congfig">
                      <t-select v-model="subForm.type" :placeholder="`${lang.select}${lang.billing_way}`"
                        :disabled="calcShow">
                        <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in configType">
                        </t-option>
                      </t-select>
                    </t-form-item>
                    <!-- line_defence -->
                    <template v-if="subType === 'line_defence'">
                      <!-- 导入防火墙规则 -->
                      <template v-if="optType === 'add' && !isShowLinePrice">
                        <t-form-item :label="lang.mf_tip61" label-width="auto" label-align="left" class="required">
                          <t-select v-model="defenceForm.firewall_type" @change="changeFirewallType">
                            <t-option v-for="item in allFirewallRuleType" :value="item.type" :label="item.name"
                              :key="item.type">
                            </t-option>
                          </t-select>
                        </t-form-item>
                        <div class="import-rule">
                          <t-button @click="importLineRule">{{lang.mf_tip54}}</t-button>
                        </div>
                        <t-table row-key="id" :data="allFirewallRule" size="medium" :columns="allFirewallColumns"
                          :hover="hover" :loading="firewallLoading" table-layout="auto" display-type="fixed-width"
                          :hide-sort-tips="true" @select-change="rehandleSelectRule" :selected-row-keys="checkRuleId"
                          max-height="370px" class="rule-table">
                          <template slot="sortIcon">
                            <t-icon name="caret-down-small"></t-icon>
                          </template>
                        </t-table>
                        <p class="s-tip">{{lang.mf_tip56}}</p>
                        <p class="s-tip">{{lang.mf_tip57}}</p>
                        <p class="s-tip">{{lang.mf_tip58}}</p>
                      </template>
                      <!-- 修改防火墙规则 -->
                      <template v-else>
                        <template v-if="!isEditDefence">

                          <t-form-item :label="lang.defence + '（Gbps）'" name="value"
                            :rules="calcReg(lang.defence,0,9999999)">
                            <t-input v-model="subForm.value" :placeholder="lang.input+lang.defence" :disabled="isAgent">
                            </t-input>
                          </t-form-item>
                        </template>
                        <template v-else>
                          <t-form-item :label="lang.mf_tip55">
                            <t-input v-model="subForm.defense_peak" disabled></t-input>
                          </t-form-item>
                          <t-form-item :label="lang.mf_tip52">
                            <t-input v-model="subForm.defence_rule_name" disabled></t-input>
                          </t-form-item>
                        </template>
                      </template>
                    </template>

                    <!-- line_ip -->
                    <t-form-item v-if="subType === 'line_ip'" :label="calcName(subType)" class="required">
                      <t-form-item name="value" :rules="calcReg(`IP${lang.auth_num}`,0,10000)"
                        v-if="subForm.type === 'radio'" class="flex">
                        <t-input v-model="subForm.value" :placeholder="lang.mf_tip45" :disabled="isAgent"></t-input>
                      </t-form-item>
                      <t-form-item v-else class="mul-select">
                        <t-form-item label=" " name="min_value" :required-mark="false"
                          :rules="calcReg(ipType === 'ipv4' ? 'IPv4' : 'IPv6',0,10000)">
                          <t-input v-model="subForm.min_value" :placeholder="lang.min_value"
                            @blur="changeMin($event, 'subForm')" :disabled="isAgent"></t-input>
                        </t-form-item>
                        <t-form-item label=" " name="max_value" :required-mark="false"
                          :rules="calcReg(ipType === 'ipv4' ? 'IPv4' : 'IPv6',0,10000)">
                          <t-input v-model="subForm.max_value" :placeholder="lang.max_value"
                            @blur="changeMax($event, 'subForm')" :disabled="isAgent"></t-input>
                        </t-form-item>
                      </t-form-item>
                    </t-form-item>
                    <!-- gpu -->
                    <t-form-item :label="`GPU${lang.auth_num}`" name="value" v-if="subType === 'line_gpu'"
                      :rules="calcReg(`IP${lang.auth_num}`,0,100)">
                      <t-input v-model="subForm.value" :placeholder="`${lang.input}GPU${lang.auth_num}`"
                        :disabled="isAgent"></t-input>
                    </t-form-item>
                    <!-- line_flow -->
                    <t-form-item :label="lang.cloud_flow + '（GB）'" name="value" v-if="subType === 'line_flow'"
                      :rules="calcReg(lang.bw,0,9999999)">
                      <t-input v-model="subForm.value" :placeholder="lang.input+lang.cloud_flow"
                        :disabled="isAgent"></t-input>
                    </t-form-item>
                    <template v-if="subType === 'line_flow'">
                      <t-form-item class="line_flow bw-limit" :label="`${lang.bw_limit}（Mbps）`">
                        <t-form-item label="" name="other_config.out_bw" :label="lang.out" label-align="left"
                          class="limit" :rules="calcReg(lang.out_bw,0,30000)">
                          <t-input v-model="subForm.other_config.out_bw" :placeholder="lang.out_bw"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                        <t-form-item label="" name="other_config.in_bw" :label="lang.in" label-align="left"
                          class="limit" :rules="calcReg(lang.out_bw,0,30000)">
                          <t-input v-model="subForm.other_config.in_bw" :placeholder="lang.in_bw"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                      </t-form-item>
                    </template>
                    <!-- 内存/系统盘/数据盘 -->
                    <t-form-item :label="calcName(subType)" v-if="subType === 'line_bw'" class="required">
                      <t-form-item v-if="subForm.type === 'radio'" name="value" style="width: 100%;" class="no-lable"
                        :rules="calcReg(lang.bw,1,30000)">
                        <t-input v-model="subForm.value" :placeholder="lang.input+calcName(subType)"
                          :disabled="isAgent"></t-input>
                      </t-form-item>
                      <t-form-item v-else class="mul-select">
                        <t-form-item label=" " name="min_value" :required-mark="false"
                          :rules="calcReg(lang.bw,1,30000)">
                          <t-input v-model="subForm.min_value" :placeholder="lang.min_value"
                            @blur="changeMin($event, 'subForm')" :disabled="isAgent"></t-input>
                        </t-form-item>
                        <t-form-item label=" " name="max_value" :required-mark="false"
                          :rules="calcReg(lang.bw,1,30000)">
                          <t-input v-model="subForm.max_value" :placeholder="lang.max_value"
                            @blur="changeMax($event, 'subForm')" :disabled="isAgent"></t-input>
                        </t-form-item>
                      </t-form-item>
                    </t-form-item>
                    <!-- 周期价格 -->
                    <t-form-item :label="lang.price" v-if="isShowLinePrice">
                      <div class="price-box">
                        <div class="item" v-for="(item,index) in subForm.price" :key="item.id">
                          <p class="txt">{{item.name}}</p>
                          <p class="num">
                            <!-- 循环验证 -->
                            <t-form-item :name="`price[${index}].price`"
                              :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                              <t-input v-model="item.price"
                                :placeholder="((subForm.type === 'step' || subForm.type === 'total') && subType === 'line_bw') ? lang.mf_tip26: lang.input+lang.money"
                                @blur="blurSubPrice($event,index)"></t-input>
                            </t-form-item>
                          </p>
                        </div>
                        <!-- 自动填充 -->
                        <div class="item">
                          <p class="txt"></p>
                          <p class="num"><t-button size="small" :disabled="isShowFill(subForm.price)"
                              @click="autoFill('subForm',subForm.price)">{{lang.autofill}}</t-button>
                          </p>
                        </div>
                      </div>
                    </t-form-item>
                    <!-- 流量 -->
                    <template v-if="subType === 'line_flow'">
                      <t-form-item :label="`${lang.traffic_type}`" class="mem-congfig" name="other_config.traffic_type">
                        <t-select v-model="subForm.other_config.traffic_type"
                          :placeholder="`${lang.select}${lang.traffic_type}`" :disabled="isAgent">
                          <t-option :key="item.value" :value="item.value" :label="item.label"
                            v-for="item in trafficTypes">
                          </t-option>
                        </t-select>
                      </t-form-item>
                      <t-form-item :label="`${lang.billing_cycle}`" class="mem-congfig" name="other_config.bill_cycle">
                        <template slot="label">
                          <t-tooltip :content="lang.mf_tip28 + '\n' + lang.mf_tip29" :show-arrow="false" theme="light"
                            placement="top-left">
                            <span>{{lang.billing_cycle}}</span>
                            <t-icon name="help-circle"></t-icon>
                          </t-tooltip>
                        </template>
                        <t-select v-model="subForm.other_config.bill_cycle"
                          :placeholder="`${lang.select}${lang.billing_cycle}`" :disabled="isAgent">
                          <t-option :key="item.value" :value="item.value" :label="item.label"
                            v-for="item in billingCycle">
                          </t-option>
                        </t-select>
                      </t-form-item>
                    </template>

                    <p class="advance_config" v-if="subType === 'line_bw' && otherForm.type !== 'hyperv'"
                      @click="changeAdvance">
                      {{lang.advance_config}}
                      <template>
                        <t-icon :name="isAdvance ? 'chevron-up' : 'chevron-down'"></t-icon>
                      </template>
                    </p>
                    <!-- 子项高级设置 -->
                    <div class="advance_box" v-show="isAdvance && otherForm.type !== 'hyperv'">
                      <template v-if="subType === 'line_bw'">
                        <t-form-item :label="lang.inflow_bw" label-align="top">
                          <t-input v-model="subForm.other_config.in_bw" :placeholder="lang.input"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                        <t-form-item :label="lang.advanced_bw" label-align="top">
                          <t-input v-model="subForm.other_config.advanced_bw" :placeholder="lang.input"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                      </template>
                      <!-- <template v-if="calcType === 'system_disk' || calcType === 'data_disk'">
                      <t-form-item :label="lang.disk_type" label-align="top">
                        <t-input v-model="calcForm.other_config.disk_type" :placeholder="lang.input"></t-input>
                      </t-form-item>
                    </template> -->
                    </div>
                  </div>
                  <div class="com-btn">
                    <t-button theme="primary" type="submit" :loading="submitLoading"
                      v-show="isShowLinePrice">{{lang.hold}}
                    </t-button>
                    <t-button theme="default" variant="base" @click="lineRight=false">{{lang.back}}</t-button>
                  </div>
                </t-form>
              </div>
            </div>
          </div>
          <div class="bot-opt" :class="{'hide-opt': lineRight}">
            <div class="b-item">
              <div class="com-btn">
                <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                </t-button>
                <t-button theme="default" variant="base" @click="closeData">{{lang.cancel}}</t-button>
              </div>
            </div>
          </div>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/修改 套餐配置 -->
    <t-dialog :header="comTitle" :visible.sync="recommendModel" :footer="false" width="1470" @close="closeData"
      class="line-form recommend-form package-dailog" :close-on-overlay-click="false" placement="center">
      <t-form :data="lineForm" ref="lineForm" @submit="submitRecommend" :rules="dataRules"
        class="data-form cpuDialog package-form" v-if="recommendModel" label-align="top">
        <div class="form-item">
          <!-- 套餐信息 -->
          <p class="com-tit">{{lang.package_info}}</p>
          <div class="short-item">
            <t-form-item :label="lang.box_label23" name="name">
              <t-input v-model="lineForm.name" :placeholder="`${lang.input}${lang.box_label23}${multiliTip}`"></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.sort}ID`" name="order">
              <t-input v-model="lineForm.order" :placeholder="`${lang.input}${lang.sort}ID`"></t-input>
            </t-form-item>
          </div>
          <t-form-item :label="lang.short_des" name="description">
            <t-input v-model="lineForm.description" :placeholder="`${lang.mf_tip23}${multiliTip}`" :maxlength="15"
              show-limit-number></t-input>
          </t-form-item>
          <!-- 计算配置 -->
          <p class="com-tit">{{lang.mf_calc}}</p>
          <div class="three-item">
            <t-form-item :label="`CPU（${lang.cores}）`" name="cpu">
              <t-input v-model="lineForm.cpu" :placeholder="`${lang.input}CPU`" :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.memory}（GB）`" name="memory" :rules="[
          { required: true, message: `${lang.input}${lang.memory}`, type: 'error' },
          {
            pattern: /^([1-9][0-9]*)$/, message: lang.input + lang.verify16, type: 'warning'
          },
          {
            validator: val =>  val >= 1 && val <= 512,
             message: `${lang.input}1-512${lang.verify18}`, type: 'warning'
          }
          ]">
              <t-input v-model="lineForm.memory" :placeholder="`${lang.input}${lang.memory}`"
                :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="`GPU${lang.auth_num}`" name="gpu_num">
              <t-input v-model="lineForm.gpu_num" :placeholder="`${lang.input}GPU${lang.auth_num}`"
                :disabled="isAgent"></t-input>
            </t-form-item>
          </div>
          <t-checkbox v-model="lineForm.due_not_free_gpu" :disabled="isAgent">{{lang.mf_tip47}}</t-checkbox>
          <!-- 网络配置 -->
          <p class="com-tit">{{lang.network_config}}</p>
          <div class="network-box">
            <t-form-item :label="`IPv4${lang.auth_num}`" name="ip_num" :rules="calcReg(`IPv4${lang.auth_num}`,0,2000)">
              <t-input v-model="lineForm.ip_num" :placeholder="`${lang.input}IPv4${lang.auth_num}`"
                :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="`IPv6${lang.auth_num}`" name="ipv6_num"
              :rules="calcReg(`IPv6${lang.auth_num}`,0,2000)">
              <t-input v-model="lineForm.ipv6_num" :placeholder="`${lang.input}IPv6${lang.auth_num}`"
                :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.cloud_flow}（GB）`" name="flow" v-if="calcLineType==='flow'">
              <t-input v-model="lineForm.flow" :placeholder="lang.mf_tip27" :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.bw}（Mbps）`" name="bw">
              <t-input v-model="lineForm.bw" :placeholder="`${lang.input}${lang.bw}`" :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.inflow_bw}（Mbps）`" name="in_bw">
              <t-input v-model="lineForm.in_bw" :placeholder="`${lang.input}${lang.inflow_bw}`"
                :disabled="isAgent"></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.traffic_type}`" class="mem-congfig" name="traffic_type"
              v-if="calcLineType==='flow'">
              <t-select v-model="lineForm.traffic_type" :placeholder="`${lang.select}${lang.traffic_type}`"
                :disabled="isAgent">
                <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in trafficTypes">
                </t-option>
              </t-select>
            </t-form-item>
            <t-form-item :label="lang.mf_tip55" v-if="recommendDefenceName">
              <t-input :value="recommendDefenceName" disabled></t-input>
            </t-form-item>
            <t-form-item :label="`${lang.defence}（Gbps）`" name="peak_defence"
              :rules="lineForm.peak_defence ? dataRules.peak_defence :[{}]" v-else>
              <t-input v-model="lineForm.peak_defence" :placeholder="`${lang.input}${lang.defence}`"
                :disabled="isAgent"></t-input>
            </t-form-item>

          </div>
          <div class="bot-tip">
            <p>{{lang.mf_notes}}</p>
            <p>{{lang.mf_package_tip3}}</p>
            <p>{{lang.mf_package_tip4}}</p>
            <p>{{lang.mf_tip63}}</p>
          </div>
        </div>
        <div class="form-item">
          <p class="com-tit">{{lang.data_center}}</p>
          <t-form-item :label="lang.data_center" class="required data-item">
            <t-form-item name="country_id" :required-mark="false">
              <t-select v-model="lineForm.country_id" class="flow-type" :placeholder="lang.select+lang.country_area"
                filterable @change="changeCountry" :disabled="isAgent"
                :popup-props="{ overlayClassName: `custom-data`, overlayInnerStyle: (trigger) => ({ width: `${trigger.offsetWidth}px` })}">
                <img class="s-icon" :class="{'noIcon': !dataForm.country_id && !lineForm.country_id }" slot="prefixIcon"
                  :src="calcIcon1" />
                <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in countrySelect"
                  class="custom-icon">
                  <img :src="`${host}/upload/common/country/${item.iso}.png`" alt="" class="icon">
                  {{item.name}}
                </t-option>
              </t-select>
            </t-form-item>
            <t-form-item label="" name="city" :required-mark="false">
              <t-select v-model="lineForm.city" class="flow-type" @change="changeCity"
                :placeholder="lang.select+lang.city" :disabled="isAgent">
                <t-option :key="c" :value="city.name" :label="city.name" v-for="(city, c) in calcCity">
                </t-option>
              </t-select>
            </t-form-item>
          </t-form-item>
          <div class="short-item">
            <t-form-item :label="lang.available_area" name="data_center_id">
              <t-select v-model="lineForm.data_center_id" class="flow-type" :disabled="isAgent"
                :placeholder="lang.select+lang.area">
                <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in calcArea">
                </t-option>
              </t-select>
            </t-form-item>
            <t-form-item :label="lang.line_name" name="line_id">
              <t-select v-model="lineForm.line_id" class="flow-type" @change="changeBillType"
                :placeholder="lang.select+lang.line_name" :disabled="isAgent">
                <t-option :key="line.id" :value="line.id" :label="line.name" v-for="line in calcSelectLine">
                </t-option>
              </t-select>
            </t-form-item>
          </div>
          <!-- 存储配置 -->
          <p class="com-tit">{{lang.mf_store}}</p>
          <div class="short-item store-config">
            <div class="short-item">
              <t-form-item :label="`${lang.system_disk_size}（GB）`" class="data-item required">
                <t-form-item label="" name="system_disk_size" :required-mark="false">
                  <t-input v-model="lineForm.system_disk_size" :disabled="isAgent"
                    :placeholder="`${lang.input}${lang.system_disk_size}`"></t-input>
                </t-form-item>
                <t-form-item label="">
                  <t-input v-model="lineForm.system_disk_type" :disabled="isAgent"
                    :placeholder="`${lang.system_disk_size}${lang.type}${multiliTip}`"></t-input>
                </t-form-item>
              </t-form-item>
            </div>
            <div class="short-item">
              <t-form-item :label="`${lang.data_disk}（GB）`" class="data-item">
                <t-form-item label="" name="data_disk_size"
                  :rules="lineForm.data_disk_size ? dataRules.data_disk_size :[{}]">
                  <t-input v-model="lineForm.data_disk_size" :disabled="isAgent"
                    :placeholder="`${lang.input}${lang.data_disk}`"></t-input>
                </t-form-item>
                <t-form-item label="">
                  <t-input v-model="lineForm.data_disk_type" :placeholder="`${lang.data_disk}${lang.type}${multiliTip}`"
                    :disabled="isAgent"></t-input>
                </t-form-item>
              </t-form-item>
            </div>
          </div>
          <!-- 价格配置 -->
          <p class="com-tit">{{lang.price_config}}</p>
          <t-form-item :label="lang.price">
            <div class="price-box">
              <div class="item" v-for="(item,index) in lineForm.price" :key="item.id">
                <p class="txt">{{item.name}}</p>
                <p class="num">
                  <!-- 循环验证 -->
                  <t-form-item :name="`price[${index}].price`" label-align="left"
                    :ruels="[ item.price * 1 ? dataRules.price : {required: true} ]">
                    <t-input v-model="item.price" :placeholder="lang.input+lang.money"
                      @blur="blurPackagePrice($event,index)"></t-input>
                  </t-form-item>
                </p>
              </div>
              <!-- 自动填充 -->
              <div class="item">
                <p class="txt"></p>
                <p class="num"><t-button size="small" :disabled="isShowFill(lineForm.price)"
                    @click="autoFill('lineForm',lineForm.price)">{{lang.autofill}}</t-button>
                </p>
              </div>
            </div>
          </t-form-item>
          <template v-if="!isAgent">
            <!-- 试用设置 -->
            <p class="com-tit">{{lang.ontrial_text1}}</p>
            <div class="short-item store-config">
              <div class="short-item">
                <div class="ontrial-open">
                  <span>{{lang.ontrial_text4}}</span>
                  <t-switch :custom-value="[1,0]" v-model="lineForm.ontrial">
                  </t-switch>
                </div>
                <t-form-item :label="lang.ontrial_text20" v-show="lineForm.ontrial === 1">
                  <t-input-number v-model="lineForm.ontrial_price" :placeholder="lang.ontrial_text20" theme="normal"
                    :min="0" :decimal-places="2">
                  </t-input-number>
                </t-form-item>
              </div>
              <div class="short-item">
                <div class="ontrial-open">
                  <span>{{lang.ontrial_text21}}</span>
                  <t-switch :custom-value="[1,0]" v-model="lineForm.ontrial_stock_control">
                  </t-switch>
                </div>
                <t-form-item :label="lang.ontrial_text21" v-show="lineForm.ontrial_stock_control === 1">
                  <t-input-number v-model="lineForm.ontrial_qty" :placeholder="lang.ontrial_text21" theme="normal"
                    :min="0" :decimal-places="0">
                  </t-input-number>
                </t-form-item>
              </div>
            </div>
          </template>
          <div class="com-f-btn">
            <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
            </t-button>
            <t-button theme="default" variant="base" @click="recommendModel = false">{{lang.cancel}}</t-button>
          </div>
        </div>
      </t-form>
    </t-dialog>
    <!-- 升降级范围 -->
    <t-dialog :header="lang.upgrade_range" :visible.sync="upgradeModel" :footer="false" width="710"
      :close-on-overlay-click="false" @close="closeUpgradeRange">
      <t-table row-key="id" :data="recommendList" size="medium" :columns="upgradeColumns" :hover="hover"
        :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
        :hide-sort-tips="true" :max-height="345">
        <template #price="{row}">
          <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span>
          <template v-if="row.duration">/{{row.duration}}</template>
          &nbsp;{{lang.rise}}
        </template>
        <template #range="{row, rowIndex}">
          <t-cascader v-model="row.temp" :options="calcRangeSelect(row.data_center_id, row.id)" :min-collapsed-num="1"
            :keys="{label: 'name', value: 'id'}" multiple
            @change="($event,$node) => changeRange($event, $node, rowIndex)" v-if="upgradeModel" />
        </template>
      </t-table>
      <div class="bot-tip">
        <p>*{{lang.mf_package_tip5}}</p>
        <p>*{{lang.mf_package_tip7}}</p>
        <p>*{{lang.mf_package_tip9}}</p>
      </div>
      <div class="com-f-btn" style="margin-top: 20px;">
        <t-button theme="primary" @click="saveUpgrade" :loading="submitLoading" :disabled="isAgent">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="closeUpgradeRange">{{lang.cancel}}</t-button>
      </div>
    </t-dialog>
    <!-- 新增/修改 配置限制 -->
    <t-dialog :header="comTitle" :visible.sync="limitModel" :footer="false" :width="isEn ? 800 : 680" @close="closeData"
      class="limit-dialog">
      <div class="top-info">
        <p class="tit">{{lang.mf_choose_config}}</p>
        <p class="s-tip">{{lang.mf_choose_tip}}</p>
      </div>
      <t-form :data="limitForm" ref="limitForm" @submit="submitLimit" :rules="limitRules" class="data-form limit-form"
        v-if="limitModel" label-width="120px">
        <!-- 条件 -->
        <div class="limit-item">
          <p>{{lang.mf_condition}}：</p>
          <div class="check-box">
            <t-checkbox-group v-model="ruleLimit">
              <t-checkbox :key="item.type" :value="item.type" :label="item.name" v-for="item in calcCheckbox"
                :disabled="disabeldCheck('rule',item.type)">
              </t-checkbox>
            </t-checkbox-group>
          </div>
          <t-form-item :label="lang.data_center" class="required limit-bw" v-if="showLimitItem('rule','data_center')">
            <t-select v-model="limitForm.rule.data_center.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <t-form-item name="rule.data_center.id">
              <t-select v-model="limitForm.rule.data_center.id" class="flow-type"
                :placeholder="lang.select+lang.data_center" multiple :min-collapsed-num="1" clearable>
                <t-option :key="item.id" :value="item.id" :label="`${item.country_name}-${item.city}-${item.area}`"
                  v-for="item in dataList">
                </t-option>
              </t-select>
            </t-form-item>
          </t-form-item>
          <!-- cpu -->
          <t-form-item :label="`CPU（${lang.cores}）`" class="required limit-bw" v-if="showLimitItem('rule','cpu')">
            <t-select v-model="limitForm.rule.cpu.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <t-form-item name="rule.cpu.value">
              <t-select v-model="limitForm.rule.cpu.value" :placeholder="lang.select+'CPU'" multiple
                :min-collapsed-num="1">
                <t-option :key="area.id" :value="area.value" :label="calcLabel('cpu', area.value)"
                  v-for="area in cpuList">
                  {{area.value}}{{lang.cores}}
                </t-option>
              </t-select>
            </t-form-item>
          </t-form-item>
          <!-- 内存 -->
          <t-form-item :label="`${lang.memory}（${memory_unit}）`" class="required limit-bw"
            v-if="showLimitItem('rule','memory')">
            <t-select v-model="limitForm.rule.memory.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <template v-if="memoryList[0]?.value">
              <t-select v-model="limitForm.rule.memory.value" :placeholder="`${lang.select}${lang.memory}`" multiple
                :min-collapsed-num="1" clearable>
                <t-option :key="area.id" :value="area.value" v-for="area in memoryList"
                  :label="calcLabel('memory',area.value)">
                  {{area.value}}{{memory_unit}}
                </t-option>
              </t-select>
            </template>
            <template v-else>
              <t-form-item lable="" name="rule.memory.min" :required-mark="false"
                :rules="calcReg(lang.memory, 0, 99999999)">
                <t-input-number v-model="limitForm.rule.memory.min" :placeholder="lang.min_value" :min="0"
                  :max="99999999" theme="normal" :decimal-places="0" :title="lang.max_value_tip"
                  @blur="changeLimitRange($event,'memory','min', 'rule')">
                </t-input-number>
              </t-form-item>
              <t-form-item lable="" name="rule.memory.max" :required-mark="false"
                :rules="[ limitForm.rule.memory.max === '' ? {} : calcReg(lang.memory, 1, 99999999) ]">
                <t-input-number v-model="limitForm.rule.memory.max" :placeholder="lang.max_value_tip" theme="normal"
                  :decimal-places="0" @blur="changeLimitRange($event,'memory','max','rule')"></t-input-number>
              </t-form-item>
            </template>
          </t-form-item>
          <t-form-item :label="lang.opt_system" class="required limit-bw" v-if="showLimitItem('rule','image')">
            <t-select v-model="limitForm.rule.image.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <t-form-item name="rule.image.id">
              <t-cascader :placeholder="lang.select+lang.opt_system" v-model="limitForm.rule.image.id"
                :options="calcCascadeImage" multiple clearable :min-collapsed-num="1"
                :keys="{ label: 'name', value: 'id' }">
              </t-cascader>
            </t-form-item>
          </t-form-item>
        </div>
        <!-- 结果 -->
        <div class="limit-item result-con" v-show="ruleLimit.length > 0">
          <p>{{lang.mf_result}}：</p>
          <div class="check-box">
            <t-checkbox-group v-model="resultLimit">
              <t-checkbox :key="item.type" :value="item.type" :label="item.name" v-for="item in calcResultCheckbox"
                :disabled="disabeldCheck('result',item.type)">
              </t-checkbox>
            </t-checkbox-group>
          </div>
          <!-- cpu -->
          <t-form-item :label="`CPU（${lang.cores}）`" class="required limit-bw" v-if="showLimitItem('result','cpu')">
            <div class="result-item" v-for="(item,index) in limitForm.result.cpu" :key="index">
              <t-select v-model="limitForm.result.cpu[index].opt" class="short"
                :disabled="limitForm.result.cpu.length > 1">
                <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
                <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
              </t-select>
              <t-form-item :name="`result.cpu[${index}].value`">
                <t-select v-model="limitForm.result.cpu[index].value" :placeholder="lang.select+'CPU'" multiple
                  :min-collapsed-num="1" clearable>
                  <t-option :key="area.id" :value="area.value" :label="calcLabel('cpu', area.value)"
                    v-for="area in cpuList">
                    {{area.value}}{{lang.cores}}
                  </t-option>
                </t-select>
              </t-form-item>
              <t-icon name="minus-circle" class="sub" @click="subResult('cpu', index)"></t-icon>
              <t-icon name="add-circle" @click="addResult('cpu')"
                v-show="index === limitForm.result.cpu.length - 1"></t-icon>
            </div>
            <t-icon name="add-circle" @click="addResult('cpu')" v-show="limitForm.result.cpu.length === 0"></t-icon>
          </t-form-item>
          <!-- 内存 -->
          <t-form-item :label="`${lang.memory}（${memory_unit}）`" class="required limit-bw"
            v-if="showLimitItem('result','memory')">
            <div class="result-item" v-for="(item,index) in limitForm.result.memory" :key="index">
              <t-select v-model="limitForm.result.memory[index].opt" class="short"
                :disabled="limitForm.result.memory.length > 1">
                <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
                <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
              </t-select>
              <template v-if="memoryList[0].type !== 'radio'">
                <t-form-item lable="" :name="`result.memory[${index}].min`" :required-mark="false"
                  :rules="calcReg(lang.memory, 0, 99999999)" class="range-memory">
                  <t-input-number v-model="limitForm.result.memory[index].min" :placeholder="lang.min_value" :min="0"
                    :max="99999999" theme="normal" :decimal-places="0" :title="lang.max_value_tip"
                    @blur="changeLimitRange($event,'memory','min','result', index)">
                  </t-input-number>
                </t-form-item>
                <t-form-item lable="" :name="`result.memory[${index}].max`" :required-mark="false" class="range-memory"
                  :rules="[ limitForm.result.memory[index].max === '' ? {} : calcReg(lang.memory, 1, 99999999) ]">
                  <t-input-number v-model="limitForm.result.memory[index].max" :placeholder="lang.max_value_tip"
                    theme="normal" :decimal-places="0"
                    @blur="changeLimitRange($event,'memory','max', 'result', index)"></t-input-number>
                </t-form-item>
              </template>
              <t-form-item :name="`result.memory[${index}].value`" v-else>
                <t-select v-model="limitForm.result.memory[index].value" :placeholder="`${lang.select}${lang.memory}`"
                  multiple :min-collapsed-num="1" clearable>
                  <t-option :key="area.id" :value="area.value" v-for="area in memoryList"
                    :label="calcLabel('memory',area.value)">
                    {{area.value}}{{memory_unit}}
                  </t-option>
                </t-select>
              </t-form-item>
              <t-icon name="minus-circle" class="sub" @click="subResult('memory', index)"></t-icon>
              <t-icon name="add-circle" @click="addResult('memory')"
                v-show="index === limitForm.result.memory.length - 1"></t-icon>
            </div>
            <t-icon name="add-circle" @click="addResult('memory')"
              v-show="limitForm.result.memory.length === 0"></t-icon>
          </t-form-item>
          <!-- 操作系统 -->
          <t-form-item :label="lang.opt_system" class="required limit-bw" v-if="showLimitItem('result','image')">
            <div class="result-item" v-for="(item,index) in limitForm.result.image" :key="index">
              <t-select v-model="limitForm.result.image[index].opt" class="short"
                :disabled="limitForm.result.image.length > 1">
                <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
                <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
              </t-select>
              <t-form-item :name="`result.image[${index}].id`">
                <t-cascader :placeholder="lang.select+lang.opt_system" v-model="limitForm.result.image[index].id"
                  :options="calcCascadeImage" multiple clearable :min-collapsed-num="1"
                  :keys="{ label: 'name', value: 'id' }">
                </t-cascader>
              </t-form-item>
              <t-icon name="minus-circle" class="sub" @click="subResult('image', index)"></t-icon>
              <t-icon name="add-circle" @click="addResult('image')"
                v-show="index === limitForm.result.image.length - 1"></t-icon>
            </div>
            <t-icon name="add-circle" @click="addResult('image')" v-show="limitForm.result.image.length === 0"></t-icon>
          </t-form-item>

          <!-- 系统盘 -->
          <t-form-item :label="`${lang.system_disk_size}`" class="required limit-bw"
            v-if="showLimitItem('result','system_disk')">
            <div class="result-item" v-for="(item,index) in limitForm.result.system_disk" :key="index">
              <t-select v-model="limitForm.result.system_disk[index].opt" class="short"
                :disabled="limitForm.result.system_disk.length > 1">
                <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
                <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
              </t-select>
              <t-form-item lable="" :name="`result.system_disk[${index}].min`" :required-mark="false"
                :rules="calcReg(lang.system_disk_size, 1, 1048576)" class="range-memory">
                <t-input-number v-model="limitForm.result.system_disk[index].min" :placeholder="lang.min_value" :min="1"
                  :max="1048576" theme="normal" :decimal-places="0"
                  @blur="changeLimitRange($event,'system_disk','min','result', index , 1048576)">
                </t-input-number>
              </t-form-item>
              <t-form-item lable="" :name="`result.memory[${index}].max`" :required-mark="false" class="range-memory"
                :rules="[ limitForm.result.system_disk[index].max === '' ? {} : calcReg(lang.system_disk_size, 1, 1048576) ]">
                <t-input-number v-model="limitForm.result.system_disk[index].max" :placeholder="lang.max_value_tip"
                  theme="normal" :decimal-places="0" :title="lang.max_value_tip"
                  @blur="changeLimitRange($event,'system_disk','max', 'result', index , 1048576)">
                </t-input-number>
              </t-form-item>
              <t-icon name="minus-circle" class="sub" @click="subResult('system_disk', index)"></t-icon>
              <t-icon name="add-circle" @click="addResult('system_disk')"
                v-show="index === limitForm.result.system_disk.length - 1">
              </t-icon>
            </div>
            <t-icon name="add-circle" @click="addResult('system_disk')"
              v-show="limitForm.result.system_disk.length === 0">
            </t-icon>
          </t-form-item>
        </div>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading"
            :disabled="ruleLimit.length < 1 || resultLimit.length < 1">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="limitModel = false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 删除提示框 -->
    <t-dialog theme="warning" :header="delTit" :visible.sync="delVisible" class="deleteDialog">
      <p class="des" v-if="delType==='cycle'">{{lang.delete_tip}}</p>
      <p class="des" v-if="delType==='recommend'">{{lang.mf_tip41}}</p>
      <template slot="footer">
        <t-button theme="primary" @click="sureDelete" :loading="submitLoading">{{lang.sure}}</t-button>
        <t-button theme="default" @click="delVisible = false">{{lang.cancel}}</t-button>
      </template>
    </t-dialog>

    <t-dialog theme="warning" :header="isLocalSystem ? lang.get_system : lang.get_local_system"
      :visible.sync="pullOsVisible" class="deleteDialog">
      <div>
        {{lang.get_local_system_tip1}}{{isLocalSystem ? lang.get_local_system_tip3 :
        lang.get_local_system_tip2}},{{lang.get_local_system_tip4}}{{isLocalSystem
        ? lang.get_local_system_tip2 :
        lang.get_local_system_tip3}}{{lang.get_local_system_tip5}}<span
          style="color: var(--td-error-color);">{{lang.get_local_system_tip6}}</span>{{lang.get_local_system_tip7}}
        <span style="color: var(--td-error-color);">{{isLocalSystem ? lang.get_local_system_tip9 :
          lang.get_local_system_tip8}}</span>
      </div>
      <template slot="footer">
        <t-button theme="primary" @click="surePullOs" :loading="pullOsLoading">{{lang.sure}}</t-button>
        <t-button theme="default" @click="pullOsVisible=false">{{lang.cancel}}</t-button>
      </template>
    </t-dialog>
  </com-config>
</div>
<script src="/plugins/server/mf_cloud/template/admin/lang/index.js"></script>
<script src="/plugins/server/mf_cloud/template/admin/api/mf_cloud.js"></script>
<script src="/plugins/server/mf_cloud/template/admin/js/mf_cloud.js"></script>
