<!-- 统计图表 -->
<!-- 页面独有样式 -->
<link rel="stylesheet" href="/plugins/server/mf_dcim/template/clientarea/pc/mf401/css/dcimDetail.css">

<div class="template" id="product_detail_cloud" :class="{'is-en': isEn}">
  <div id="mainLoading" class="pro-des" v-if="initLoading">
    <div class="ddr ddr1"></div>
    <div class="ddr ddr2"></div>
    <div class="ddr ddr3"></div>
    <div class="ddr ddr4"></div>
    <div class="ddr ddr5"></div>
  </div>
  <div class="main-card">
    <!-- top -->
    <div class="com-card-top">
      <div class="left-info">
        <i class="el-icon-back back-img" @click="goBack"></i>
        <span class="top-product-name">{{hostData.product_name}}</span>
        <span class="top-area">
          <img class="country-img" :src="'/upload/common/country/' + cloudData.data_center.iso +'.png'" />
          <span class="country">{{cloudData.data_center.country_name}}</span>
          <span class="city">{{cloudData.data_center.city}}</span>
        </span>
        <span class="line">|</span>
        <span class="ip">
          {{ipDetails.dedicate_ip}}
          <el-popover placement="top" trigger="hover" v-if="ipDetails.ip_num > 1">
            <div class="ips">
              <p v-for="(item,index) in allIp" :key="index">
                {{item}}
                <i class="el-icon-document-copy base-color" @click="copyIp(item)"></i>
              </p>
            </div>
            <span slot="reference" class="base-color">
              ({{ipDetails.ip_num}})
            </span>
          </el-popover>
          <i class="el-icon-document-copy base-color" v-if="ipDetails.ip_num > 0" @click="copyIp(allIp)"></i>
        </span>
        <host-status :id="id" :status="hostData.status">
          <div class="host-status" @click="goPay" :class="hostData.status">
            {{hostData.status_name}}
          </div>
        </host-status>

      </div>
      <div class="right-opt" v-if="hostData.status === 'Active'">
        <!-- 控制台 -->
        <el-button class="item-top-btn" @click="getVncUrl" :loading="loading4"
          :disabled="cloudConfig.manual_resource_control_mode === 'not_support'">
          {{lang.common_cloud_btn11}}
        </el-button>
        <!-- 基础操作 -->
        <el-dropdown split-button size="small" @click="handleBaseClick" @command="chooseItem" class="drop">
          {{status === 'on' ? lang.common_cloud_text11 : lang.common_cloud_text10}}
          <el-dropdown-menu slot="dropdown">
            <el-dropdown-item v-for="item in powerList" :command="item.value"
              :key="item.value">{{item.label}}</el-dropdown-item>
          </el-dropdown-menu>
        </el-dropdown>
        <!-- 其他操作 -->
        <el-dropdown size="small" @command="changeOpt" class="drop">
          <el-button>
            {{lang.mf_more_opt}}
            <i class="el-icon-arrow-down el-icon--right"></i>
          </el-button>
          <el-dropdown-menu slot="dropdown">
            <el-dropdown-item v-for="item in otherOptArr" :key="item.value" :disabled="item.disabled"
              :command="item.value">{{item.label}}</el-dropdown-item>
          </el-dropdown-menu>
        </el-dropdown>
      </div>
    </div>
    <div class="refund-msg" v-if="isRefundPlugin">
      <!-- 停用成功 -->
      <div class="refund-success" v-if="refundData && refundData.status == 'Suspending'">
        ({{lang.common_cloud_tip6}}{{refundData.create_time |
        formateTime}}{{lang.common_cloud_tip7}}
        {{refundData.type=='Expire'?lang.common_cloud_tip8:lang.common_cloud_tip9}}，{{lang.common_cloud_tip13}}<span
          v-if="refundData.type=='Expire'">{{hostData.due_time |
          formateTime}}</span>{{refundData.type=='Expire'?
        lang.common_cloud_tip10:lang.common_cloud_tip11}}
        {{lang.common_cloud_tip12}})
      </div>
      <!-- 停用失败 -->
      <div class="refund-fail" v-if="refundData && refundData.status == 'Reject'">
        ({{lang.common_cloud_tip6}}{{refundData.create_time |
        formateTime}}{{lang.common_cloud_tip7}}
        {{refundData.type=='Expire'?lang.common_cloud_tip8:lang.common_cloud_tip9}}
        {{lang.common_cloud_tip14}}，
        <el-popover placement="top-start" trigger="hover">
          <span>{{refundData.reject_reason}}</span>
          <span class="reason-text" slot="reference">{{lang.common_cloud_text15}}</span> </el-popover>)
      </div>
    </div>
    <el-tabs class="tabs" v-model="activeName" @tab-click="handleClick" v-show="!initLoading">
      <!-- 概览 -->
      <el-tab-pane :label="lang.overview" name="1" class="overview-box">
        <div class="box">
          <div class="info">
            <div class="top-text">
              <p class="tit">{{lang.mf_cloud_info}}<span class="host">（{{id}} | {{hostData.name}}）</span></p>
            </div>
            <div class="bot-text">
              <div class="item">
                <div class="label">{{lang.mf_cloud_status}}</div>
                <div class="value on-off">
                  <img :src="'/plugins/server/mf_cloud/template/clientarea/pc/mf401/img/cloudDetail/'+status+'.png'"
                    v-show="(status != 'operating') && (status != 'fault') && (status != 'pending')" slot="reference" />
                  <i class="el-icon-loading" v-show="status == 'operating' || status == 'pending'">
                  </i>
                  <img :src="'/plugins/server/mf_cloud/template/clientarea/pc/mf401/img/cloudDetail/'+status+'.png'"
                    v-show="status == 'fault'" />
                  <span class="status">{{statusText}}</span>
                </div>
              </div>
              <div class="item">
                <div class="label">{{lang.mf_belong_area}}</div>
                <div class="value">
                  {{cloudData.data_center.country}}-{{cloudData.data_center.area}}-{{cloudData.data_center.city}}
                </div>
              </div>
              <div class="item">
                <div class="label">{{lang.mf_package_type}}</div>
                <div class="value">{{cloudData.model_config.name}}</div>
              </div>
              <div class="item">
                <div class="label">{{lang.common_cloud_label29}}</div>
                <div class="value">
                  <!-- 有备注 -->
                  <span class="yes-notes" v-if="hostData.notes">
                    <span class="notes-text" :title="hostData.notes">{{hostData.notes}}</span>
                    <i class="el-icon-edit notes-icon" @click="doEditNotes"></i>
                  </span>
                  <!-- 无备注 -->
                  <span class="no-notes" v-else @click="doEditNotes">
                    {{lang.cloud_add_notes + ' +'}}
                  </span>
                </div>
              </div>
              <div class="item specs">
                <div class="label">{{lang.mf_cloud_specs}}</div>
                <div class="value">
                  <p class="s-item">
                    <span class="param" :title="cloudData.model_config?.cpu">
                      CPU-{{cloudData.model_config?.cpu}}
                    </span>
                  </p>
                  <p class="s-item" v-if="cloudData.line?.sync_firewall_rule == 0">
                    <span class="param"
                      :title=" cloudData.peak_defence * 1 ? cloudData.peak_defence + 'G' : lang.no_defense">
                      {{lang.peak_defence}}-<span v-if="cloudData.peak_defence * 1">{{cloudData.peak_defence}}G</span>
                      <span v-else>{{lang.no_defense}}</span>
                    </span>
                  </p>
                  <p class="s-item">
                    <span class="param" :title="cloudData.model_config?.memory">
                      {{lang.common_cloud_text31}}-{{cloudData.model_config?.memory}}
                    </span>
                  </p>
                  <p class="s-item" v-if="cloudData.line?.bill_type === 'flow'">
                    <span class="param">
                      {{lang.mf_flow}} -
                      <span v-if="cloudData.flow !==0">{{cloudData.flow}}G</span>
                      <span v-else>{{lang.mf_tip28}}</span>
                    </span>
                  </p>
                  <p class="s-item" v-else>
                    <span class="param">
                      {{lang.mf_bw}}-{{cloudData.bw === 'NC' ? cloudData.bw_show ? cloudData.bw_show : lang.actual_bw :
                      (cloudData.bw +
                      'Mbps')}}
                    </span>
                  </p>
                  <p class="s-item">
                    <span class="param" :title="cloudData.model_config?.disk">
                      {{lang.mf_disk}}-{{cloudData.model_config?.disk}}
                    </span>
                  </p>
                  <p class="s-item">
                    <span class="param" :title="cloudData.model_config?.gpu">
                      {{lang.mf_gpu}}-{{cloudData.model_config?.gpu}}
                    </span>
                  </p>
                  <p class="s-item">
                    <span class="param">
                      {{lang.common_cloud_title15}}-{{rescueStatusData.ip_num}}{{lang.common_cloud_title43}}
                    </span>
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="info">
            <div class="top-text">
              <p class="tit">{{lang.mf_cloud_info}}</p>
              <div class="right-btn">
                <span @click="copyLoginInfo" v-show="rescueStatusData.username" class="copy-btn"
                  v-if="hostData.status === 'Active'">
                  {{lang.copy_login_info}}
                </span>
              </div>
            </div>
            <div class="bot-text">
              <div class="item">
                <div class="label">{{lang.mf_image_name}}</div>
                <div class="value" :title="cloudData.image?.name">
                  <img v-if="cloudData.image?.icon"
                    :src="`/plugins/server/mf_dcim/template/clientarea/pc/mf401/img/mf_dcim/${cloudData.image?.icon}.svg`"
                    alt="" class="image-icon">
                  {{ cloudData.image?.name}}
                </div>
              </div>
              <div class="item">
                <div class="label">{{lang.common_cloud_label14}}</div>
                <div class="value">{{rescueStatusData.username}}</div>
              </div>
              <div class="item">
                <div class="label">{{lang.login_pass}}</div>
                <div class="value">
                  <span v-show="isShowPass"> {{rescueStatusData.password}} </span>
                  <span v-show="!isShowPass"> {{passHidenCode}} </span>
                  <img class="eyes" :src="isShowPass ? '/plugins/server/mf_dcim/template/clientarea/pc/mf401/img/cloud/pass-show.png':
                    '/plugins/server/mf_dcim/template/clientarea/pc/mf401/img/cloud/pass-hide.png'"
                    @click="isShowPass=!isShowPass" />
                  <i class="el-icon-document-copy copy" @click="copyPass(rescueStatusData.password)"></i>
                </div>
              </div>
              <div class="item">
                <div class="label">{{lang.common_cloud_label13}}</div>
                <div class="value">{{rescueStatusData.port}}</div>
              </div>
              <!-- 商品自定义字段 -->
              <div class="item" v-for="(item,index) in self_defined_field" :key="item.id">
                <div class="label">{{item.field_name}}</div>
                <div class="value">
                  <span v-if="item.field_type === 'password'">
                    <span v-if="!item.hidenPass && item.value">{{item.value.replace(/./g, '*')}}</span>
                    <span v-else>{{item.value || '--'}}</span>
                  </span>
                  <span v-else-if="item.field_type === 'textarea'" class="word-pre">{{item.value ||
                    '--'}}</span>
                  <span v-else>{{item.value || '--'}}</span>
                </div>
                <img class="eyes" v-if="item.field_type === 'password' && item.value" :src="item.hidenPass ? '/plugins/server/mf_cloud/template/clientarea/pc/mf401/img/cloud/pass-show.png' :
                  '/plugins/server/mf_cloud/template/clientarea/pc/mf401/img/cloud/pass-hide.png'"
                  @click="item.hidenPass=! item.hidenPass" />
                <i class="el-icon-document-copy copy"
                  v-if="(item.field_type === 'password' || item.field_type === 'link') && item.value"
                  @click="copyPass(item.value)"></i>
              </div>
              <!-- 手动资源自定义展示字段 -->
              <div class="item" v-for="(item,index) in customManualField" :key="item.id">
                <div class="label" :title="item.name">{{item.name}}</div>
                <div class="value">
                  <span v-if="item.type === 'password' && item.value">
                    <span v-if="!item.hidenPass">{{item.value.replace(/./g, '*')}}</span>
                    <span v-else>{{item.value || '--'}}</span>
                  </span>
                  <span v-else :title="item.value || '--'">{{item.value || '--'}}</span>
                </div>
                <img class="eyes" v-if="item.type === 'password' && item.value" :src="item.hidenPass ? '/plugins/server/mf_cloud/template/clientarea/pc/mf401/img/cloud/pass-show.png' :
                '/plugins/server/mf_cloud/template/clientarea/pc/mf401/img/cloud/pass-hide.png'"
                  @click="changeCustomPassword(item)" />
                <i class="el-icon-document-copy copy" v-if="item.value" @click="copyPass(item.value)"></i>
              </div>
            </div>
          </div>
          <!-- 计费信息 -->
          <div class="info">
            <div class="top-text">
              <p class="tit">{{lang.mf_bill_info}}</p>
              <div class="right-btn">
                <!-- 停用 -->
                <div class="refund" v-if="isRefundPlugin">
                  <span class="refund-status"
                    v-if="refundData && refundData.status != 'Cancelled' && refundData.status != 'Reject'">
                    {{refundStatus[refundData.status]}}
                  </span>
                  <span class="refund-stop-btn s-btn" @click="quitRefund"
                    v-if="refundData && (refundData.status=='Pending' || refundData.status=='Suspend' || refundData.status=='Suspending')">
                    {{lang.common_cloud_btn8}}
                  </span>
                  <span class="refund-btn s-btn" @click="showRefund"
                    v-if="!refundData || (refundData && (refundData.status=='Reject')) || (refundData && (refundData.status=='Cancelled'))">
                    {{lang.common_cloud_btn9}}
                  </span>
                </div>
                <template v-if="isRenewPlugin">
                  <el-button v-show="hostData.status == 'Active' || hostData.status == 'Suspended'"
                    :loading="renewBtnLoading" class="renew-btn s-btn" @click="showRenew"
                    v-if="!refundData || refundData || (refundData && refundData.status=='Cancelled') || (refundData && refundData.status=='Reject')">
                    {{lang.cloud_re_btn}}
                  </el-button>
                  <el-button v-show="hostData.status == 'Active'" class="renew-btn-disable s-btn" v-else
                    disabled>{{lang.cloud_re_btn}}
                  </el-button>
                </template>
                <el-button class="renew-btn s-btn" @click="showUpgrade" v-if="hostData.status === 'Active'">
                  {{lang.common_cloud_btn16}}
                </el-button>
              </div>
            </div>
            <div class="bot-text">
              <!-- <div class="item">
                <div class="label">{{lang.common_cloud_label19}}</div>
                <div class="value">{{hostData.active_time | formateTime}}</div>
              </div> -->
              <div class="item">
                <div class="label">{{lang.common_cloud_label38}}</div>
                <div class="value">
                  {{commonData.currency_prefix + hostData.first_payment_amount +
                  commonData.currency_suffix}}
                  <span @click="applyCashback" class="common-cashback"
                    v-if="isShowCashBtn">{{lang.apply_cashback}}</span>
                </div>
              </div>
              <div class="item">
                <div class="label">{{lang.cloud_creat_time}}</div>
                <div class="value">{{hostData.active_time | formateTime}}</div>
              </div>
              <div class="item">
                <div class="label">{{lang.cloud_table_head_4}}</div>
                <div class="value">{{hostData.due_time | formateTime}}</div>
              </div>
              <div class="item">
                <div class="label">{{lang.mf_renew_time}}</div>
                <div class="value" :class="isRead?'red':''">
                  {{hostData.due_time | formateTime}}
                </div>
                <span>（{{hostData.billing_cycle_name + lang.common_cloud_text17}}）</span>
              </div>
              <div class="item">
                <div class="label">{{lang.mf_renew_money}}</div>
                <div class="value">
                  {{commonData.currency_prefix + showRenewPrice + commonData.currency_suffix}}
                </div>
              </div>
              <div class="item" v-show="hostData.status == 'Active' && isRenewPlugin">
                <div class="label">
                  {{lang.auto_renew}}
                  <el-popover placement="top" trigger="hover">
                    <div class="sure-remind">{{lang.common_cloud_tip15}}</div>
                    <div class="help" slot="reference">?</div>
                  </el-popover>
                </div>
                <div class="value">
                  <!-- <el-switch v-model="isShowPayMsg" active-color="#0052D9" @change="autoRenewChange">
                  </el-switch> -->
                  <auto-renew v-if="hasAutoRenew" :id="id" :is-auto-renew="isShowPayMsg" @update="getRenewStatus">
                  </auto-renew>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 底部图表 -->
        <div class="box">
          <!-- 图表 -->
          <div class="echarts-box info wide">
            <div class="top-text">
              <p class="tit">{{lang.common_cloud_tab1}}</p>
            </div>
            <el-select class="time-select" v-model="chartSelectValue" @change="chartSelectChange">
              <el-option value="1" :label="lang.common_cloud_label15"></el-option>
              <el-option value="2" :label="lang.common_cloud_label16"></el-option>
              <el-option value="3" :label="lang.common_cloud_label17"></el-option>
            </el-select>
            <div class="echart-main">
              <!-- 网络带宽 -->
              <div class="echart-box">
                <div class="top-info">
                  <p class="tit">{{lang.common_cloud_text75}}</p>
                </div>
                <el-empty :description="lang.mf_no_data" v-if="bwData.length === 0"></el-empty>
                <div id="bw-echart" class="my-echart" v-loading="echartLoading"
                  :class="{'hide-chart': bwData.length === 0}"></div>
              </div>
            </div>
          </div>
          <!-- 资源使用信息 -->
          <div class="resource-box info last">
            <div class="top-text">
              <p class="tit">{{lang.mf_resouce_used}}</p>
            </div>
            <div class="used-progress">
              <!-- 流量包 -->
              <div class="item flow" v-if="cloudData.type !== 'hyperv'">
                <div class="l-txt">
                  <span class="tip">
                    {{lang.mf_flow_package}}
                    <el-popover placement="top" trigger="hover" popper-class="physicalPop">
                      <div class="sure-remind">{{lang.common_cloud_label26}}：{{flowData.reset_flow_date}}
                      </div>
                      <i class="el-icon-warning-outline" slot="reference"></i>
                    </el-popover>
                  </span>
                  <span>{{flowData.used}}/{{flowData.total}}</span>
                  <span @click="buyPackage" v-if="flowData.total?.includes('GB') && addonsArr.includes('FlowPacket')"
                    class="buy-flow">
                    {{lang.buy_package}}
                  </span>
                </div>
                <div class="r-progress">
                  <el-progress type="circle"
                    :percentage="(flowData.used_num / flowData.total_num * 100).toFixed(2) * 1 || 0" :stroke-width="2"
                    :width="88" color="#0058FF" v-if="flowData.total_num !== 0">
                  </el-progress>
                  <el-progress type="circle" :format="() => flowData.total" :percentage="0" :stroke-width="2"
                    :width="88" color="#0058FF" v-else>
                  </el-progress>
                  <span class="txt">{{lang.mf_used}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </el-tab-pane>
      <template v-if="hostData.status === 'Active'">
        <el-tab-pane :label="lang.common_cloud_tab4" name="4">
          <div class="net">
            <div class="title">
              <span>{{lang.common_cloud_title3}}</span>
            </div>
            <div class="main_table">
              <el-table v-loading="netLoading" :data="netDataList" style="width: 100%;margin-bottom: .2rem;">
                <el-table-column prop="ip" :label="lang.common_cloud_label21" min-width="200" align="left">
                </el-table-column>
                <el-table-column prop="gateway" width="400" :label="lang.common_cloud_label22" align="left">
                </el-table-column>
                <el-table-column prop="subnet_mask" width="400" :label="lang.common_cloud_label23" align="left">
                </el-table-column>
              </el-table>
              <pagination :page-data="netParams" @sizechange="netSizeChange" @currentchange="netCurrentChange">
              </pagination>
            </div>
          </div>
        </el-tab-pane>
        <el-tab-pane :label="lang.common_cloud_tab6" name="6">
          <div class="log">
            <div class="main_table">
              <el-table v-loading="logLoading" :data="logDataList" style="width: 100%;margin-bottom: .2rem;">
                <el-table-column prop="id" :label="lang.common_cloud_label32" min-width="200" align="left">
                </el-table-column>
                <el-table-column prop="create_time" min-width="200" :label="lang.common_cloud_label33" align="left">
                  <template slot-scope="scope">
                    <span>{{scope.row.create_time | formateTime}}</span>
                  </template>
                </el-table-column>
                <el-table-column prop="description" :label="lang.common_cloud_label34" min-width="300" align="left"
                  :show-overflow-tooltip="true">
                </el-table-column>
              </el-table>
              <pagination :page-data="logParams" @sizechange="logSizeChange" @currentchange="logCurrentChange">
              </pagination>
            </div>
          </div>
        </el-tab-pane>
        <el-tab-pane :label="lang.ip_defase_config" name="ip_defance" v-if="cloudData.line?.sync_firewall_rule == 1">
          <div v-if="activeName === 'ip_defance'">
            <ip-defase module="mf_dcim" :listmode="hostData?.agent ? 'remf_dcim' : 'mf_dcim'" :showip="showIp" :id="id"
              :product_id="product_id" :billing_cycle_time="hostData.billing_cycle_time">
            </ip-defase>
          </div>
        </el-tab-pane>
      </template>
    </el-tabs>
    <!-- 修改备注弹窗 -->
    <div class="notes-dialog">
      <el-dialog width="6.2rem" :visible.sync="isShowNotesDialog" :show-close=false @close="notesDgClose">
        <div class="dialog-title">
          {{hostData.notes?lang.common_cloud_title7:lang.common_cloud_title8}}
        </div>
        <div class="dialog-main">
          <div class="label">{{lang.common_cloud_label29}}</div>
          <el-input class="notes-input" v-model="notesValue"></el-input>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="subNotes">{{lang.common_cloud_btn28}}</div>
          <div class="btn-no" @click="notesDgClose">{{lang.common_cloud_btn29}}</div>
        </div>
      </el-dialog>
    </div>
    <!-- 重装系统弹窗 -->
    <div class="reinstall-dialog">
      <el-dialog width="6.2rem" :visible.sync="isShowReinstallDialog" :show-close=false @close="reinstallDgClose">
        <div class="dialog-title">
          {{lang.common_cloud_title9}}
        </div>
        <div class="dialog-main">
          <div class="label">{{lang.common_cloud_label6}}</div>
          <div class="os-content">
            <!-- 镜像组选择框 -->
            <el-select class="os-select os-group-select" v-model="reinstallData.osGroupId"
              @change="osSelectGroupChange">
              <img class="os-group-img" :src="osIcon" slot="prefix" alt="">
              <el-option v-for="item in calcImageList" :key='item.id' :value="item.id" :label="item.name">
                <div class="option-label">
                  <img class="option-img"
                    :src="'/plugins/server/mf_dcim/template/clientarea/pc/mf401/img/mf_dcim/' + item.name + '.svg'"
                    alt="">
                  <span class="option-text">{{item.name}}</span>
                </div>
              </el-option>
            </el-select>
            <!-- 镜像实际选择框 -->
            <el-select class="os-select" v-model="reinstallData.osId" @change="osSelectChange">
              <el-option v-for="item in osSelectData" :key="item.id" :value="item.id"
                :label="item.name +'-' + commonData.currency_prefix + item.price"></el-option>
            </el-select>
          </div>
          <div class="label">{{lang.common_cloud_label7}}</div>
          <div class="pass-content">
            <el-select class="pass-select" v-model="reinstallData.type">
              <el-option value="pass" :label="lang.common_cloud_label7"></el-option>
            </el-select>
            <el-popover placement="top-start" width="200" trigger="hover" :content="lang.common_cloud_tip33">
              <i class="el-icon-question help-icon" slot="reference"></i>
            </el-popover>
            <el-input class="pass-input" v-model="reinstallData.password" :placeholder="lang.ticket_label12"
              v-show="reinstallData.type=='pass'">
              <div class="pass-btn" slot="suffix" @click="autoPass">{{lang.common_cloud_btn1}}</div>
            </el-input>
            <div class="key-select" v-show="reinstallData.type=='key'">
              <el-select v-model="reinstallData.key">
                <el-option v-for="item in sshKeyData" :key="item.id" :value="item.id"></el-option>
              </el-select>
            </div>
          </div>
          <div class="label">{{lang.common_cloud_label13}}</div>
          <el-input class="pass-input" v-model="reinstallData.port" :placeholder="lang.ticket_label12">
            <div class="pass-btn" slot="suffix" @click="autoPort">{{lang.common_cloud_btn1}}</div>
          </el-input>
          <template v-if="isWindows">
            <div class="label">{{lang.op_tips2}}</div>
            <el-radio-group v-model="reinstallData.part_type">
              <el-radio :label="0">{{lang.op_tips3}}</el-radio>
              <el-radio :label="1">{{lang.op_tips4}}</el-radio>
            </el-radio-group>
          </template>
          <template v-if="cloudConfig.reinstall_sms_verify === 1">
            <div class="label">{{lang.ticket_label19}}</div>
            <el-input class="pass-input" v-model="reinstallData.code" :placeholder="lang.account_tips33">
              <div class="pass-btn" slot="suffix" v-if="isSendCodeing">{{sendTime}}{{lang.account_tips54}}
              </div>
              <div class="pass-btn" slot="suffix" v-loading="sendFlag" @click="sendCode" v-else>
                {{lang.account_tips55}}
              </div>
            </el-input>
          </template>

          <div class="pay-img" v-show="isPayImg">
            {{lang.common_cloud_tip28}},{{commonData.currency_prefix + payMoney + '/次'}}
            <el-popover placement="top-start" width="200" trigger="hover">
              <div class="show-config-list">{{lang.shoppingCar_tip_text2}}：{{commonData.currency_prefix}}{{
                payDiscount }}</div>
              <div class="show-config-list">{{lang.common_cloud_text28}}：{{commonData.currency_prefix}}{{
                payCodePrice
                }}</div>
              <i class="el-icon-warning-outline total-icon" slot="reference" v-if="isShowLevel || isShowPromo"></i>
            </el-popover>

            <span class="img-buy-btn" @click="payImg">{{lang.common_cloud_btn5}}</span>
          </div>

          <div class="alert">
            <el-alert :title="errText" type="error" show-icon :closable="false" v-show="errText">
            </el-alert>

            <div class="remind" v-show="!errText">{{lang.common_cloud_tip29}}</div>
          </div>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="doReinstall">{{lang.common_cloud_btn28}}</div>
          <div class="btn-no" @click="reinstallDgClose">{{lang.common_cloud_btn29}}</div>
        </div>
      </el-dialog>
    </div>
    <!-- 加入安全组 -->
    <el-dialog width="6.8rem" :visible.sync="safeDialogShow" :show-close=false @close="safeClose" class="safe-dialog">
      <div class="dialog-title">{{lang.add_to_group}}</div>
      <div class="dialog-main">
        <div class="safe-main-card">
          <div class="safe-box">
            <span>{{lang.choose_group}}：</span>
            <el-select v-model="safeID">
              <el-option v-for="item in safeOptions" :key="item.id" :label="item.name" :value="item.id">
              </el-option>
            </el-select>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <div class="btn-ok" @click="subAddSafe">{{lang.finance_text70}}</div>
        <div class="btn-no" @click="safeClose">{{lang.finance_text71}}</div>
      </div>
    </el-dialog>
    <!-- 续费弹窗 -->
    <div class="renew-dialog">
      <el-dialog width="6.9rem" :visible.sync="isShowRenew" :show-close=false @close="renewDgClose">
        <div class="dialog-title">
          {{lang.common_cloud_title10}}
        </div>
        <div class="dialog-main">
          <div class="renew-content">
            <div class="renew-item" :class="renewActiveId==item.id?'renew-active':''" v-for="item in renewPageData"
              :key="item.id" @click="renewItemChange(item)">
              <div class="item-top">{{item.customfield?.multi_language?.billing_cycle || item.billing_cycle}}
              </div>
              <div class="item-bottom" v-if="isShowPromo && renewParams.isUseDiscountCode">
                {{commonData.currency_prefix + item.base_price}}
              </div>
              <div class="item-bottom" v-else>{{commonData.currency_prefix + item.price}}</div>
              <div class="item-origin-price" v-if="item.price*1 < item.base_price*1 && !renewParams.isUseDiscountCode">
                {{commonData.currency_prefix + item.base_price}}
              </div>
              <i class="el-icon-check check" v-show="renewActiveId==item.id"></i>
            </div>
          </div>
          <div class="pay-content">
            <div class="pay-price">
              <div class="money" v-loading="renewLoading">
                <span class="text">{{lang.common_cloud_label11}}:</span>
                <span>{{commonData.currency_prefix}}{{renewParams.totalPrice | filterMoney}}</span>
                <el-popover placement="top-start" width="200" trigger="hover"
                  v-if="(isShowLevel && renewParams.clDiscount*1 > 0) || (isShowPromo && renewParams.isUseDiscountCode) || ( isShowCash && renewParams.customfield.voucher_get_id)">
                  <div class="show-config-list">
                    <p v-if="isShowLevel">{{lang.shoppingCar_tip_text2}}：{{commonData.currency_prefix}} {{
                      renewParams.clDiscount | filterMoney}}</p>
                    <p v-if="isShowPromo && renewParams.isUseDiscountCode">
                      {{lang.shoppingCar_tip_text4}}：{{commonData.currency_prefix}} {{
                      renewParams.code_discount |
                      filterMoney }}
                    </p>
                    <p v-if="isShowCash && renewParams.customfield.voucher_get_id">
                      {{lang.common_cloud_text29}}：{{commonData.currency_prefix}} {{ renewParams.cash_discount
                      |
                      filterMoney}}
                    </p>
                  </div>
                  <i class="el-icon-warning-outline total-icon" slot="reference"></i>
                </el-popover>
                <p class="original-price"
                  v-if="renewParams.customfield.promo_code && renewParams.totalPrice != renewParams.base_price">
                  {{commonData.currency_prefix}} {{ renewParams.base_price | filterMoney}}
                </p>
                <p class="original-price"
                  v-if="!renewParams.customfield.promo_code && renewParams.totalPrice != renewParams.original_price">
                  {{commonData.currency_prefix}} {{ renewParams.original_price | filterMoney}}
                </p>
                <div class="code-box">
                  <!-- 代金券 -->
                  <cash-coupon ref="cashRef" v-show="isShowCash && !cashObj.code"
                    :currency_prefix="commonData.currency_prefix" @use-cash="reUseCash" scene='renew'
                    :product_id="[product_id]" :price="renewParams.original_price"></cash-coupon>
                  <!-- 优惠码 -->
                  <discount-code v-show="isShowPromo && !renewParams.customfield.promo_code"
                    @get-discount="getRenewDiscount(arguments)" scene='renew' :product_id="product_id"
                    :amount="renewParams.base_price" :billing_cycle_time="renewParams.duration"></discount-code>
                </div>
                <div class="code-number-text">
                  <div class="discount-codeNumber" v-show="renewParams.customfield.promo_code">{{
                    renewParams.customfield.promo_code }}<i class="el-icon-circle-close remove-discountCode"
                      @click="removeRenewDiscountCode()"></i></div>
                  <div class="cash-codeNumber" v-show="cashObj.code">{{ cashObj.code }}<i
                      class="el-icon-circle-close remove-discountCode" @click="reRemoveCashCode()"></i></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="subRenew">{{lang.common_cloud_btn30}}</div>
          <div class="btn-no" @click="renewDgClose">{{lang.common_cloud_btn29}}</div>
        </div>
      </el-dialog>
    </div>
    <!-- 新增VPC网络 -->
    <el-dialog width="6.8rem" :visible.sync="isShowAddVpc" :show-close=false @close="addVpcClose" class="addVpc-dialog">
      <div class="dialog-title">{{lang.common_cloud_title20}}</div>
      <div class="dialog-main">
        <div class="vpc-main-card">
          <div class="vpc-item">
            <span class="vpc-leabel">{{lang.common_cloud_title32}}：</span>
            <span class="vpc-value">{{vpcName}}</span>
          </div>
          <div class="vpc-item">
            <span class="vpc-leabel">{{lang.common_cloud_title33}}：</span>
            <el-select v-model="plan_way" class="w-select">
              <el-option :value="0" :label="lang.auto_plan"></el-option>
              <el-option :value="1" :label="lang.custom"></el-option>
            </el-select>
          </div>
          <div class="vpc-item" v-if="plan_way === 1">
            <span class="vpc-leabel">{{lang.common_cloud_title34}}：</span>
            <div class="vpc">
              <!-- 自定义vpc -->
              <div class="custom">
                <el-select v-model="vpc_ips.vpc1.value" @change="changeVpcIp">
                  <el-option v-for="item in vpc_ips.vpc1.select" :key="item" :label="item" :value="item">
                  </el-option>
                </el-select>
                <span>·</span>
                <el-tooltip :content="vpc_ips.vpc1.tips" placement="top" effect="light">
                  <el-input-number :disabled="vpc_ips.vpc1.value === 192" v-model="vpc_ips.vpc2" :step="1"
                    :controls="false" :min="vpc_ips.min" :max="vpc_ips.max"></el-input-number>
                </el-tooltip>
                <span class="mr-5 ml-5">·</span>
                <el-tooltip :content="vpc_ips.vpc3Tips" placement="top" effect="light" :disabled="!vpc_ips.vpc3Tips">
                  <el-input-number :disabled="vpc_ips.vpc6.value === 16" @blur="changeVpc3" v-model="vpc_ips.vpc3"
                    :step="1" :controls="false" :min="0" :max="255">
                  </el-input-number>
                </el-tooltip>
                <span class="mr-5 ml-5">·</span>
                <el-tooltip :content="vpc_ips.vpc4Tips" placement="top" effect="light" :disabled="!vpc_ips.vpc4Tips">
                  <el-input-number :disabled="vpc_ips.vpc6.value < 25" @blur="changeVpc4" v-model="vpc_ips.vpc4"
                    :step="1" :controls="false" :min="0" :max="255">
                  </el-input-number>
                </el-tooltip>
                <span class="mr-5 ml-5">/</span>
                <el-select v-model="vpc_ips.vpc6.value" style="width: 70px" @change="changeVpcMask">
                  <el-option v-for="item in vpc_ips.vpc6.select" :key="item" :label="item" :value="item">
                  </el-option>
                </el-select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <div class="btn-ok" @click="subAddVpc">{{lang.subaccount_text31}}</div>
        <div class="btn-no" @click="addVpcClose">{{lang.subaccount_text32}}</div>
      </div>
    </el-dialog>
    <!-- 分配主机 -->
    <el-dialog width="6.8rem" :visible.sync="isShowengine" :show-close=false @close="engineClose" class="engine-dialog">
      <div class="dialog-title">{{lang.common_cloud_title35}}</div>
      <div v-loading="isSubmitEngine">
        <div class="dialog-main">
          <div class="label">{{lang.common_cloud_title36}}</div>
          <div class="engine-main-card">
            <div class="engine-box">
              <span>{{lang.common_cloud_title37}}：</span>
              <el-select v-model="engineID" clearable filterable remote reserve-keyword
                :placeholder="lang.common_cloud_title38" :remote-method="remoteMethod" :loading="engineSearchLoading">
                <el-option v-for="item in productOptions" :key="item.id" :label="item.name" :value="item.id">
                </el-option>
              </el-select>
            </div>
          </div>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="subAddEngine">{{lang.subaccount_text31}}</div>
          <div class="btn-no" @click="engineClose">{{lang.subaccount_text32}}</div>
        </div>
      </div>
    </el-dialog>
    <!-- 新增附加IP -->
    <el-dialog width="6.8rem" :visible.sync="isShowIp" :show-close=false @close="ipClose" class="ip-dialog">
      <div class="dialog-title">{{lang.common_cloud_title3}}</div>
      <div class="dialog-main">
        <div class="label">{{lang.common_cloud_title40}} {{netDataList.length}}
          {{lang.common_cloud_title43}},{{lang.common_cloud_title45}}
        </div>
        <div class="ip-main-card">
          <div class="ip-item" :class="ipValue === item.value ? 'active' : ''" v-for="item in ipValueData"
            :key="item.value" @click="selectIpValue(item.value)">
            {{item.value}} {{lang.common_cloud_title43}}
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <span class="text">{{lang.common_cloud_title44}}:</span>
        <span class="num" v-loading="ipPriceLoading">
          {{commonData.currency_prefix}}{{ipMoney >=0 ? ipMoney : 0}}
          <el-popover placement="top-start" width="200" trigger="hover">
            <div class="show-config-list">{{lang.common_cloud_text27}}：{{commonData.currency_prefix}}{{
              ipDiscountkDisPrice }}</div>
            <div class="show-config-list">{{lang.common_cloud_text28}}：{{commonData.currency_prefix}}{{
              ipCodePrice }}
            </div>
            <i class="el-icon-warning-outline total-icon" slot="reference" v-if="isShowLevel || isShowPromo"></i>
          </el-popover>
        </span>
        <div class="btn-ok" @click="subAddIp">{{lang.finance_text74}}</div>
        <div class="btn-no" @click="ipClose">{{lang.finance_text75}}</div>
      </div>
    </el-dialog>
    <!-- 停用弹窗（删除实例） -->
    <div class="refund-dialog">
      <el-dialog width="6.8rem" :visible.sync="isShowRefund" :show-close=false @close="refundDgClose">
        <div class="dialog-title">
          {{refundPageData.allow_refund == 1?lang.common_cloud_title11:lang.common_cloud_title12}}
        </div>
        <div class="dialog-main">
          <div class="label">{{lang.common_cloud_label35}}</div>
          <div class="host-content">
            <div class="host-item">
              <div class="left">{{lang.common_cloud_label36}}:</div>
              <div class="right">
                <div class="right-row">
                  <div class="right-row-item">CPU：{{cloudData.model_config?.cpu}}</div>
                  <div class="right-row-item">{{lang.common_cloud_text286}}：{{cloudData.model_config?.memory}}
                  </div>
                  <div class="right-row-item">{{lang.mf_system}}：{{cloudData.model_config?.disk}}</div>
                  <div class="right-row-item">{{lang.common_cloud_text288}}：{{cloudData.bw}} M </div>
                </div>
              </div>
            </div>
            <div class="host-item">
              <div class="left">{{lang.common_cloud_label37}}:</div>
              <div class="right">{{refundPageData.host.create_time | formateTime}}</div>
            </div>
            <div class="host-item" v-if="refundPageData.allow_refund == 1">
              <div class="left">{{lang.common_cloud_label38}}:</div>
              <div class="right">{{commonData.currency_prefix + refundPageData.host.first_payment_amount}}
              </div>
            </div>
          </div>
          <div class="label">{{lang.common_cloud_label39}}</div>
          <el-select v-if="refundPageData.reason_custom == 0" v-model="refundParams.suspend_reason" multiple>
            <el-option v-for="item in refundPageData.reasons" :key="item.id" :value="item.id"
              :label="item.content"></el-option>
          </el-select>
          <el-input v-else v-model="refundParams.suspend_reason"></el-input>
          <div class="label">{{lang.common_cloud_label40}}</div>
          <el-select v-model="refundParams.type">
            <el-option value="Expire" :label="lang.common_cloud_label41"></el-option>
            <el-option value="Immediate" :label="lang.common_cloud_label42"></el-option>
          </el-select>
          <div class="label" v-if="refundPageData.allow_refund == 1">{{lang.common_cloud_label43}}</div>
          <div class="amount-content" v-if="refundPageData.allow_refund == 1">
            {{commonData.currency_prefix}}{{refundParams.type=='Immediate'?refundPageData.host.amount:'0.00'}}
          </div>
        </div>
        <div class="dialog-footer">
          <span class="refund-tip" v-show="refundPageData.allow_refund === 0">{{lang.refund_tip}}</span>
          <div style="display: flex;">
            <div class="btn-ok" @click="subRefund">{{refundPageData.allow_refund == 1? lang.common_cloud_btn31:
              lang.common_cloud_btn32}}</div>
            <div class="btn-no" @click="refundDgClose">{{lang.common_cloud_btn29}}</div>
          </div>
        </div>
      </el-dialog>
    </div>
    <!-- 重置密码弹窗 -->
    <div class="repass-dialog">
      <el-dialog width="6.8rem" :visible.sync="isShowRePass" :show-close=false @close="rePassDgClose">
        <div class="dialog-title">
          {{lang.common_cloud_title13}}
          <span class="second-title">{{lang.common_cloud_text23}}</span>
        </div>
        <div class="dialog-main">
          <div class="label">
            {{lang.common_cloud_label7}}
            <el-popover placement="top-start" width="200" trigger="hover" :content="lang.common_cloud_tip33">
              <i class="el-icon-question" slot="reference"></i>
            </el-popover>
          </div>
          <el-input class="pass-input" v-model="rePassData.password" :placeholder="lang.ticket_label12">
            <div class="pass-btn" slot="suffix" @click="autoPass">{{lang.common_cloud_btn1}}</div>
          </el-input>

          <el-input style="margin-top: 0.2rem;" class="pass-input" v-model="rePassData.code"
            :placeholder="lang.account_tips33" v-if="cloudConfig.reset_password_sms_verify === 1">
            <div class="pass-btn" slot="suffix" v-if="isSendCodeing">{{sendTime}}{{lang.account_tips54}}</div>
            <div class="pass-btn" slot="suffix" v-loading="sendFlag" @click="sendCode" v-else>
              {{lang.account_tips55}}
            </div>
          </el-input>

          <div class="alert" v-show="powerStatus=='off'">
            <div class="title">{{lang.common_cloud_tip30}}</div>
            <div class="row"><span class="dot"></span> {{lang.common_cloud_tip31}}</div>
            <div class="row"><span class="dot"></span> {{lang.common_cloud_tip32}}
            </div>
          </div>
          <el-checkbox v-model="rePassData.checked"
            v-show="powerStatus=='off'">{{lang.common_cloud_text24}}</el-checkbox>
          <div class="alert-err-text">
            <el-alert :title="errText" type="error" show-icon :closable="false" v-show="errText">
            </el-alert>
          </div>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="rePassSub" v-loading="loading5">{{lang.common_cloud_btn28}}</div>
          <div class="btn-no" @click="rePassDgClose">{{lang.common_cloud_btn29}}</div>
        </div>
      </el-dialog>
    </div>
    <!-- 救援系统弹窗 -->
    <div class="rescue-dialog">
      <el-dialog width="6.8rem" :visible.sync="isShowRescue" :show-close=false @close="rescueDgClose">
        <div class="dialog-title">
          {{lang.common_cloud_tab7}}
          <span class="second-title">{{lang.common_cloud_tip34}}</span>
        </div>
        <div class="dialog-main">
          <div class="label">{{lang.common_cloud_tab8}}</div>
          <el-select class="os-select" v-model="rescueData.type">
            <img class="os-img"
              :src="'/plugins/server/mf_dcim/view/img/' + (rescueData.type==1?'Windows':'Linux') + '.png'" slot="prefix"
              alt="">
            <el-option value="1" label="Windows">
              <div class="os-item">
                <img class="item-os-img" src="/plugins/server/mf_dcim/view/img/Windows.png" alt="">
                <span class="item-os-text">Windows</span>
              </div>
            </el-option>
            <el-option value="2" label="Linux">
              <div class="os-item">
                <img class="item-os-img" src="/plugins/server/mf_dcim/view/img/Linux.png" alt="">
                <span class="item-os-text">Linux</span>
              </div>
            </el-option>
          </el-select>

          <!-- <div class="label">{{lang.common_cloud_tab9}}</div>
             <el-input class="pass-input" v-model="rescueData.password" :placeholder="lang.ticket_label12">
              <div class="pass-btn" slot="suffix" @click="autoPass">{{lang.common_cloud_btn1}}</div>
            </el-input> -->
          <div class="alert">
            <el-alert :title="errText" type="error" show-icon :closable="false" v-show="errText">
            </el-alert>
            <!-- <div class="remind" v-show="!errText">{{lang.common_cloud_tip29}}</div> -->
          </div>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="rescueSub" v-loading="loading3">{{lang.withdraw_btn1}}</div>
          <div class="btn-no" @click="rescueDgClose">{{lang.withdraw_btn2}}</div>
        </div>
      </el-dialog>
    </div>
    <!-- 升降级弹窗 -->
    <div class="upgrade-dialog">
      <el-dialog width="9.5rem" :visible.sync="isShowUpgrade" :show-close=false @close="upgradeDgClose">
        <div class="dialog-title">
          {{lang.common_cloud_btn16}}
        </div>
        <div class="dialog-main">
          <el-form ref="orderForm" label-position="left" :label-width="isEn ? '120px' : '100px'" hide-required-asterisk>

            <!-- 灵活机型独有 -->
            <template v-if="packageObj.id > 0 ">
              <!-- 内存 -->
              <template v-if="curPackageDetails.optional_memory.length > 0">
                <el-form-item :label="lang.memory_optional">
                  <div class="opt-content">
                    <span class="opt-item" v-for="(item, index) in curPackageDetails.optional_memory" :key="item.id"
                      :class="{active: item.checked, dis:calcConfigDisabled(item) }"
                      @click="checkOption('optional_memory', item, calcConfigDisabled(item))">
                      {{item.value}}
                    </span>
                    <div class="tip-box">
                      <span class="tip"
                        v-if="curPackageDetails.mem_max_num !== 0">{{lang.mf_dcim_tip1}}{{calcMemoryNum}}{{lang.mf_dcim_tip2}}</span>
                      <span class="tip"
                        v-if="curPackageDetails.mem_max_num !== 0 && curPackageDetails.mem_max !== 0">，</span>
                      <span class="tip"
                        v-if="curPackageDetails.mem_max !== 0">{{lang.mf_dcim_tip4}}{{curPackageDetails.mem_max}}G{{lang.cloud_memery}}</span>
                    </div>
                  </div>
                </el-form-item>
                <!-- 循环添加配置 -->
                <template v-if="packageObj.optional_memory.length > 0">
                  <el-form-item :label="item.value" v-for="item in packageObj.optional_memory" :key="item.id">
                    <el-input-number v-model="item.num" @change="getCycleList" :min="1" :max="calcMemMax(item)"
                      :precision="0" :controls="false" class="config-number"></el-input-number>
                  </el-form-item>
                </template>
              </template>
              <!-- 硬盘 -->
              <template v-if="curPackageDetails.optional_disk.length > 0">
                <el-form-item :label="lang.disk_optional">
                  <div class="opt-content">
                    <span class="opt-item" v-for="(item, index) in curPackageDetails.optional_disk" :key="item.id"
                      :class="{active: item.checked, dis: item.fix || calcDiskDisabled(item)}"
                      @click="checkOption('optional_disk', item, item.fix || calcDiskDisabled(item))">
                      {{item.value}}
                    </span>
                    <div class="tip-box">
                      <span class="tip">{{lang.mf_dcim_tip7}}，</span>
                      <span class="tip"
                        v-if="curPackageDetails.disk_max_num !== 0">{{lang.mf_dcim_tip8}}{{calcDiskNum}}{{lang.mf_dcim_tip3}}。</span>
                      <span class="tip">{{lang.mf_dcim_tip9}}</span>
                    </div>
                  </div>
                </el-form-item>
                <!-- 循环添加配置 -->
                <template v-if="packageObj.optional_disk.length > 0">
                  <el-form-item :label="item.value" v-for="item in packageObj.optional_disk" :key="item.id">
                    <el-input-number v-model="item.num" @change="getCycleList" :min="item.min || 1"
                      :max="calcDiskMax(item)" :precision="0" :controls="false" class="config-number"></el-input-number>
                  </el-form-item>
                </template>
              </template>
            </template>
            <!-- 灵活机型独有 end -->

            <!-- 固定机型增值选配 -->
            <template v-if="cloudData.model_config.id">
              <!-- 内存 -->
              <template v-if="curPackageDetails.optional_memory.length > 0">
                <el-form-item :label="lang.add_memory">
                  <div class="opt-content" v-if="packageObj.optional_memory.length > 0">
                    <div class="opt-item" v-for="(item, index) in packageObj.optional_memory" :key="index">
                      <el-select v-model="packageObj.optional_memory[index].id"
                        :placeholder="`${lang.placeholder_pre2}${lang.cloud_memery}`"
                        @change="changeMemory($event, index)">
                        <el-option v-for="item in curPackageDetails.optional_memory" :key="item.id" :label="item.value"
                          :value="item.id" :class="{active: item.checked}"
                          :disabled="calcConfigDisabled(item, packageObj.optional_memory[index].num)">
                        </el-option>
                      </el-select>
                      <el-input-number v-model="packageObj.optional_memory[index].num" @change="getCycleList" :min="1"
                        :max="calcMemMax(item)" :precision="0" class="config-number">
                      </el-input-number>
                      <i class="el-icon-remove-outline del" @click="delConfig('optional_memory', index)"></i>
                    </div>
                  </div>
                  <div class="tip-box">
                    <p class="add" @click="checkOption('optional_memory')" v-if="showAddMemory">
                      <i class="el-icon-circle-plus-outline icon"></i>
                      <span>{{lang.increase_memory}}</span>
                    </p>
                    <span class="tip" v-if="curPackageDetails.mem_max_num !== 0">{{lang.mf_dcim_tip1}}<span
                        class="num">{{calcMemoryNum}}</span> {{lang.mf_dcim_tip2}}</span>
                    <span class="tip"
                      v-if="curPackageDetails.mem_max_num !== 0 && curPackageDetails.mem_max !== 0">，</span>
                    <span class="tip" v-if="curPackageDetails.mem_max !== 0">{{lang.mf_dcim_tip4}}<span
                        class="num">{{calcMemoryCapacity}}G</span>{{lang.cloud_memery}}</span>
                  </div>
                </el-form-item>
              </template>

              <!-- 硬盘 -->
              <template v-if="curPackageDetails.optional_disk.length > 0">
                <el-form-item :label="lang.add_disk">
                  <div class="opt-content" v-if="packageObj.optional_disk.length > 0">
                    <div class="opt-item" v-for="(item, index) in packageObj.optional_disk" :key="index">
                      <el-select v-model="packageObj.optional_disk[index].id" :placeholder="`${lang.placeholder_pre2}`"
                        @change="getCycleList" :disabled="item.fix">
                        <el-option v-for="item in curPackageDetails.optional_disk" :key="item.id" :label="item.value"
                          :value="item.id" :disabled="calcDiskDisabled(item)">
                        </el-option>
                      </el-select>
                      <el-input-number v-model="packageObj.optional_disk[index].num" @change="getCycleList"
                        :min="item.min" :max="calcDiskMax(item)" :precision="0" class="config-number">
                      </el-input-number>
                      <i class="el-icon-remove-outline del" @click="delConfig('optional_disk', index)"
                        v-if="!item.fix"></i>
                    </div>
                  </div>
                  <div class="tip-box">
                    <p class="add" @click="checkOption('optional_disk')" v-if="showAddDisk">
                      <i class="el-icon-circle-plus-outline icon"></i>
                      <span>{{lang.increase_disk}}</span>
                    </p>
                    <span class="tip">{{lang.mf_dcim_tip7}}，</span>
                    <span class="tip" v-if="curPackageDetails.disk_max_num !== 0">{{lang.mf_dcim_tip8}}<span
                        class="num">{{calcDiskNum}}</span>{{lang.mf_dcim_tip3}}。</span>
                    <span class="tip">{{lang.mf_dcim_tip9}}</span>
                  </div>
                </el-form-item>
              </template>
              <!-- 显卡 -->
              <template v-if="curPackageDetails.optional_gpu.length > 0">
                <el-form-item :label="lang.add_gpu">
                  <div class="opt-content" v-if="packageObj.optional_gpu.length > 0">
                    <div class="opt-item" v-for="(item, index) in packageObj.optional_gpu" :key="index">
                      <el-select v-model="packageObj.optional_gpu[index].id" :placeholder="`${lang.placeholder_pre2}`"
                        @change="getCycleList">
                        <el-option v-for="item in curPackageDetails.optional_gpu" :key="item.id" :label="item.value"
                          :value="item.id" :disabled="calcGpuDisabled(item)">
                        </el-option>
                      </el-select>
                      <el-input-number v-model="packageObj.optional_gpu[index].num" @change="getCycleList" :min="1"
                        :max="calcGpuMax(item)" :precision="0" class="config-number">
                      </el-input-number>
                      <i class="el-icon-remove-outline del" @click="delConfig('optional_gpu', index)"></i>
                    </div>
                  </div>
                  <div class="tip-box">
                    <p class="add" @click="checkOption('optional_gpu')" v-if="showAddGpu">
                      <i class="el-icon-circle-plus-outline icon"></i>
                      <span>{{lang.increase_gpu}}</span>
                    </p>
                    <span class="tip" v-if="curPackageDetails.max_gpu_num !== 0">{{lang.mf_dcim_tip1}}<span
                        class="num">{{calcGpuNum}}</span>{{lang.mf_dcim_tip12}}</span>
                  </div>
                </el-form-item>
              </template>
            </template>

            <el-form-item :label="lang.common_cloud_title15" v-if="!showFlexIp && cloudData.model_config.id > 0">
              <span class="only-show">
                {{params.ip_num}}{{lang.mf_one}}
              </span>
              <span
                class="only-show-tip">{{lang.mf_dcim_tip10}}{{lang.common_cloud_title15}}{{lang.common_cloud_btn16}}。{{lang.mf_dcim_tip11}}</span>
            </el-form-item>
            <!-- IP数量 -->
            <el-form-item :label="lang.common_cloud_title15" v-if="showFlexIp">
              <el-radio-group v-model="ipName" @input="changeIp($event)" v-if="calcIPList[0].type === 'radio'">
                <!-- calcIpUnit(c.value) -->
                <!-- :disabled="cloudData.model_config.id > 0 && disabledIp(c.value)" -->
                <el-radio-button :disabled="cloudData.line?.sync_firewall_rule == 1 && disabledIp(c.value)"
                  :label="c.desc" v-for="(c,cInd) in calcIPList" :key="cInd">
                </el-radio-button>
              </el-radio-group>
              <el-tooltip effect="light" v-else :content="lang.mf_range + ipv4Tip" placement="top-end">
                <el-slider v-model="params.ip_num" show-input :step="1"
                  :min="calcIPList[0].min_value"
                  :max="calcIPList[calcIPList.length - 1].max_value" @change="changeIpNum('ipv4', $event)">
                </el-slider>
              </el-tooltip>
            </el-form-item>
            <!-- 带宽 -->
            <!-- 灵活机型 -->
            <el-form-item :label="lang.mf_bw" v-if="lineDetail.bw && !showFlexBw && cloudData.model_config.id > 0">
              <span class="only-show">
                {{params.bw}}M
              </span>
              <span
                class="only-show-tip">{{lang.mf_dcim_tip10}}{{lang.mf_bw}}{{lang.common_cloud_btn16}}。{{lang.mf_dcim_tip11}}</span>
            </el-form-item>
            <template v-if="showFlexBw">
              <el-form-item :label="lang.mf_bw" v-if="lineDetail.bill_type === 'bw' && lineDetail.bw.length > 0">
                <!-- 单选 -->
                <el-radio-group v-model="params.bw" v-if="lineDetail.bw[0].type === 'radio'" @input="changeBw">
                  <el-radio-button :label="c.value === 'NC' ? 'NC' : c.value * 1" v-for="(c,cInd) in calcBwRange"
                    :key="cInd" :class="{'com-dis': c.disabled}">
                    {{c.value === 'NC' ? c.value_show == '' ? lang.actual_bw : c.value_show : (c.value +
                    'M')}}
                  </el-radio-button>
                </el-radio-group>
                <!-- 拖动框 -->
                <el-tooltip effect="light" v-else :content="lang.mf_range + bwTip" placement="top">
                  <div class="slider-box" v-if="calcBwRange.length > 0">
                    <el-slider v-model="params.bw" :step="1" :show-tooltip="false" :min="calcBwRange[0] * 1"
                      :max="calcBwRange[calcBwRange.length -1] * 1" @change="changeBwNum">
                    </el-slider>
                    <el-input-number v-model="params.bw" @change="changeBwNum" :min="calcBwRange[0] * 1"
                      :max="calcBwRange[calcBwRange.length -1] * 1" size="small">
                    </el-input-number>
                  </div>
                </el-tooltip>
              </el-form-item>
              <el-form-item label=" " v-if="lineDetail.bw && lineDetail.bw[0].type !== 'radio'">
                <div class="marks">
                  <!-- <span class="item" v-for="(item,index) in Object.keys(bwMarks)">{{bwMarks[item]}}Mbps</span> -->
                  <span class="item">{{calcBwRange[0]}}M</span>
                  <span class="item">{{calcBwRange[calcBwRange.length - 1]}}M</span>
                </div>
              </el-form-item>
            </template>
            <!-- 流量 -->
            <el-form-item :label="lang.mf_flow" v-if="lineDetail.bill_type === 'flow' && lineDetail.flow.length > 0">
              <el-radio-group v-model="params.flow" @input="changeFlow">
                <el-radio-button :label="c.value * 1" v-for="(c,cInd) in calcFlowList" :key="cInd">
                  {{c.value > 0 ? (c.value + 'G') : lang.mf_tip28}}
                </el-radio-button>
              </el-radio-group>
            </el-form-item>
            <!-- 防御 -->
            <el-form-item :label="lang.mf_defense"
              v-if="cloudData.line?.sync_firewall_rule == 0  && lineDetail.defence && lineDetail.defence.length >0">
              <el-radio-group v-model="defenseName">
                <el-radio-button :label="c.desc" v-for="(c,cInd) in lineDetail.defence" :key="cInd"
                  @click.native="chooseDefence($event,c)">
                </el-radio-button>
              </el-radio-group>
            </el-form-item>
            <!-- 指定IP降级 -->
            <el-form-item :label="lang.ip_down_tip" v-if="showFlexIp && calcDelNum > 0"> 
              <div class="ip-down">
                <el-select v-model="ipv4DelArr" :placeholder="lang.placeholder_pre2" multiple 
                  clearable filterable multiple collapse-tags
                  :disabled="calcDelNum === 0" :multiple-limit="calcDelNum">
                  <el-option v-for="item in allIp" :key="item" :label="item" :value="item"> </el-option>
                </el-select>
                <span class="tip">
                  {{lang.ip_down_tip1}}<span class="num">{{calcDelNum - ipv4DelArr.length}}</span>{{lang.ip_down_tip2}}
                </span>
              </div>
            </el-form-item>
          </el-form>
        </div>

        <div class="dialog-footer">
          <div class="footer-top">
            <div class="money-text">{{lang.common_cloud_btn37}}：</div>
            <div class="money" v-loading="upgradePriceLoading">
              <span class="money-num">{{commonData.currency_prefix }} {{ (upParams.totalPrice * 1).toFixed(2)
                |
                filterMoney}}</span>
              <el-popover placement="top-start" width="200" trigger="hover"
                v-if="isShowLevel || (isShowPromo && upParams.isUseDiscountCode) || isShowCash">
                <div class="show-config-list">
                  <p v-if="isShowLevel">{{lang.shoppingCar_tip_text2}}：{{commonData.currency_prefix}} {{
                    upParams.clDiscount | filterMoney }}</p>
                  <p v-if="isShowPromo && upParams.isUseDiscountCode">
                    {{lang.shoppingCar_tip_text4}}：{{commonData.currency_prefix}} {{ upParams.code_discount |
                    filterMoney}}
                  </p>
                  <p v-if="isShowCash && upParams.customfield.voucher_get_id">
                    {{lang.shoppingCar_tip_text5}}：{{commonData.currency_prefix}}
                    {{ upParams.cash_discount | filterMoney}}
                  </p>
                </div>
                <i class="el-icon-warning-outline total-icon" slot="reference"></i>
              </el-popover>
              <p class="original-price" v-if="upParams.totalPrice != upParams.original_price">
                {{commonData.currency_prefix}} {{ upParams.original_price.toFixed(2) | filterMoney}}
              </p>
              <div class="code-box">
                <!-- 代金券 -->
                <cash-coupon ref="cashRef" v-show="isShowCash && !cashObj.code"
                  :currency_prefix="commonData.currency_prefix" @use-cash="upUseCash" scene='upgrade'
                  :product_id="[product_id]" :price="upParams.original_price"></cash-coupon>
                <!-- 优惠码 -->
                <discount-code v-show="isShowPromo && !upParams.customfield.promo_code  "
                  @get-discount="getUpDiscount(arguments)" scene='upgrade' :product_id="product_id"
                  :amount="upParams.original_price" :billing_cycle_time="hostData.billing_cycle_time"></discount-code>
              </div>
              <div class="code-number-text">
                <div class="discount-codeNumber" v-show="upParams.customfield.promo_code">{{
                  upParams.customfield.promo_code }}<i class="el-icon-circle-close remove-discountCode"
                    @click="removeUpDiscountCode()"></i></div>
                <div class="cash-codeNumber" v-show="cashObj.code">{{ cashObj.code }}<i
                    class="el-icon-circle-close remove-discountCode" @click="upRemoveCashCode()"></i></div>
              </div>
            </div>
          </div>
          <div class="footer-bottom">
            <div class="btn-ok" @click="upgradeSub" v-loading="loading4">{{lang.finance_btn6}}</div>
            <div class="btn-no" @click="upgradeDgClose">{{lang.finance_btn7}}</div>
          </div>
        </div>
      </el-dialog>
    </div>
    <!-- 电源操作确认弹窗 -->
    <div class="power-dialog">
      <el-dialog width="6.2rem" :visible.sync="isShowPowerChange" :show-close=false @close="powerDgClose">
        <div class="dialog-title">
          {{lang.common_cloud_text34}}{{powerTitle}}{{lang.common_cloud_text35}}
        </div>
        <div class="dialog-main">
          <div class="label">{{lang.common_cloud_text36}}</div>
          <div class="value">{{hostData.name}}</div>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="toChangePower" v-loading="loading1">{{lang.common_cloud_btn28}}</div>
          <div class="btn-no" @click="powerDgClose">{{lang.common_cloud_btn29}}</div>
        </div>
      </el-dialog>
    </div>
    <!-- 自动续费确认弹窗 -->
    <!-- <div class="power-dialog">
      <el-dialog width="6.2rem" :visible.sync="isShowAutoRenew" :show-close=false :close-on-click-modal=false>
        <div class="dialog-title">
          {{lang.common_cloud_text37}}{{isShowPayMsg? lang.common_cloud_text38 :
          lang.common_cloud_text39}}{{lang.auto_renew}}
        </div>
        <div class="dialog-main">
          <div class="label">{{lang.fin_host}}</div>
          <div class="value">{{hostData.name}}</div>
        </div>
        <div class="dialog-footer">
          <div class="btn-ok" @click="doAutoRenew">{{lang.common_cloud_btn28}}</div>
          <div class="btn-no" @click="autoRenewDgClose">{{lang.common_cloud_btn29}}</div>
        </div>
      </el-dialog>
    </div> -->
    <!-- 安全验证 -->
    <safe-confirm ref="safeRef" :password.sync="client_operate_password" @confirm="hadelSafeConfirm"></safe-confirm>
    <pay-dialog ref="topPayDialog" @payok="paySuccess" @paycancel="payCancel"></pay-dialog>
    <!-- 申请返现 -->
    <cash-back :id="id" :show-cash="isShowCashDialog" @cancledialog="cancleDialog" @showbtn="showBtn"></cash-back>
    <!-- 购买流量包 -->
    <flow-packet :id="id" :show-package="showPackage" @cancledialog="cancleDialog" v-if="showPackage"
      :currency_prefix="commonData.currency_prefix" @sendPackId="handlerPay">
    </flow-packet>
    <!-- 图形验证码 -->
    <captcha-dialog :is-show-captcha="isShowCaptcha" ref="captcha"></captcha-dialog>
  </div>
</div>
<!-- =======页面独有======= -->
<script src="/plugins/server/mf_dcim/template/clientarea/pc/mf401/lang/index.js"></script>
<script src="/plugins/server/mf_dcim/template/clientarea/pc/mf401/api/dcim.js"></script>
<script src="/plugins/server/mf_dcim/template/clientarea/pc/mf401/js/echarts.js"></script>
<script src="/plugins/server/mf_dcim/template/clientarea/pc/mf401/js/dcimDetail.js"></script>
