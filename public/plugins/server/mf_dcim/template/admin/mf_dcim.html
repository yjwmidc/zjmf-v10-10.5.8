<link rel="stylesheet" href="/plugins/server/mf_dcim/template/admin/css/mf-dcim.css">
<!-- =======内容区域======= -->
<div class="common_config">
  <com-config>
    <div class="t-card">
      <t-tabs v-model="tabs" @change="changeTab">
        <!-- 周期设置 -->
        <t-tab-panel value="duration" :label="lang.mf_duration">
          <div class="box limit-table">
            <div class="com-top">
              <p class="tit">{{lang.mf_duration}}<span class="cycle-tip"
                  v-if="isShowCycleTip">({{lang.empty_cycle_tip}})</span></p>
              <div class="right">
                <t-button class="add-btn" @click='changeRadio'>{{lang.cycle_ratio}}</t-button>
                <t-button class="add-btn" @click='addCycle' :disabled="isAgent">{{lang.add_cycle}}</t-button>
              </div>
            </div>
            <p class="s-tip" style="line-height: 1;margin-top: -10px;">{{lang.mf_tip30}}</p>
            <t-table row-key="id" :data="cycleData" size="medium" :columns="cycleColumns" :hover="hover"
              :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #unit="{row}">
                <span v-if="row.num">{{row.num}}</span>{{lang[row.unit]}}
              </template>
              <template #price_factor="{row}">
                {{row.price_factor.toFixed(2)}}
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span>
              </template>
              <template #ratio="{row}">
                <span>{{row.ratio || '--'}}</span>
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editCycle(row)"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('cycle',row)" :class="{'server-disabled': isAgent}"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
          </div>
        </t-tab-panel>
        <!-- 数据中心 -->
        <t-tab-panel value="data_center" :label="lang.data_center_config">
          <div class="box data-box limit-table1">
            <div class="com-top">
              <p class="tit">{{lang.data_center}}</p>
              <div class="r-btn">
                <t-button class="add-btn" @click='handleGlobal' :disabled="isAgent"
                  v-if="hasFirewall && isFirewallProduct">{{lang.mf_tip49}}
                </t-button>
                <t-button class="add-btn" @click='addData'
                  :disabled="isAgent">{{lang.invoice_btn6}}{{lang.data_center}}</t-button>
                <div class="add-btn line-btn" @click='addLine' :class="{'server-disabled': isAgent}">
                  {{lang.invoice_btn6}}{{lang.line}}
                </div>
              </div>
            </div>
            <t-table row-key="id" :data="dataList" size="medium" :columns="dataColumns" :hover="hover"
              :loading="dataLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #area="{row}">
                <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                  <t-icon name="edit-1" @click.native="editData(row)"></t-icon>
                </t-tooltip>
                {{row.area}}
              </template>
              <template #line="{row}">
                <template v-if="row.line.length > 0">
                  <div class="item line-item" v-for="(item,index) in row.line">
                    <span class="txt" :title="item.name">{{item.name}}</span>
                    <t-switch :custom-value="[0,1]" v-model="item.hidden" :label="[lang.mf_show, lang.mf_hide]"
                      @change="changeShowLine($event,item)" :disabled="isAgent">
                    </t-switch>
                  </div>
                </template>
                <span class="p12" v-else>--</span>
              </template>
              <template #price="{row}">
                <template v-if="row.line.length > 0">
                  <div class="item" v-for="(item,index) in row.line">
                    {{currency_prefix}}{{item.price}}
                    <template v-if="item.duration">/{{item.duration}}</template>
                    {{lang.rise}}&nbsp;&nbsp;{{lang['mf_'+item.bill_type]}}
                  </div>
                </template>
                <span class="p12" v-else>--</span>
              </template>
              <template #op="{row}">
                <template v-if="row.line.length > 0">
                  <div class="com-opt item" v-for="(item,index) in row.line">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editLine(item)"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('c_line',item)"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
                <div v-else style="padding: 12px 24px;" class="com-opt">
                  <t-tooltip :content="`${lang.delete}${lang.data_center}`" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('data',row)" :class="{'server-disabled': isAgent}"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
            <div class="config-tip">
              <span class="notes">{{lang.mf_notes}}</span>
              <p class="notes-txt">
                {{lang.mf_tip6}}<br>
                {{lang.mf_tip7}}<br>
                {{lang.mf_tip8}}<br>
              </p>
            </div>
          </div>
        </t-tab-panel>
        <!-- 机型配置 -->
        <t-tab-panel value="model" :label="lang.fixed_model">
          <div class="box">
            <div class="com-top">
              <p class="tit">{{lang.model_config}}</p>
              <t-button class="add-btn" @click="addCalc('model')"
                :disabled="isAgent">{{lang.order_text53}}{{lang.model_specs}}</t-button>
            </div>
            <p class="s-tip" style="line-height: 1;margin-top: -10px;">{{lang.mf_tip25}}</p>
            <t-table row-key="id" :data="modelList" size="medium" :columns="calcModelColumns" :hover="hover"
              class="model-table" :loading="modelLoading" table-layout="fixed" display-type="fixed-width"
              :hide-sort-tips="true" drag-sort="row-handler" @drag-sort="changeModelSort">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #drag="{row}">
                <t-icon name="move"></t-icon>
              </template>
              <template #value="{row}">
                {{row.value}}
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span><template
                  v-if="row.duration">/{{row.duration}}</template>
                &nbsp;{{lang.rise}}
              </template>
              <template #support_optional="{row}">
                {{row.support_optional === 1 ? lang.allow : lang.login_no}}
              </template>
              <template #hidden="{row}">
                <t-switch size="medium" :custom-value="[0,1]" v-model="row.hidden" @change="onChange(row)"
                  :disabled="isAgent">
                </t-switch>
              </template>
              <template #ontrial="{row}">
                <t-switch size="medium" :custom-value="[1,0]" :disabled="isAgent" v-model="row.ontrial"
                  @change="ontrialChange(row)"></t-switch>
              </template>
              <template #ontrial_price="{row}">
                <span v-if="row.ontrial === 1">{{currency_prefix}}{{(row.ontrial_price*1).toFixed(2)}}</span>
                <span v-else>--</span>
              </template>
              <template #ontrial_qty="{row}">
                <span v-if="row.ontrial === 1 && row.ontrial_stock_control === 1">{{row.ontrial_qty}}</span>
                <span v-else>--</span>
              </template>
              <template #gpu="{row}">
                {{row.gpu || "--"}}
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editCalc(row, 'model')"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('model',row)" :class="{'server-disabled': isAgent}"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
          </div>
        </t-tab-panel>
        <!-- 增值设置 -->
        <t-tab-panel value="hardware" :label="lang.hardware_config">
          <div class="box limit-table">
            <div class="hard-box" v-for="(item, index) in hardwareArr" :key="index">
              <div class="com-top">
                <p class="tit">{{item.label}}{{lang.config}}</p>
                <t-button class="add-btn" @click='addHardware(item.name)'
                  :disabled="isAgent">{{lang.order_new}}{{item.label}}</t-button>
              </div>
              <t-table row-key="id" :data="calcHardwareData(item.name)" size="medium" :columns="cpu_columns"
                :hover="hover" :loading="calcHardwareLoading(item.name)" :table-layout="tableLayout ? 'auto' : 'fixed'"
                display-type="fixed-width" :hide-sort-tips="true">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #price="{row}">
                  {{currency_prefix}}{{row.price}}
                  <template v-if="row.duration">/{{row.duration}}</template>
                  {{lang.rise}}
                </template>
                <template #op="{row}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editHard(item.name, row)"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('hard',row, 0, item.name)"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
            </div>
          </div>
        </t-tab-panel>
        <!-- 灵活机型 -->
        <!-- <t-tab-panel value="flexible" :label="lang.flexible_model">
          <div class="box">
            <div class="com-top">
              <p class="tit">{{lang.flexible_model}}</p>
              <div class="add-btn" @click="addFlex">{{lang.order_text53}}{{lang.model_specs}}</div>
            </div>
            <p class="s-tip" style="line-height: 1;margin-top: -10px;">{{lang.mf_p6}}</p>
            <t-table row-key="id" :data="packageList" size="medium" :columns="flexColumns" :hover="hover"
              class="model-table" :loading="flexLoading" table-layout="fixed" display-type="fixed-width"
              :hide-sort-tips="true">
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #name="{row}">
                <span>{{row.name}} <span class="flex-des" v-if="row.description">({{row.description}})</span></span>
              </template>
              <template #bw="{row}">
                {{row.bw}}M
              </template>
              <template #price="{row}">
                <span>{{currency_prefix}}{{(row.price*1).toFixed(2)}}</span><template
                  v-if="row.duration">/{{row.duration}}</template>
                &nbsp;{{lang.rise}}
              </template>
              <template #hidden="{row}">
                <t-switch size="medium" :custom-value="[0,1]" v-model="row.hidden" @change="onChange(row)"></t-switch>
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                    <t-icon name="edit-1" @click="editFlex(row)"></t-icon>
                  </t-tooltip>
                  <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                    <t-icon name="delete" @click="comDel('flex',row)"></t-icon>
                  </t-tooltip>
                </div>
              </template>
            </t-table>
          </div>
        </t-tab-panel> -->
        <!-- 配置限制 -->
        <t-tab-panel value="limit" :label="lang.advanced_rules">
          <div class="box limit-box">
            <div class="com-top">
              <t-button class="add-btn" @click="addLimit"
                :disabled="isAgent">{{lang.order_text53}}{{lang.mf_rule}}</t-button>
              <span class="limit-tip">
                <img :src="`/plugins/server/mf_dcim/template/admin/img/warning.svg`" alt="">
                {{lang.mf_tip19}}
              </span>
            </div>
            <div class="limit-item">
              <t-table row-key="id" :data="limitData" size="medium" :columns="limitColumns" :hover="hover"
                :loading="limitLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                :hide-sort-tips="true" class="config-table">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #rule="{row}">
                  <p v-for="(item,index) in calcLimitRules(row.rule)" :key="index" class="rule-item">
                    {{calcLimitName(item[0])}}
                    <span v-show="item[1].opt === 'neq'" class="red">{{lang.mf_neq}}</span>：
                    <span v-if="item[0] === 'cpu'">
                      <span v-for="(sub,sInd) in item[1].value" :key="sInd">
                        <span v-show="sInd !== 0">，</span>{{sub}}{{lang.cores}}
                      </span>
                    </span>
                    <span v-if="item[0] === 'memory'">
                      {{item[1].min}}{{memory_unit}}~{{item[1].max ? item[1].max + memory_unit :
                      lang.mf_limitless}}
                    </span>
                    <span v-if="item[0] === 'bw'">
                      {{item[1].min}}M~{{item[1].max ? item[1].max + 'M' :
                      lang.mf_limitless}}
                    </span>
                    <span v-if="item[0] === 'flow'">
                      {{item[1].min}}G~{{item[1].max ? item[1].max + 'G' :
                      lang.mf_limitless}}
                    </span>
                    <span v-if="item[0] === 'data_center' || item[0] === 'image' || item[0] === 'model_config'">
                      <span v-for="(sub,sInd) in item[1].name" :key="sInd">
                        <span v-show="sInd !== 0">，</span>{{sub}}
                      </span>
                    </span>
                  </p>
                </template>
                <template #result="{row}">
                  <p v-for="(item,index) in calcLimitRules(row.result)" :key="index" class="rule-item">
                    {{calcLimitName(item[0])}}
                    <span v-show="item[1][0].opt === 'neq'" class="red">{{lang.mf_neq}}</span>：
                    <span v-if="item[0] === 'memory'">
                      <span v-for="(sub,sInd) in item[1]" :key="sInd">
                        {{sub.min}}{{memory_unit}}~{{sub.max ? sub.max + memory_unit : lang.mf_limitless}}；
                      </span>
                    </span>
                    <span v-if="item[0] === 'bw'">
                      <span v-for="(sub,sInd) in item[1]" :key="sInd">
                        {{sub.min}}M~{{sub.max ? sub.max + 'M' : lang.mf_limitless}}；
                      </span>
                    </span>
                    <span v-if="item[0] === 'flow'">
                      <span v-for="(sub,sInd) in item[1]" :key="sInd">
                        {{sub.min}}G~{{sub.max ? sub.max + 'G' : lang.mf_limitless}}；
                      </span>
                    </span>
                    <span v-if="item[0] === 'data_center' || item[0] === 'image' || item[0] === 'model_config'">
                      <span v-for="(sub,sInd) in item[1]" :key="sInd">
                        <span v-for="(el, val) in sub.name" :key="val">
                          <span v-show="val !== 0">，</span>{{el}}
                        </span>；
                      </span>
                    </span>
                  </p>
                </template>
                <template #op="{row}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.mf_copy" :show-arrow="false" theme="light">
                      <t-icon name="file-copy" size="18px" @click="editLimit(row, 'copy')" class="common-look"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit" class="common-look" @click="editLimit(row, 'update')"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" class="common-look" @click="comDel('limit',row)"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
            </div>
          </div>
        </t-tab-panel>
        <!-- 操作系统 -->
        <t-tab-panel value="system" :label="lang.opt_system">
          <div class="box">
            <div class="top-opt">
              <div class="item">
                <t-select v-model="systemParams.image_group_id" class="select"
                  :placeholder="`${lang.select}${lang.system_classify}`" clearable>
                  <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in systemGroup">
                  </t-option>
                </t-select>
                <t-input v-model="systemParams.keywords" class="ml_10" clearable
                  :placeholder="`${lang.input}${lang.system_name}`" @clear="clearKey"
                  @keypress.enter.native="getSystemList">
                </t-input>
                <t-button class="ml_10" @click="getSystemList">{{lang.search}}</t-button>
              </div>
              <div class="item">
                <t-button @click="classManage" :disabled="isAgent">{{lang.news_classific}}{{lang.manage}}</t-button>
                <t-button @click="handelPullOs('net')" theme="default" class="ml_10"
                  :disabled="isAgent">{{lang.get_system}}
                </t-button>
                <t-button @click="handelPullOs('local')" theme="default" class="ml_10"
                  :disabled="isAgent">{{lang.get_local_system}}
                </t-button>
                <div class="add-system ml_10" @click="createNewSys" :class="{'server-disabled': isAgent}">
                  {{lang.add}}{{lang.system}}
                </div>
              </div>
            </div>
            <!-- 批量删除 -->
            <div class="top-opt">
              <t-button @click="deleteBatch" :disabled="isAgent">{{lang.batch_delete}}</t-button>
            </div>
            <t-table row-key="id" :data="systemList" size="medium" :columns="systemColumns" :hover="hover"
              :loading="loading" table-layout="auto" display-type="fixed-width" :hide-sort-tips="true"
              drag-sort="row-handler" @drag-sort="onDragSort" :selected-row-keys="selectedRowKeys"
              @select-change="rehandleSelectChange">
              <template #drag="{row}">
                <t-icon name="move" style="cursor: move;"></t-icon>
              </template>
              <template slot="sortIcon">
                <t-icon name="caret-down-small"></t-icon>
              </template>
              <template #image_group_name="{row}">
                <span class="class-name">
                  <img :src="`/plugins/server/mf_dcim/template/admin/img/${row.icon}.svg`" alt="" class="icon">
                  {{row.image_group_name}}
                </span>
              </template>
              <template #charge="{row}">
                <t-switch size="small" :custom-value="[1,0]" v-model="row.charge" @change="changeSystemStatus(row)"
                  :disabled="isAgent">
                </t-switch>
              </template>
              <template #price="{row}">
                {{currency_prefix}}&nbsp;{{row.price}}
              </template>
              <template #enable="{row}">
                <t-switch size="small" :custom-value="[1,0]" v-model="row.enable" @change="changeSystemStatus(row)"
                  :disabled="isAgent">
                </t-switch>
              </template>
              <template #op="{row}">
                <div class="com-opt">
                  <t-icon name="edit-1" @click="editSystem(row)"></t-icon>
                  <t-icon name="delete" @click="comDel('system',row)" :class="{'server-disabled': isAgent}"></t-icon>
                </div>
              </template>
            </t-table>
          </div>
        </t-tab-panel>
        <!-- 试用设置 -->
        <t-tab-panel value="ontrial" :label="lang.ontrial_text1" v-if="!isAgent">
          <div class="box ontrial-box">
            <t-form label-width="160px" label-align="left" :data="payOntrialForm" ref="payOntrialRef"
              @submit="submitOntral" :rules="ontralRules" class="ontrial-form">
              <div class="ontrial-open">
                <span>{{lang.ontrial_text4}}</span>
                <t-switch :custom-value="[1,0]" v-model="payOntrialForm.status"
                  :label="[lang.ontrial_text2,lang.ontrial_text3]">
                </t-switch>
              </div>
              <template v-if="payOntrialForm.status === 1">
                <t-form-item :label="lang.ontrial_text5">
                  <t-form-item label=" " label-width="0px" style="margin-right: 0;">
                    <t-input-number style="width: 120px;" v-model="payOntrialForm.cycle_num" name="cycle_num"
                      :placeholder="lang.ontrial_text5" theme="normal" :min="0" :decimal-places="0">
                    </t-input-number>
                  </t-form-item>
                  <t-form-item label=" " label-width="0px">
                    <t-select v-model="payOntrialForm.cycle_type">
                      <t-option :value="item.value" :label="item.label" v-for="(item,index) in cycleTypeOptions"
                        :key="item.value">
                      </t-option>
                    </t-select>
                  </t-form-item>
                </t-form-item>
                <t-form-item :label="lang.ontrial_text6">
                  <t-radio-group v-model="payOntrialForm.client_limit">
                    <t-radio :value="item.value" v-for="item in clientLimitOptions"
                      :key="item.value">{{item.label}}</t-radio>
                  </t-radio-group>
                </t-form-item>
                <t-form-item :label="lang.ontrial_text13" :help="lang.ontrial_text14">
                  <t-checkbox-group v-model="payOntrialForm.account_limit">
                    <t-checkbox :value="item.value" v-for="item in accountLimitOptions"
                      :key="item.value">{{item.label}}</t-checkbox>
                  </t-checkbox-group>
                </t-form-item>
                <t-form-item :label="lang.ontrial_text15" :help="lang.ontrial_text16">
                  <com-tree-select @choosepro="chooseDelPro" :multiple="true" style="width: 360px;"
                    :value="payOntrialForm.old_client_exclusive">
                  </com-tree-select>
                </t-form-item>
                <t-form-item :label="lang.ontrial_text17">
                  <t-input-number v-model="payOntrialForm.max" name="max" style="width: 200px;"
                    :placeholder="lang.ontrial_text17" theme="normal" :min="0" :decimal-places="0"
                    :suffix="lang.ontrial_text18">
                  </t-input-number>
                </t-form-item>
              </template>
              <t-form-item label=" " label-width="0px">
                <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                </t-button>
              </t-form-item>
            </t-form>
          </div>
        </t-tab-panel>
        <!-- 其他设置 -->
        <t-tab-panel value="other" :label="lang.other_setting">
          <div class="box other-box">
            <t-form :data="otherForm" ref="otherConfig" @submit="submitConfig" :rules="dataRules" class="other-form">
              <div class="switch-box">
                <p class="tit">
                  {{lang.apply_discount}}
                  <span class="s-tip">{{lang.mf_p13}}</span>
                </p>
                <div class="item">
                  <p class="s-item">--</p>
                  <p class="s-item">{{lang.memory}}</p>
                  <p class="s-item">{{lang.disk}}</p>
                  <p class="s-item">{{lang.mf_gpu}}</p>
                  <p class="s-item">{{lang.bw}}</p>
                  <p class="s-item">IP</p>
                </div>
                <div class="item">
                  <p class="s-item">{{lang.order_optional}}</p>
                  <p class="s-item">
                    <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_memory_order" size="small"
                      :disabled="isAgent">
                    </t-switch>
                  </p>
                  <p class="s-item">
                    <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_disk_order" size="small"
                      :disabled="isAgent">
                    </t-switch>
                  </p>
                  <p class="s-item">
                    <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_gpu_order" size="small"
                      :disabled="isAgent">
                    </t-switch>
                  </p>
                  <p class="s-item">--</p>
                  <p class="s-item">--</p>
                </div>
                <div class="item">
                  <p class="s-item">{{lang.upAndDown}}</p>
                  <p class="s-item">
                    <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_memory_upgrade" size="small"
                      :disabled="isAgent">
                    </t-switch>
                  </p>
                  <p class="s-item">
                    <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_disk_upgrade" size="small"
                      :disabled="isAgent">
                    </t-switch>
                  </p>
                  <p class="s-item">
                    <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_gpu_upgrade" size="small"
                      :disabled="isAgent">
                    </t-switch>
                  </p>
                  <p class="s-item">
                    <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_bw_upgrade" size="small"
                      :disabled="isAgent">
                    </t-switch>
                  </p>
                  <p class="s-item">
                    <t-switch :custom-value="[1,0]" v-model="otherForm.level_discount_ip_num_upgrade" size="small"
                      :disabled="isAgent">
                    </t-switch>
                  </p>
                </div>
              </div>
              <t-form-item :label="`${lang.manual_resources}${lang.product}`">
                <t-switch :custom-value="[1,0]" v-model="otherForm.manual_resource" size="small" :disabled="isAgent">
                </t-switch>
                <span class="s-tip">{{lang.mf_p5}}</span>
              </t-form-item>
              <t-form-item :label="lang.mf_p14">
                <t-switch :custom-value="[1,0]" v-model="otherForm.optional_host_auto_create" size="small"
                  :disabled="isAgent">
                </t-switch>
                <span class="s-tip">{{lang.mf_p15}}</span>
              </t-form-item>
              <t-form-item :label="lang.random_ssh">
                <t-switch :custom-value="[1,0]" v-model="otherForm.rand_ssh_port" size="small" :disabled="isAgent">
                </t-switch>
              </t-form-item>
              <t-form-item :label="lang.is_need_code1">
                <t-switch :custom-value="[1,0]" v-model="otherForm.reset_password_sms_verify" size="small">
                </t-switch>
              </t-form-item>
              <t-form-item :label="lang.is_need_code2">
                <t-switch :custom-value="[1,0]" v-model="otherForm.reinstall_sms_verify" size="small">
                </t-switch>
              </t-form-item>
              <t-form-item :label="lang.mf_tip64">
                <t-switch :custom-value="[1,0]" v-model="otherForm.auto_sync_dcim_stock" size="small">
                </t-switch>
              </t-form-item>
              <t-button theme="primary" type="submit" :loading="submitLoading" class="submit"
                style="margin-top: 20px;">{{lang.hold}}
              </t-button>
            </t-form>
          </div>
        </t-tab-panel>
      </t-tabs>
    </div>
    <!-- 新增/修改 周期 -->
    <t-dialog :header="comTitle" :visible.sync="cycleModel" :footer="false" width="600" @close="closeData"
      :close-on-overlay-click="false">
      <t-form :data="cycleForm" ref="cycleForm" @submit="submitCycle" :rules="cycleRules" class="cycle-form"
        v-if="cycleModel">
        <t-form-item :label="lang.cycle_name" name="name">
          <t-input v-model="cycleForm.name" :placeholder="`${lang.input}${lang.cycle_name}${multiliTip}`"
            :disabled="isAgent"></t-input>
        </t-form-item>
        <t-form-item :label="lang.cycle_time" class="required">
          <t-form-item class="cycle_time" name="num" style="margin-bottom: 0;">
            <t-input v-model="cycleForm.num" :placeholder="lang.input+lang.cycle_time" :disabled="isAgent"></t-input>
          </t-form-item>
          <t-form-item>
            <t-select v-model="cycleForm.unit" :disabled="isAgent">
              <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in cycleTime">
              </t-option>
            </t-select>
          </t-form-item>
        </t-form-item>
        <t-form-item :label="lang.price_factor" name="price_factor">
          <t-input-number v-model="cycleForm.price_factor" :placeholder="lang.input+lang.factor" theme="normal"
            :decimal-places="2" :min="0" :max="9999">
          </t-input-number>
        </t-form-item>
        <t-form-item label=" " class="empty-item">
          <span>{{lang.mf_tip39}}</span>
        </t-form-item>
        <t-form-item :label="lang.cycle_price">
          <t-input-number v-model="cycleForm.price" :placeholder="lang.input+lang.price" theme="normal"
            :decimal-places="2" :min="0">
          </t-input-number>
        </t-form-item>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="cycleModel=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 周期比例 -->
    <t-dialog :header="lang.cycle_ratio" :visible.sync="ratioModel" :footer="false" width="600"
      :close-on-overlay-click="false">
      <t-table row-key="id" :data="ratioData" size="medium" :columns="ratioColumns" :hover="hover" :loading="loading"
        :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width" :hide-sort-tips="true">
        <template #unit="{row}">
          <span>{{row.num}}{{lang[row.unit]}}</span>
        </template>
        <template #ratio="{row}">
          <t-input-number v-model="row.ratio" :placeholder="lang.input+lang.mf_ratio" theme="normal" :decimal-places="2"
            :min="0.01">
          </t-input-number>
        </template>
      </t-table>
      <div class="ratio-tip">
        <p>*{{lang.mf_notes}}</p>
        <p>{{lang.mf_ratio_tip1}}</p>
        <p>{{lang.mf_ratio_tip2}}</p>
        <p>{{lang.mf_ratio_tip3}}</p>
        <p>{{lang.mf_ratio_tip4}}</p>
      </div>
      <div class="com-f-btn">
        <t-button theme="primary" @click="saveRatio" :loading="submitLoading">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="ratioModel=false">{{lang.cancel}}</t-button>
      </div>
    </t-dialog>
    <!-- 新增/编辑系统 -->
    <t-dialog :header="comTitle" :visible.sync="systemModel" :footer="false" width="600" @close="closeData"
      :close-on-overlay-click="false">
      <t-form :data="createSystem" ref="cycleForm" @submit="submitSystem" :rules="cycleRules" class="cycle-form"
        v-if="systemModel">
        <t-form-item :label="lang.system_classify" name="image_group_id">
          <t-select v-model="createSystem.image_group_id" class="select" :disabled="isAgent"
            :placeholder="`${lang.select}${lang.system_classify}`" clearable>
            <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in systemGroup">
            </t-option>
          </t-select>
        </t-form-item>
        <t-form-item :label="lang.system_name" name="name"
          :rules="[{ required: true, message: lang.input + lang.system_name, type: 'error' }]">
          <t-input v-model="createSystem.name" :placeholder="`${lang.input}${lang.system_name}${multiliTip}`"
            :disabled="isAgent"></t-input>
        </t-form-item>
        <t-form-item :label="lang.opt_system + 'ID'" name="rel_image_id">
          <t-input v-model="createSystem.rel_image_id" :placeholder="lang.input+lang.opt_system + 'ID'"
            :disabled="isAgent"></t-input>
        </t-form-item>
        <t-form-item :label="lang.mf_charge">
          <t-switch size="small" :custom-value="[1,0]" v-model="createSystem.charge" :disabled="isAgent">
          </t-switch>
        </t-form-item>
        <t-form-item :label="lang.price" v-if="createSystem.charge" name="price">
          <t-input v-model="createSystem.price" :placeholder="lang.input+lang.price"></t-input>
        </t-form-item>
        <t-form-item :label="lang.mf_enable">
          <t-switch size="small" :custom-value="[1,0]" v-model="createSystem.enable" :disabled="isAgent">
          </t-switch>
        </t-form-item>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="systemModel=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/编辑分类管理-->
    <t-dialog :header="`${lang.classific_manage}`" :visible.sync="classModel" :footer="false" width="600"
      @close="closeData" :close-on-overlay-click="false" class="class-dialog">
      <t-form :data="classParams" ref="classForm" @submit="submitSystemGroup" :rules="cycleRules" class="cycle-form"
        v-if="classModel">
        <t-form-item :label="lang.system_name" name="name" :rules="[
        { required: true, message: lang.input + lang.system_name, type: 'error', trigger: 'blur' }]">
          <t-input v-model="classParams.name" placeholder=" "></t-input>
        </t-form-item>
        <t-form-item :label="lang.mf_icon" name="icon">
          <t-select v-model="classParams.icon" :popup-props="popupProps" class="custom-select"
            :placeholder="`${lang.select}${lang.mf_icon}`" clearable>
            <img class="s-icon" :class="{noIcon: !classParams.icon}" slot="prefixIcon" style="margin-right: 8px"
              :src="`/plugins/server/mf_dcim/template/admin/img/${classParams.icon}.svg`" />
            <t-option :key="index" :value="item.value" :label="item.label" v-for="(item,index) in iconSelecet"
              class="custom-icon">
              <img :src="item.label" alt="" class="icon">
            </t-option>
          </t-select>
          <t-button theme="primary" type="submit" :loading="submitLoading" style="margin-left: 14px;">{{lang.hold}}
          </t-button>
        </t-form-item>
      </t-form>
      <!-- 分类表格 -->
      <t-table row-key="id" :data="systemGroup" size="medium" :columns="groupColumns" :hover="hover" :loading="loading"
        table-layout="auto" display-type="fixed-width" :hide-sort-tips="true" max-height="450px"
        style="margin-top: 30px;" drag-sort="row-handler" @drag-sort="changeSort">
        <template slot="sortIcon">
          <t-icon name="caret-down-small"></t-icon>
        </template>
        <template #drag="{row}">
          <t-icon name="move"></t-icon>
        </template>
        <template #image_group_name="{row}">
          <span class="class-name">
            <img :src="`/plugins/server/mf_dcim/template/admin/img/${row.icon}.svg`" alt="" class="icon">
            {{row.name}}
          </span>
        </template>
        <template #op="{row}">
          <div class="com-opt">
            <t-icon name="edit-1" @click="editGroup(row)"></t-icon>
            <t-icon name="delete" @click="comDel('group',row)"></t-icon>
          </div>
        </template>
      </t-table>
    </t-dialog>
    <!-- 新增/修改 机型配置 -->
    <t-dialog :header="comTitle" :visible.sync="calcModel" :footer="false" width="1440" @close="closeData"
      :close-on-overlay-click="false" class="cpuDialog flex-dialog">
      <t-form :data="calcForm" ref="cycleForm" @submit="submitCalc" :rules="calcRules" class="cycle-form"
        v-if="calcModel" label-align="top">
        <div class="flex-box">
          <div class="form-item">
            <p class="com-tit">
              <span>{{lang.install_text4}}</span>
            </p>
            <div class="short-item">
              <t-form-item :label="lang.config_name" name="name">
                <t-input v-model="calcForm.name" :placeholder="`${lang.input}${lang.config_name}${multiliTip}`"
                  :disabled="isAgent"></t-input>
              </t-form-item>
              <t-form-item :label="`${lang.sale_group}ID`" name="group_id">
                <t-input v-model="calcForm.group_id" :placeholder="`${lang.input}${lang.sale_group}ID`"
                  :disabled="isAgent"></t-input>
              </t-form-item>
            </div>
            <div class="short-item">
              <t-form-item :label="lang.mf_cpu" name="cpu">
                <t-select v-model="calcForm.cpu" :placeholder="lang.mf_p22" creatable filterable
                  @create="createOptions($event, 'cpu')" :disabled="isAgent">
                  <t-option v-for="item in cpuList" :value="item.value" :label="item.value" :key="item.id"></t-option>
                </t-select>
              </t-form-item>
              <t-form-item :label="lang.mf_cpu_param" name="cpu_param">
                <t-input v-model="calcForm.cpu_param" :placeholder="lang.mf_p2" :maxlength="30"
                  :disabled="isAgent"></t-input>
              </t-form-item>
            </div>
            <div class="short-item">
              <t-form-item :label="lang.memory" name="memory">
                <t-select v-model="calcForm.memory" :placeholder="lang.mf_p22" creatable filterable
                  @create="createOptions($event, 'memory')" :disabled="isAgent">
                  <t-option v-for="item in memoryList" :value="item.value" :label="item.value"
                    :key="item.id"></t-option>
                </t-select>
              </t-form-item>
              <t-form-item :label="lang.disk" name="disk">
                <t-select v-model="calcForm.disk" :placeholder="lang.mf_p22" creatable filterable
                  @create="createOptions($event, 'disk')" :disabled="isAgent">
                  <t-option v-for="item in diskList" :value="item.value" :label="item.value" :key="item.id"></t-option>
                </t-select>
              </t-form-item>
            </div>
            <div class="short-item">
              <t-form-item :label="lang.mf_gpu">
                <t-select v-model="calcForm.gpu" :placeholder="lang.mf_p22" creatable filterable clearable
                  @create="createOptions($event, 'gpu')" :disabled="isAgent">
                  <t-option v-for="item in gpuList" :value="item.value" :label="item.value" :key="item.id"></t-option>
                </t-select>
              </t-form-item>
              <t-form-item></t-form-item>
            </div>

            <p class="com-tit">
              <span>{{lang.price_config}}</span>
            </p>
            <!-- 周期价格 -->
            <t-form-item :label="lang.order_text86">
              <div class="price-box">
                <div class="item" v-for="(item,index) in calcForm.price" :key="item.id">
                  <p class="txt">{{item.name}}</p>
                  <p class="num">
                    <!-- 循环验证 -->
                    <t-form-item :name="`price[${index}].price`"
                      :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                      <t-input v-model="item.price" @blur="blurPrice($event,index, 'calcForm')"
                        :placeholder="(calcForm.type === 'step' || calcForm.type === 'total') ? lang.mf_tip9: lang.input+lang.money"></t-input>
                    </t-form-item>
                  </p>
                </div>
                <!-- 自动填充 -->
                <div class="item">
                  <p class="txt"></p>
                  <p class="num"><t-button size="small" :disabled="isShowFill(calcForm.price)"
                      @click="autoFill('calcForm',calcForm.price)">{{lang.autofill}}</t-button>
                  </p>
                </div>
              </div>
            </t-form-item>
            <div class="box-tip">
              <p class="s-tip">{{lang.order_text36}}：</p>
              <p class="s-tip">1.{{lang.mf_p16}}</p>
              <p class="s-tip">2.{{lang.mf_p17}}</p>
            </div>
            <template v-if="!isAgent">
              <!-- 试用设置 -->
              <p class="com-tit" style="margin-top: 24px;">{{lang.ontrial_text1}}</p>
              <div class="ontrial-config">
                <div class="ontrial-item">
                  <div class="ontrial-open">
                    <span>{{lang.ontrial_text4}}</span>
                    <t-switch :custom-value="[1,0]" v-model="calcForm.ontrial">
                    </t-switch>
                  </div>
                  <t-form-item :label="lang.ontrial_text20" v-show="calcForm.ontrial === 1">
                    <t-input-number v-model="calcForm.ontrial_price" :placeholder="lang.ontrial_text20" theme="normal"
                      :min="0" :decimal-places="2">
                    </t-input-number>
                  </t-form-item>
                </div>
                <div class="ontrial-item">
                  <div class="ontrial-open">
                    <span>{{lang.ontrial_text21}}</span>
                    <t-switch :custom-value="[1,0]" v-model="calcForm.ontrial_stock_control">
                    </t-switch>
                  </div>
                  <t-form-item :label="lang.ontrial_text21" v-show="calcForm.ontrial_stock_control === 1">
                    <t-input-number v-model="calcForm.ontrial_qty" :placeholder="lang.ontrial_text21" theme="normal"
                      :min="0" :decimal-places="0">
                    </t-input-number>
                  </t-form-item>
                </div>
              </div>
            </template>
          </div>
          <div class="form-item">
            <p class="com-tit">
              <span>{{lang.mf_p18}}</span>
            </p>
            <p class="option-switch">
              {{lang.mf_p19}}
              <t-switch :custom-value="[1,0]" v-model="calcForm.support_optional" size="small" :disabled="isAgent">
              </t-switch>
              <span class="s-tip">{{lang.mf_p20}}</span>
            </p>
            <p class="option-switch">
              {{lang.mf_p30}}
              <t-switch :custom-value="[1,0]" v-model="calcForm.optional_only_for_upgrade" size="small"
                :disabled="isAgent">
              </t-switch>
              <span class="s-tip">{{lang.mf_p31}}</span>
            </p>
            <p class="option-tit">{{lang.memory}}</p>
            <t-form-item label="" class="three-item">
              <t-form-item :label="lang.mf_p23">
                <t-input-number v-model="calcForm.max_memory_num" :placeholder="lang.input" theme="normal" :min="0"
                  :decimal-places="0" :disabled="calcForm.support_optional === 0 || isAgent"></t-input-number>
                <span class="s-tip">{{lang.mf_p21}}</span>
              </t-form-item>
              <t-form-item :label="lang.mf_p24">
                <t-select v-model="calcForm.optional_memory_id" :placeholder="lang.select" multiple clearable
                  :min-collapsed-num="1" :disabled="calcForm.support_optional === 0 || isAgent">
                  <t-option v-for="item in calcOriginData('memoryList')" :value="item.id" :label="item.value"
                    :key="item.id"></t-option>
                </t-select>
              </t-form-item>
              <t-form-item :label="lang.mf_p26" class="unit-box">
                <t-input-number v-model="calcForm.leave_memory" :placeholder="lang.input" theme="normal" :min="0"
                  :decimal-places="0" :disabled="calcForm.support_optional === 0 || isAgent">
                </t-input-number>
                <span class="unit">G</span>
              </t-form-item>
            </t-form-item>
            <p class="option-tit">{{lang.disk}}</p>
            <t-form-item :label="lang.disk" class="three-item">
              <t-form-item :label="lang.mf_p25">
                <t-input-number v-model="calcForm.max_disk_num" :placeholder="lang.input" theme="normal" :min="0"
                  :decimal-places="0" :disabled="calcForm.support_optional === 0 || isAgent">
                </t-input-number>
                <span class="s-tip">{{lang.mf_p21}}</span>
              </t-form-item>
              <t-form-item :label="lang.mf_p24">
                <t-select v-model="calcForm.optional_disk_id" :placeholder="lang.select" multiple clearable
                  :min-collapsed-num="1" :disabled="calcForm.support_optional === 0 || isAgent">
                  <t-option v-for="item in calcOriginData('diskList')" :value="item.id" :label="item.value"
                    :key="item.id"></t-option>
                </t-select>
              </t-form-item>
            </t-form-item>
            <p class="option-tit">{{lang.mf_gpu}}</p>
            <t-form-item label="" class="three-item">
              <t-form-item :label="lang.mf_p29">
                <t-input-number v-model="calcForm.max_gpu_num" :placeholder="lang.input" theme="normal" :min="0"
                  :decimal-places="0" :disabled="calcForm.support_optional === 0 || isAgent">
                </t-input-number>
                <span class="s-tip">{{lang.mf_p21}}</span>
              </t-form-item>
              <t-form-item :label="lang.mf_p24">
                <t-select v-model="calcForm.optional_gpu_id" :placeholder="lang.select" multiple clearable
                  :min-collapsed-num="1" :disabled="calcForm.support_optional === 0 || isAgent">
                  <t-option v-for="item in calcOriginData('gpuList')" :value="item.id" :label="item.value"
                    :key="item.id">
                  </t-option>
                </t-select>
              </t-form-item>
            </t-form-item>
            <div class="box-tip">
              <p class="s-tip">{{lang.order_text36}}：</p>
              <p class="s-tip">1.{{lang.mf_p27}}</p>
              <!-- <p class="s-tip">2.{{lang.mf_p28}}</p> -->
            </div>
          </div>
        </div>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="calcModel=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/修改 灵活机型 -->
    <t-dialog :header="comTitle" :visible.sync="flexModel" :footer="false" width="1000" @close="closeData"
      :close-on-overlay-click="false" class="cpuDialog flex-dialog">
      <t-form :data="flexForm" ref="flexForm" @submit="submitFlex" :rules="hardRules" label-align="top"
        class="cycle-form" v-if="flexModel">
        <p class="flex-tit">{{lang.mf_recommend}}</p>
        <div class="flex-box">
          <div class="form-item">
            <div class="short-item">
              <t-form-item :label="lang.model_name" name="name">
                <t-input v-model="flexForm.name"
                  :placeholder="`${lang.input}${lang.model_name}${multiliTip}`"></t-input>
              </t-form-item>
              <t-form-item :label="`${lang.sort}ID`" name="order">
                <t-input v-model="flexForm.order" :placeholder="`${lang.input}${lang.sort}ID`"></t-input>
              </t-form-item>
            </div>
            <t-form-item :label="lang.mf_cpu" class="required">
              <t-form-item name="cpu_option_id" :required-mark="false">
                <t-select v-model="flexForm.cpu_option_id" :placeholder="`${lang.select}${lang.mf_cpu}`">
                  <t-option v-for="item in cpuList" :value="item.id" :label="item.value" :key="item.id"></t-option>
                </t-select>
              </t-form-item>
              <t-form-item name="cpu_num" :required-mark="false">
                <t-input-number v-model="flexForm.cpu_num" :placeholder="`${lang.auth_num}`" theme="normal" :min="1"
                  :decimal-places="0"></t-input-number>
              </t-form-item>
            </t-form-item>
            <t-form-item :label="lang.disk" class="required">
              <t-form-item name="disk_option_id" :required-mark="false">
                <t-select v-model="flexForm.disk_option_id" :placeholder="`${lang.select}${lang.disk}`">
                  <t-option v-for="item in diskList" :value="item.id" :label="item.value" :key="item.id"></t-option>
                </t-select>
              </t-form-item>
              <t-form-item name="disk_num" :required-mark="false">
                <t-input-number v-model="flexForm.disk_num" :placeholder="`${lang.auth_num}`" theme="normal" :min="1"
                  :decimal-places="0">
                </t-input-number>
              </t-form-item>
            </t-form-item>
            <t-form-item :label="`IP${lang.auth_num}`" name="ip_num">
              <t-input-number v-model="flexForm.ip_num" :placeholder="`${lang.input}IP${lang.auth_num}`" theme="normal"
                :min="1" :decimal-places="0">
              </t-input-number>
            </t-form-item>
          </div>
          <div class="form-item">
            <t-form-item :label="`${lang.group}ID`" name="group_id">
              <t-input v-model="flexForm.group_id" :placeholder="`${lang.input}${lang.group}ID`"></t-input>
            </t-form-item>
            <t-form-item :label="lang.memory" class="required">
              <t-form-item name="mem_option_id" :required-mark="false">
                <t-select v-model="flexForm.mem_option_id" :placeholder="`${lang.select}${lang.memory}`">
                  <t-option v-for="item in memoryList" :value="item.id" :label="item.value" :key="item.id"></t-option>
                </t-select>
              </t-form-item>
              <t-form-item name="mem_num" :required-mark="false">
                <t-input-number v-model="flexForm.mem_num" :placeholder="`${lang.auth_num}`" theme="normal" :min="1"
                  :decimal-places="0">
                </t-input-number>
              </t-form-item>
            </t-form-item>
            <t-form-item :label="lang.bw" name="bw">
              <t-input-number v-model="flexForm.bw" :placeholder="`${lang.input}${lang.bw}`" theme="normal" :min="1"
                :decimal-places="0">
              </t-input-number>
              <span class="unit">M</span>
            </t-form-item>
            <t-form-item :label="lang.description">
              <t-input v-model="flexForm.description" :placeholder="`${lang.input}${lang.description}${multiliTip}`"
                :maxlength="30"></t-input>
            </t-form-item>
          </div>
        </div>
        <!-- 选配内容 -->
        <p class="flex-tit">{{lang.optional_content}}</p>

        <div class="flex-box">
          <div class="form-item">
            <t-form-item :label="lang.optional_memory">
              <t-select v-model="flexForm.optional_memory_id" :placeholder="lang.optional_memory" multiple clearable
                @change="changeRange" :min-collapsed-num="1">
                <t-option :value="0" :label="lang.no_optional" :key="0"></t-option>
                <t-option v-for="item in memoryList" :value="item.id" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
            <t-form-item :label="lang.max_slot">
              <t-input-number v-model="flexForm.mem_max_num" :placeholder="lang.mf_p7" theme="normal" :min="0"
                :decimal-places="0" :disabled="flexForm.optional_memory_id[0] === 0"></t-input-number>
            </t-form-item>
          </div>
          <div class="form-item">
            <t-form-item :label="lang.max_size">
              <t-input-number v-model="flexForm.mem_max" :placeholder="lang.mf_p7" theme="normal" :min="0"
                :decimal-places="0" :disabled="flexForm.optional_memory_id[0] === 0">
              </t-input-number>
              <span class="unit">G</span>
            </t-form-item>
          </div>
        </div>
        <div class="flex-box">
          <div class="form-item">
            <t-form-item :label="lang.optional_disk">
              <t-select v-model="flexForm.optional_disk_id" :placeholder="lang.optional_disk" multiple clearable
                @change="changeMemRange" :min-collapsed-num="1">
                <t-option :value="0" :label="lang.no_optional" :key="0"></t-option>
                <t-option v-for="item in diskList" :value="item.id" :label="item.value" :key="item.id"></t-option>
              </t-select>
            </t-form-item>
          </div>
          <div class="form-item">
            <t-form-item :label="lang.max_number">
              <t-input-number v-model="flexForm.disk_max_num" :placeholder="lang.mf_p7" theme="normal" :min="0"
                :decimal-places="0" :disabled="flexForm.optional_disk_id[0] === 0"></t-input-number>
            </t-form-item>
          </div>
        </div>
        <div class="flex-box">
          <div class="form-item">
            <!-- 周期价格 -->
            <t-form-item :label="lang.price_config">
              <div class="price-box">
                <div class="item" v-for="(item,index) in flexForm.price" :key="item.id">
                  <p class="txt">{{item.name}}</p>
                  <p class="num">
                    <!-- 循环验证 -->
                    <t-form-item :name="`price[${index}].price`"
                      :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                      <t-input v-model="item.price" @blur="blurFlexPrice($event,index)"
                        :placeholder="lang.input+lang.money"></t-input>
                    </t-form-item>
                  </p>
                </div>
                <!-- 自动填充 -->
                <div class="item">
                  <p class="txt"></p>
                  <p class="num"><t-button size="small" :disabled="isShowFill(flexForm.price)"
                      @click="autoFill('flexForm',flexForm.price)">{{lang.autofill}}</t-button>
                  </p>
                </div>
              </div>
            </t-form-item>
          </div>
          <div class="form-item">
            <div class="tip-box">
              <p>{{lang.mf_notes}}</p>
              <p>1.{{lang.mf_p8}}</p>
              <p>2.{{lang.mf_p9}}</p>
              <p>3.{{lang.mf_p10}}</p>
              <p>4.{{lang.mf_p11}}</p>
            </div>
          </div>
        </div>

        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="flexModel=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/修改数据中心弹窗 -->
    <t-dialog :header="comTitle" :visible.sync="dataModel" :footer="false" width="635" @close="closeData">
      <t-form :data="dataForm" ref="dataForm" @submit="submitData" :rules="dataRules" class="data-form"
        v-if="dataModel">
        <t-form-item :label="lang.country" class="required">
          <t-form-item name="country_id" class="configs" :required-mark="false">
            <t-select v-model="dataForm.country_id" class="flow-type" :disabled="isAgent"
              :placeholder="`${lang.select}${lang.country}${multiliTip}`" filterable
              :popup-props="{ overlayClassName: `custom-data`, overlayInnerStyle: (trigger) => ({ width: `${trigger.offsetWidth}px` })}">
              <img class="s-icon" :class="{'noIcon': !dataForm.country_id }" slot="prefixIcon" :src="calcIcon" />
              <t-option :key="item.id" :value="item.id" :label="item.name_zh" v-for="item in countryList"
                class="custom-icon">
                <img :src="`${host}/upload/common/country/${item.iso}.png`" alt="" class="icon">
                {{item.name_zh}}
              </t-option>
            </t-select>
          </t-form-item>
          <t-form-item label="" name="city" class="configs" :required-mark="false" :rules="[
          { required: true, message: lang.input + lang.city, type: 'error' }]">
            <t-input v-model="dataForm.city" :placeholder="`${lang.input}${lang.city}${multiliTip}`"
              :disabled="isAgent"></t-input>
          </t-form-item>
        </t-form-item>
        <t-form-item :label="`${lang.area}${lang.nickname}`" name="area">
          <t-input v-model="dataForm.area" :disabled="isAgent"
            :placeholder="`${lang.input}${lang.area}${lang.nickname}${multiliTip}`"></t-input>
        </t-form-item>
        <t-form-item :label="lang.sort" name="order">
          <t-input-number v-model="dataForm.order" theme="normal" :max="999" :min="0" :decimal-places="0"
            :placeholder="`${lang.input}${lang.sort}ID`"></t-input-number>
        </t-form-item>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="closeData">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/修改 硬件配置 -->
    <t-dialog :header="comTitle" :visible.sync="hardDialog" :footer="false" width="600" @close="closeData"
      :close-on-overlay-click="false" class="cpuDialog">
      <t-form :data="hardwareForm" ref="cycleForm" @submit="submitHard" :rules="hardRules" class="cycle-form"
        v-if="hardDialog">
        <t-form-item :label="calcHardValue" name="value" :rules="[{
          required: true,
          message: lang.input + calcHardValue,
          type: 'error'}]">
          <t-input v-model="hardwareForm.value" :disabled="isAgent"
            :placeholder="`${lang.input}${hardMode === 'memory' ? (lang.memory + lang.nickname + '，'+ lang.mf_example + '：2G') :calcHardValue}${multiliTip}`"></t-input>
        </t-form-item>
        <t-form-item :label="lang.sort" name="order" v-if="hardMode !== 'cpu'">
          <t-input-number v-model="hardwareForm.order" theme="normal" :min="0" :max="999" :decimal-places="0"
            :placeholder="`${lang.input}${lang.sort}`">
          </t-input-number>
        </t-form-item>
        <t-form-item :label="lang.memory_slot" name="other_config.memory_slot" v-if="hardMode === 'memory'">
          <t-input-number v-model="hardwareForm.other_config.memory_slot" theme="normal" :min="0" :decimal-places="0"
            :placeholder="`${lang.input}${lang.memory_slot_num}`" :disabled="isAgent">
          </t-input-number>
        </t-form-item>
        <t-form-item :label="`${lang.memory}${lang.capacity}`" name="other_config.memory" v-if="hardMode === 'memory'">
          <t-input-number v-model="hardwareForm.other_config.memory" theme="normal" :min="0" :decimal-places="0"
            :placeholder="`${lang.input}${lang.memory}${lang.capacity}，${lang.mf_example}：2`" :disabled="isAgent">
          </t-input-number>
        </t-form-item>
        <!-- 周期价格 -->
        <t-form-item :label="lang.price_config">
          <div class="price-box">
            <div class="item" v-for="(item,index) in hardwareForm.price" :key="item.id">
              <p class="txt">{{item.name}}</p>
              <p class="num">
                <!-- 循环验证 -->
                <t-form-item :name="`price[${index}].price`"
                  :ruels="[ item.price * 1 ? hardRules.price : {required: true} ]">
                  <t-input v-model="item.price" @blur="blurHardPrice($event,index)"
                    :placeholder="lang.input+lang.money"></t-input>
                </t-form-item>
              </p>
            </div>
            <!-- 自动填充 -->
            <div class="item">
              <p class="txt"></p>
              <p class="num"><t-button size="small" :disabled="isShowFill(hardwareForm.price)"
                  @click="autoFill('hardwareForm',hardwareForm.price)">{{lang.autofill}}</t-button>
              </p>
            </div>
          </div>
        </t-form-item>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="hardDialog=false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>

    <!-- 新增/修改 商品初始防御策略 -->
    <t-dialog :header="lang.mf_tip49" :visible.sync="defenceModel" :footer="false" width="1100" @close="closeData"
      class="line-form defence-model" :close-on-overlay-click="false" placement="center">
      <t-form :data="defenceForm" ref="defenceForm" @submit="submitGlobalRule" :rules="dataRules" class="data-form"
        label-align="left">
        <div class="top">
          <t-form-item :label="lang.mf_tip50" label-width="auto">
            <t-switch :custom-value="[1,0]" :value="defenceForm.sync_firewall_rule" @change="changeSyncRule">
            </t-switch>
          </t-form-item>
        </div>
        <div class="config">
          <div class="con">
            <template v-if="defenceForm.sync_firewall_rule">
              <div class="c-item">
                <div class="com-top">
                  <span></span>
                  <div class="add-btn gray" @click="getAllRules" v-if="!isAgent">
                    {{lang.mf_tip51}}
                  </div>
                </div>
                <t-table row-key="id" :data="checkedFirewallRule" size="medium" :columns="calcColums('global_defence')"
                  :hover="hover" :loading="checkRuleloading" :table-layout="tableLayout ? 'auto' : 'fixed'"
                  drag-sort="row-handler" @drag-sort="onGlobalDefenceDragSort" display-type="fixed-width"
                  :hide-sort-tips="true" max-height="420px" class="rule-table">
                  <template slot="sortIcon">
                    <t-icon name="caret-down-small"></t-icon>
                  </template>
                  <template #fir="{row}">
                    {{row.defense_peak}}
                  </template>
                  <template #drag="{row}">
                    <t-icon name="move"></t-icon>
                  </template>
                  <template #price="{row}">
                    {{currency_prefix}}
                    <template v-if="lineType === 'add'">
                      {{calcPrice(row.price)}}
                    </template>
                    <template v-else>
                      {{(row.price*1).toFixed(2)}}
                      <template v-if="row.duration">/{{row.duration}}</template>
                    </template>
                    &nbsp;{{lang.rise}}
                  </template>
                  <template #op="{row,rowIndex}">
                    <div class="com-opt">
                      <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                        <t-icon name="edit-1" @click="editRuleItem(row)"></t-icon>
                      </t-tooltip>
                      <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                        <t-icon name="delete" @click="delRuleItem(row)" :class="{'server-disabled': isAgent}">
                        </t-icon>
                      </t-tooltip>
                    </div>
                  </template>
                </t-table>
                <t-form-item :label="lang.mf_tip53" label-width="auto" v-show="checkedFirewallRule.length"
                  name="order_default_defence"
                  :rules="checkedFirewallRule.length ? [ { required: true, message: lang.mf_tip59, type: 'error' } ] : [{required: false}]">
                  <t-select v-model="defenceForm.order_default_defence" class="choose-default">
                    <t-option v-for="item in checkedFirewallRule" :value="item.value" :label="item.defense_peak"
                      :key="item.value">
                    </t-option>
                  </t-select>
                </t-form-item>
              </div>
              <!-- 右侧 -->
              <div class="c-item">
                <div class="empty" v-show="!lineRight">
                  <p>{{lang.mf_tip12}}</p>
                </div>
                <!-- 新增、编辑线路子项 -->
                <div class="opt" v-if="lineRight">
                  <t-form :data="gpuForm" ref="cycleForm" @submit="submitRuleSub" :rules="calcRules" class="sub-form"
                    label-align="top">
                    <div class="scroll">
                      <!-- 导入防御规则 -->
                      <template v-if="optType === 'add'">
                        <t-form-item :label="lang.mf_tip61" label-width="auto" label-align="left" class="required">
                          <t-select v-model="defenceForm.firewall_type" @change="changeFirewallType">
                            <t-option v-for="item in allFirewallRuleType" :value="item.type" :label="item.name"
                              :key="item.type">
                            </t-option>
                          </t-select>
                        </t-form-item>
                        <div class="import-rule">
                          <t-button @click="importRule">{{lang.mf_tip54}}</t-button>
                        </div>
                        <t-table row-key="id" :data="allFirewallRule" size="medium" :columns="allFirewallColumns"
                          :hover="hover" :loading="firewallLoading" table-layout="auto" display-type="fixed-width"
                          :hide-sort-tips="true" @select-change="rehandleSelectRule" :selected-row-keys="checkRuleId"
                          max-height="370px" class="rule-table">
                          <template slot="sortIcon">
                            <t-icon name="caret-down-small"></t-icon>
                          </template>
                        </t-table>
                        <p class="s-tip">{{lang.mf_tip56}}</p>
                        <p class="s-tip">{{lang.mf_tip57}}</p>
                        <p class="s-tip">{{lang.mf_tip58}}</p>
                      </template>
                      <!-- 编辑 -->
                      <template v-else>
                        <t-form-item :label="lang.mf_tip55">
                          <t-input v-model="defencePeak" disabled></t-input>
                        </t-form-item>
                        <t-form-item :label="lang.mf_tip52">
                          <t-input v-model="defenceRuleName" disabled></t-input>
                        </t-form-item>
                        <!-- 周期价格 -->
                        <t-form-item :label="lang.price">
                          <div class="price-box">
                            <div class="item" v-for="(item,index) in defenceForm.price" :key="item.id">
                              <p class="txt">{{item.name}}</p>
                              <p class="num">
                                <!-- 循环验证 -->
                                <t-form-item :name="`price[${index}].price`"
                                  :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                                  <t-input v-model="item.price" :placeholder="lang.input + lang.money"
                                    @blur="blurPrice($event,index, 'defenceForm')"></t-input>
                                </t-form-item>
                              </p>
                            </div>
                            <!-- 自动填充 -->
                            <div class="item">
                              <p class="txt"></p>
                              <p class="num"><t-button size="small" :disabled="isShowFill(defenceForm.price)"
                                  @click="autoFill('defenceForm',defenceForm.price)">{{lang.autofill}}</t-button>
                              </p>
                            </div>
                          </div>
                        </t-form-item>
                      </template>
                    </div>
                    <div class="com-btn">
                      <t-button theme="primary" type="submit" :loading="submitLoading"
                        v-show="optType !== 'add'">{{lang.hold}}
                      </t-button>
                      <t-button theme="default" variant="base" @click="lineRight=false">{{lang.back}}</t-button>
                    </div>
                  </t-form>
                </div>
              </div>
            </template>
          </div>
          <div class="bot-opt" :class="{'hide-opt': lineRight && optType !== 'add'}">
            <div class="b-item">
              <div class="com-btn">
                <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                </t-button>
                <t-button theme="default" variant="base" @click="defenceModel = false">{{lang.cancel}}</t-button>
              </div>
            </div>
          </div>
        </div>
      </t-form>
    </t-dialog>

    <!-- 新增/修改 线路 -->
    <t-dialog :header="lang.line" :visible.sync="lineModel" :footer="false" width="1100" @close="closeData"
      class="line-form" :close-on-overlay-click="false" placement="center">
      <t-form :data="lineForm" ref="lineForm" @submit="submitLine" :rules="dataRules" class="data-form"
        v-if="lineModel">
        <div class="top">
          <div class="sort">
            <t-form-item :label="lang.country" class="required" v-if="lineType === 'add'">
              <t-form-item name="country_id" class="configs" :required-mark="false">
                <t-select v-model="lineForm.country_id" class="flow-type"
                  :placeholder="`${lang.select}${lang.country}${multiliTip}`" filterable @change="changeCountry"
                  :popup-props="{ overlayClassName: `custom-data`, overlayInnerStyle: (trigger) => ({ width: `${trigger.offsetWidth}px` })}">
                  <img class="s-icon" :class="{'noIcon': !dataForm.country_id && !lineForm.country_id }"
                    slot="prefixIcon" :src="calcIcon1" />
                  <t-option :key="item.id" :value="item.id" :label="item.name" v-for="item in countrySelect"
                    class="custom-icon">
                    <img :src="`${host}/upload/common/country/${item.iso}.png`" alt="" class="icon">
                    {{item.name}}
                  </t-option>
                </t-select>
              </t-form-item>
              <t-form-item label="" name="city" class="configs" :required-mark="false">
                <t-select v-model="lineForm.city" class="flow-type" @change="changeCity"
                  :placeholder="`${lang.select}${lang.city}${multiliTip}`">
                  <t-option :key="c" :value="city.name" :label="city.name" v-for="(city, c) in calcCity">
                  </t-option>
                </t-select>
              </t-form-item>
              <t-form-item label="" name="data_center_id" class="configs" :required-mark="false">
                <t-select v-model="lineForm.data_center_id" class="flow-type"
                  :placeholder="`${lang.select}${lang.area}${multiliTip}`">
                  <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in calcArea">
                  </t-option>
                </t-select>
              </t-form-item>
            </t-form-item>
          </div>
          <div class="sort">
            <t-form-item :label="lang.line_name" name="name" class="line-name"
              :rules="[{ required: true, message: `${lang.input}${lang.line_name}`, type: 'error' },]">
              <t-input v-model="lineForm.name" :placeholder="`${lang.input}${lang.line_name}${multiliTip}`"
                :maxlength="50"></t-input>
            </t-form-item>
            <t-form-item :label="lang.sort" name="order" label-width="120px">
              <t-input-number v-model="lineForm.order" theme="normal" :max="999" :min="0" :decimal-places="0"
                :placeholder="`${lang.input}${lang.sort}`"></t-input-number>
            </t-form-item>
          </div>
        </div>
        <div class="bg"></div>
        <div class="config">
          <p class="p-tit">{{lang.bw_price_config}}</p>
          <div class="con">
            <!-- 左侧 -->
            <div class="c-item">
              <t-form-item :label="`${lang.billing_way}`" name="bill_type" label-align="left" class="required"
                v-if="lineType === 'add'">
                <t-select v-model="lineForm.bill_type" class="bill-type" @change="lineRight=false">
                  <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in billType">
                  </t-option>
                </t-select>
              </t-form-item>
              <!-- bw_data -->
              <template v-if="lineForm.bill_type === 'bw'">
                <div class="com-top">
                  <p class="tit">
                    {{lang.billing_way}}
                    <template v-if="calcSubTitle(lineForm.bw_data)">
                      {{calcSubTitle(lineForm.bw_data)}}
                    </template>
                  </p>
                  <div class="add-btn gray" @click="addLineSub('line_bw')" :class="{'server-disabled': isAgent}">
                    {{lang.order_text53}}
                  </div>
                </div>
                <t-table row-key="id" :data="lineForm.bw_data" size="medium" :columns="bwColumns" :hover="hover"
                  :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                  :hide-sort-tips="true">
                  <template slot="sortIcon">
                    <t-icon name="caret-down-small"></t-icon>
                  </template>
                  <template #fir="{row}">
                    <template v-if="row.type==='radio'">
                      <span v-if="row.value_show">{{row.value}}({{row.value_show}})</span>
                      <span v-else>{{row.value}}</span>
                    </template>
                    <template v-else>
                      {{row.min_value}}-{{row.max_value}}
                    </template>
                  </template>
                  <template #price="{row}">
                    <!-- 新增线路的时候本地处理显示 -->
                    {{currency_prefix}}
                    <template v-if="lineType === 'add'">
                      {{calcPrice(row.price)}}
                    </template>
                    <template v-else>
                      {{(row.price*1).toFixed(2)}}
                      <template v-if="row.duration">/{{row.duration}}</template>
                    </template>
                    &nbsp;{{lang.rise}}
                  </template>
                  <template #op="{row, rowIndex}">
                    <div class="com-opt">
                      <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                        <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_bw')"></t-icon>
                      </t-tooltip>
                      <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                        <t-icon name="delete" @click="comDel('line_bw',row,rowIndex)"
                          :class="{'server-disabled': isAgent}"></t-icon>
                      </t-tooltip>
                    </div>
                  </template>
                </t-table>
                <p class="advance_config" @click="bw_ip_show = !bw_ip_show" v-if="!isAgent">
                  {{lang.advance_config}}
                  <template>
                    <t-icon :name="bw_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                  </template>
                </p>
                <!-- 高级设置 -->
                <div class="advance_box" v-show="bw_ip_show && !isAgent">
                  <t-form-item :label="`IP${lang.group}`" label-align="top">
                    <t-input v-model="lineForm.bw_ip_group" :placeholder="lang.input"></t-input>
                  </t-form-item>
                </div>
              </template>
              <template v-else>
                <!-- 流量 -->
                <div class="com-top">
                  <p class="tit">
                    {{lang.traffic_billing}}
                    <template v-if="calcSubTitle(lineForm.flow_data)"></template>
                  </p>
                  <div class="add-btn gray" @click="addLineSub('line_flow')" :class="{'server-disabled': isAgent}">
                    {{lang.order_text53}}
                  </div>
                </div>
                <t-table row-key="id" :data="lineForm.flow_data" size="medium" :columns="calcColums('flow')"
                  :hover="hover" :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'"
                  display-type="fixed-width" :hide-sort-tips="true">
                  <template slot="sortIcon">
                    <t-icon name="caret-down-small"></t-icon>
                  </template>
                  <template #fir="{row}">
                    <span>{{row.value}}</span>
                  </template>
                  <template #price="{row}">
                    <!-- 新增线路的时候本地处理显示 -->
                    {{currency_prefix}}
                    <template v-if="lineType === 'add'">
                      {{calcPrice(row.price)}}
                    </template>
                    <template v-else>
                      {{(row.price*1).toFixed(2)}}
                      <template v-if="row.duration">/{{row.duration}}</template>
                    </template>
                    &nbsp;{{lang.rise}}
                  </template>
                  <template #op="{row, rowIndex}">
                    <div class="com-opt">
                      <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                        <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_flow')"></t-icon>
                      </t-tooltip>
                      <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                        <t-icon name="delete" @click="comDel('line_flow',row, rowIndex)"
                          :class="{'server-disabled': isAgent}"></t-icon>
                      </t-tooltip>
                    </div>
                  </template>
                </t-table>
                <p class="s-tip">{{lang.mf_tip21}}</p>
                <!-- 高级设置 -->
                <p class="advance_config" @click="bw_ip_show = !bw_ip_show" v-if="!isAgent">
                  {{lang.advance_config}}
                  <template>
                    <t-icon :name="bw_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                  </template>
                </p>
                <div class="advance_box" v-show="bw_ip_show && !isAgent">
                  <t-form-item :label="`IP${lang.group}`" label-align="top">
                    <t-input v-model="lineForm.bw_ip_group" :placeholder="lang.input"></t-input>
                  </t-form-item>
                </div>
              </template>
              <!-- 公网IP价格配置 -->
              <div class="com-top">
                <p class="tit">
                  {{lang.public_ip_config}}
                </p>
                <div class="add-btn gray" @click="addLineSub('line_ip')" :class="{'server-disabled': isAgent}">
                  {{lang.order_text53}}
                </div>
              </div>
              <t-table row-key="id" :data="lineForm.ip_data" size="medium" :columns="calcColums('ip')" :hover="hover"
                :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
                :hide-sort-tips="true">
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #fir="{row}">
                  <template v-if="lineType === 'add'">
                    <template v-if="row.type === 'radio'">
                      {{calcIpNum(row.value)}}
                    </template>
                    <template v-else>
                      {{row.min_value}}-{{row.max_value}}
                    </template>
                  </template>
                  <template v-else>
                    <template v-if="row.type === 'radio'">
                      <span v-if="row.value_show">{{row.value}}({{row.value_show}})</span>
                      <span v-else>{{row.value}}</span>
                    </template>
                    <template v-else>
                      {{row.min_value}}-{{row.max_value}}
                    </template>
                  </template>
                </template>
                <template #price="{row}">
                  <!-- 新增线路的时候本地处理显示 -->
                  {{currency_prefix}}
                  <template v-if="lineType === 'add'">
                    {{calcPrice(row.price)}}
                  </template>
                  <template v-else>
                    {{(row.price*1).toFixed(2)}}
                    <template v-if="row.duration">/{{row.duration}}</template>
                  </template>
                  &nbsp;{{lang.rise}}
                </template>
                <template #op="{row,rowIndex}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1" @click="editSubItem(row,rowIndex,'line_ip')"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('line_ip',row,rowIndex)"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
              <!-- 防护价格配置 -->
              <div class="com-top">
                <p class="tit">
                  <t-form-item :label="lang.protect_price_config">
                    <t-switch :custom-value="[1,0]" v-model="lineForm.defence_enable" size="small" :disabled="isAgent"
                      @change="changeLineDefenceEnable">
                    </t-switch>
                  </t-form-item>
                </p>
                <div class="add-btn gray" @click="addLineSub('line_defence')"
                  v-show="lineForm.defence_enable && lineForm.sync_firewall_rule === 0"
                  :class="{'server-disabled': isAgent}">
                  {{lang.order_text53}}
                </div>
              </div>
              <!-- 全局防火墙 -->
              <div class="com-top firewall" v-show="lineForm.defence_enable && hasFirewall && isFirewallProduct">
                <p class="tit">
                  <t-form-item :label="lang.mf_tip50">
                    <t-switch :custom-value="[1,0]" :value="lineForm.sync_firewall_rule" size="small"
                      :disabled="isAgent" @change="changeLineFirewallRule">
                    </t-switch>
                  </t-form-item>
                </p>
                <div class="add-btn gray" @click="getAllRules" v-show="lineForm.sync_firewall_rule"
                  :class="{'server-disabled': isAgent}">
                  {{lang.mf_tip51}}
                </div>
              </div>
              <t-table row-key="id" :data="lineForm.defence_data" size="medium" :columns="calcColums('defence')"
                :hover="hover" :loading="loading" :table-layout="tableLayout ? 'auto' : 'fixed'" drag-sort="row-handler"
                @drag-sort="onDefenceDragSort" display-type="fixed-width" :hide-sort-tips="true"
                v-show="lineForm.defence_enable">
                <template #drag="{row}">
                  <t-icon name="move"></t-icon>
                </template>
                <template slot="sortIcon">
                  <t-icon name="caret-down-small"></t-icon>
                </template>
                <template #fir="{row}">
                  {{ lineForm.sync_firewall_rule ? row.defense_peak : row.value }}
                </template>
                <template #price="{row}">
                  <!-- 新增线路的时候本地处理显示 -->
                  {{currency_prefix}}
                  <template v-if="lineType === 'add'">
                    {{calcPrice(row.price)}}
                  </template>
                  <template v-else>
                    {{(row.price*1).toFixed(2)}}
                    <template v-if="row.duration">/{{row.duration}}</template>
                  </template>
                  &nbsp;{{lang.rise}}
                </template>
                <template #op="{row,rowIndex}">
                  <div class="com-opt">
                    <t-tooltip :content="lang.edit" :show-arrow="false" theme="light">
                      <t-icon name="edit-1"
                        @click="editSubItem(row,rowIndex,'line_defence', row.firewall_type)"></t-icon>
                    </t-tooltip>
                    <t-tooltip :content="lang.delete" :show-arrow="false" theme="light">
                      <t-icon name="delete" @click="comDel('line_defence',row,rowIndex)"
                        :class="{'server-disabled': isAgent}"></t-icon>
                    </t-tooltip>
                  </div>
                </template>
              </t-table>
              <!-- 线路选择默认防御 -->
              <t-form-item :label="lang.mf_tip53" label-width="auto"
                v-show="lineForm.defence_enable && lineForm.sync_firewall_rule && isFirewallProduct" class="mt20">
                <t-select v-model="lineForm.order_default_defence" class="choose-default">
                  <t-option v-for="item in lineForm.defence_data" :value="item.value" :label="item.defense_peak"
                    :key="item.value">
                  </t-option>
                </t-select>
              </t-form-item>
              <div v-show="lineForm.defence_enable">
                <p class="advance_config" @click="defence_ip_show = !defence_ip_show" v-if="!isAgent">
                  {{lang.advance_config}}
                  <template>
                    <t-icon :name="defence_ip_show ? 'chevron-up' : 'chevron-down'"></t-icon>
                  </template>
                </p>
                <!-- 高级设置 -->
                <div class="advance_box" v-show="defence_ip_show && !isAgent">
                  <t-form-item :label="`IP${lang.group}`" label-align="top">
                    <t-input v-model="lineForm.defence_ip_group" :placeholder="lang.input"></t-input>
                  </t-form-item>
                </div>
              </div>

            </div>
            <!-- 右侧 -->
            <div class="c-item">
              <div class="empty" v-show="!lineRight">
                <p>{{lang.mf_tip12}}</p>
              </div>
              <!-- 新增、编辑线路子项 -->
              <div class="opt" v-if="lineRight">
                <t-form :data="subForm" ref="cycleForm" @submit="submitSub" :rules="calcRules" class="sub-form"
                  label-align="top">
                  <div class="scroll">
                    <!-- 配置方式 -->
                    <t-form-item :label="`${lang.billing_way}`" name="type"
                      v-if="subType === 'line_bw' || subType === 'line_ip' " class="mem-congfig">
                      <t-select v-model="subForm.type" :placeholder="`${lang.select}${lang.billing_way}`"
                        :disabled="calcShow || isAgent">
                        <t-option :key="item.value" :value="item.value" :label="item.label" v-for="item in configType">
                        </t-option>
                      </t-select>
                    </t-form-item>
                    <!-- line_defence -->
                    <template v-if="subType === 'line_defence'">
                      <!-- 导入防火墙规则 -->
                      <template v-if="optType === 'add' && !isShowLinePrice">
                        <t-form-item :label="lang.mf_tip61" label-width="auto" label-align="left" class="required">
                          <t-select v-model="defenceForm.firewall_type" @change="changeFirewallType">
                            <t-option v-for="item in allFirewallRuleType" :value="item.type" :label="item.name"
                              :key="item.type">
                            </t-option>
                          </t-select>
                        </t-form-item>
                        <div class="import-rule">
                          <t-button @click="importLineRule">{{lang.mf_tip54}}</t-button>
                        </div>
                        <t-table row-key="id" :data="allFirewallRule" size="medium" :columns="allFirewallColumns"
                          :hover="hover" :loading="firewallLoading" table-layout="auto" display-type="fixed-width"
                          :hide-sort-tips="true" @select-change="rehandleSelectRule" :selected-row-keys="checkRuleId"
                          max-height="370px" class="rule-table">
                          <template slot="sortIcon">
                            <t-icon name="caret-down-small"></t-icon>
                          </template>
                        </t-table>
                        <p class="s-tip">{{lang.mf_tip56}}</p>
                        <p class="s-tip">{{lang.mf_tip57}}</p>
                        <p class="s-tip">{{lang.mf_tip58}}</p>
                      </template>
                      <!-- 修改防火墙规则 -->
                      <template v-else>
                        <template v-if="!isEditDefence">
                          <t-form-item :label="lang.defence + '（Gbps）'" name="value"
                            :rules="calcReg(lang.defence,0,9999999)">
                            <t-input v-model="subForm.value" :placeholder="lang.input+lang.defence" :disabled="isAgent">
                            </t-input>
                          </t-form-item>
                        </template>
                        <template v-else>
                          <t-form-item :label="lang.mf_tip55">
                            <t-input v-model="subForm.defense_peak" disabled></t-input>
                          </t-form-item>
                          <t-form-item :label="lang.mf_tip52">
                            <t-input v-model="subForm.defence_rule_name" disabled></t-input>
                          </t-form-item>
                        </template>
                      </template>
                    </template>
                    <!-- line_flow -->
                    <t-form-item :label="lang.cloud_flow + '（GB）'" name="value" v-if="subType === 'line_flow'"
                      :rules="calcReg(lang.bw,0,9999999)">
                      <t-input v-model="subForm.value" :placeholder="lang.input+lang.cloud_flow"
                        :disabled="isAgent"></t-input>
                    </t-form-item>
                    <!-- line_ip -->
                    <t-form-item :label="`IP${lang.auth_num}（${lang.one}）`" v-if="subType === 'line_ip'"
                      class="required">
                      <template v-if="subForm.type === 'radio'">
                        <t-form-item class="mul-select">
                          <t-form-item label=" " name="value" :required-mark="false" :rules="hardRules.ip_num"
                            :class="{all: subForm.value !== 'NC' && subForm.value !== 'NO_CHANGE'}" ref="ip-item">
                            <t-input v-model="subForm.value" :placeholder="`${lang.input}IP${lang.auth_num}`"
                              @change="changeBw($event,'ip-item')" :disabled="isAgent">
                            </t-input>
                          </t-form-item>
                          <t-form-item label=" " v-if="subForm.value === 'NC' || subForm.value === 'NO_CHANGE'">
                            <t-input style="margin-left: 10px;" v-model="subForm.value_show"
                              :placeholder="lang.mf_tip43" :disabled="isAgent">
                            </t-input>
                          </t-form-item>
                        </t-form-item>
                      </template>
                      <template v-else>
                        <t-form-item class="mul-select">
                          <t-form-item name="min_value" :required-mark="false" :rules="calcReg(lang.min_value,0,10000)">
                            <t-input v-model="subForm.min_value" :placeholder="lang.min_value"
                              @blur="changeMin($event, 'subForm')" :disabled="isAgent"></t-input>
                          </t-form-item>
                          <t-form-item name="max_value" :required-mark="false" :rules="calcReg(lang.max_value,0,10000)">
                            <t-input v-model="subForm.max_value" :placeholder="lang.max_value"
                              @blur="changeMax($event, 'subForm')" :disabled="isAgent"></t-input>
                          </t-form-item>
                        </t-form-item>
                      </template>
                    </t-form-item>
                    <div class="bw-tip" style="margin-top: -10px;" :class="{suc: bwValidator}"
                      v-if="subType === 'line_ip' && subForm.type === 'radio'" :key="new Date().getTime()">
                      <div>*{{lang.mf_tip32}}</div>
                      <div>*{{lang.mf_tip41}}</div>
                    </div>

                    <template v-if="subType === 'line_flow'">
                      <t-form-item class="line_flow bw-limit" :label="`${lang.bw_limit}（Mbps）`">
                        <t-form-item label="" name="other_config.out_bw" :label="lang.out" label-align="left"
                          class="limit" :rules="calcReg(lang.out_bw,0,30000)">
                          <t-input v-model="subForm.other_config.out_bw" :placeholder="lang.out_bw"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                        <t-form-item label="" name="other_config.in_bw" :label="lang.in" label-align="left"
                          class="limit" :rules="calcReg(lang.in_bw,0,30000)">
                          <t-input v-model="subForm.other_config.in_bw" :placeholder="lang.in_bw"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                      </t-form-item>
                    </template>
                    <!-- 内存/系统盘/数据盘 -->
                    <t-form-item :label="calcName(subType)" v-if="subType === 'line_bw'" class="required">
                      <div v-if="subForm.type === 'radio'" class="tip-item" style="width: 100%;">
                        <t-form-item name="value" class="no-lable" :rules="calcReg(lang.bw,1,30000,'nc')" ref="bw-item">
                          <t-input v-model="subForm.value" :placeholder="lang.input+calcName(subType)"
                            @change="changeBw($event,'bw-item')" :disabled="isAgent">
                          </t-input>
                          <t-input style="margin-left: 10px;" v-model="subForm.value_show" :placeholder="lang.mf_tip44"
                            v-if="subForm.value === 'NC' || subForm.value === 'NO_CHANGE'" :disabled="isAgent">
                          </t-input>
                        </t-form-item>
                        <div class="bw-tip" :class="{suc: bwValidator}">
                          <div>*{{lang.mf_tip31}}</div>
                          <div>*{{lang.mf_tip42}}</div>
                        </div>
                      </div>

                      <t-form-item v-else class="mul-select">
                        <t-form-item label=" " name="min_value" :required-mark="false"
                          :rules="calcReg(lang.bw,1,30000)">
                          <t-input v-model="subForm.min_value" :placeholder="lang.min_value" @blur="changeMin"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                        <t-form-item label=" " name="max_value" :required-mark="false"
                          :rules="calcReg(lang.bw,1,30000)">
                          <t-input v-model="subForm.max_value" :placeholder="lang.max_value" @blur="changeMax"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                        <!-- <t-form-item label=" " name="step" :required-mark="false">
                          <t-input v-model="subForm.step" :placeholder="lang.min_step"
                            @blur="changeStep"></t-input>
                        </t-form-item> -->
                      </t-form-item>
                    </t-form-item>
                    <!-- 周期价格 -->
                    <t-form-item :label="lang.price" v-if="isShowLinePrice">
                      <div class="price-box">
                        <div class="item" v-for="(item,index) in subForm.price" :key="item.id">
                          <p class="txt">{{item.name}}</p>
                          <p class="num">
                            <!-- 循环验证 -->
                            <t-form-item :name="`price[${index}].price`"
                              :ruels="[ item.price * 1 ? calcRules.price : {required: true} ]">
                              <t-input v-model="item.price" @blur="blurSubPrice($event,index)"
                                :placeholder="((subForm.type === 'step' || subForm.type === 'total') && subType === 'line_bw') ? lang.mf_tip26: lang.input+lang.money"></t-input>
                            </t-form-item>
                          </p>
                        </div>
                        <!-- 自动填充 -->
                        <div class="item">
                          <p class="txt"></p>
                          <p class="num"><t-button size="small" :disabled="isShowFill(subForm.price)"
                              @click="autoFill('subForm',subForm.price)">{{lang.autofill}}</t-button>
                          </p>
                        </div>
                      </div>
                    </t-form-item>
                    <!-- 流量 -->
                    <template v-if="subType === 'line_flow'">
                      <t-form-item :label="`${lang.billing_cycle}`" class="mem-congfig" name="other_config.bill_cycle">
                        <template slot="label">
                          <t-tooltip :content="lang.mf_tip28 + '\n' + lang.mf_tip29" :show-arrow="false" theme="light"
                            placement="top-left">
                            <span>{{lang.billing_cycle}}</span>
                            <t-icon name="help-circle"></t-icon>
                          </t-tooltip>
                        </template>
                        <t-select v-model="subForm.other_config.bill_cycle"
                          :placeholder="`${lang.select}${lang.billing_cycle}`" :disabled="isAgent">
                          <t-option :key="item.value" :value="item.value" :label="item.label"
                            v-for="item in billingCycle">
                          </t-option>
                        </t-select>
                      </t-form-item>
                    </template>

                    <p class="advance_config" v-if="subType === 'line_bw'" @click="changeAdvance">
                      {{lang.advance_config}}
                      <template>
                        <t-icon :name="isAdvance ? 'chevron-up' : 'chevron-down'"></t-icon>
                      </template>
                    </p>
                    <!-- 子项高级设置 -->
                    <div class="advance_box" v-show="isAdvance">
                      <template v-if="subType === 'line_bw'">
                        <t-form-item :label="lang.inflow_bw" label-align="top">
                          <t-input v-model="subForm.other_config.in_bw" :placeholder="lang.input"
                            :disabled="isAgent"></t-input>
                        </t-form-item>
                      </template>
                      <!-- <template v-if="calcType === 'system_disk' || calcType === 'data_disk'">
                        <t-form-item :label="lang.advanced_bw" label-align="top">
                          <t-input v-model="calcForm.other_config.disk_type" :placeholder="lang.input"></t-input>
                        </t-form-item>
                      </template> -->
                    </div>
                  </div>
                  <div class="com-btn">
                    <t-button theme="primary" type="submit" :loading="submitLoading"
                      v-show="isShowLinePrice">{{lang.hold}}
                    </t-button>
                    <t-button theme="default" variant="base" @click="lineRight=false">{{lang.back}}</t-button>
                  </div>
                </t-form>
              </div>
            </div>
          </div>
          <div class="bot-opt" :class="{'hide-opt': lineRight}">
            <div class="b-item">
              <div class="com-btn">
                <t-button theme="primary" type="submit" :loading="submitLoading">{{lang.hold}}
                </t-button>
                <t-button theme="default" variant="base" @click="closeData">{{lang.cancel}}</t-button>
              </div>
            </div>
          </div>
        </div>
      </t-form>
    </t-dialog>
    <!-- 新增/修改 配置限制 -->
    <t-dialog :header="comTitle" :visible.sync="limitModel" :footer="false" :width="isEn ? 800 : 680" @close="closeData"
      class="limit-dialog">
      <div class="top-info">
        <p class="tit">{{lang.mf_choose_config}}</p>
        <p class="s-tip">{{lang.mf_choose_tip}}</p>
      </div>
      <t-form :data="limitForm" ref="limitForm" @submit="submitLimit" :rules="limitRules" class="data-form limit-form"
        v-if="limitModel" label-width="120px">
        <!-- 条件 -->
        <div class="limit-item">
          <p>{{lang.mf_condition}}：</p>
          <div class="check-box">
            <t-checkbox-group v-model="ruleLimit">
              <t-checkbox :key="item.type" :value="item.type" :label="item.name" v-for="item in calcCheckbox"
                :disabled="disabeldCheck('rule',item.type)">
              </t-checkbox>
            </t-checkbox-group>
          </div>
          <!-- 数据中心 -->
          <t-form-item :label="lang.data_center" class="required limit-bw" v-if="showLimitItem('rule','data_center')">
            <t-select v-model="limitForm.rule.data_center.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <t-form-item name="rule.data_center.id">
              <t-select v-model="limitForm.rule.data_center.id" class="flow-type"
                :placeholder="lang.select+lang.data_center" multiple :min-collapsed-num="1" clearable>
                <t-option :key="item.id" :value="item.id" :label="`${item.country_name}-${item.city}-${item.area}`"
                  v-for="item in dataList">
                </t-option>
              </t-select>
            </t-form-item>
          </t-form-item>
          <!-- 型号 -->
          <t-form-item :label="lang.mf_model" class="required limit-bw" v-if="showLimitItem('rule','model_config')">
            <t-select v-model="limitForm.rule.model_config.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <t-form-item name="rule.model_config.id">
              <t-select v-model="limitForm.rule.model_config.id" :placeholder="lang.select+lang.mf_model" multiple
                :min-collapsed-num="1">
                <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in modelList">
                </t-option>
              </t-select>
            </t-form-item>
          </t-form-item>
          <!-- <t-form-item :label="`IPv4${lang.auth_num}（${lang.one}）`" class="required limit-bw"
            v-if="showLimitItem('ipv4_num')">
            <t-form-item lable="" name="ipv4_num.min" :required-mark="false"
              :rules="calcReg(`IPv4${lang.auth_num}`,0,99999999)">
              <t-input-number v-model="limitForm.ipv4_num.min" :placeholder="lang.min_value" theme="normal"
                :decimal-places="0" @blur="changeLimitRange($event,'ipv4_num','min')"></t-input-number>
            </t-form-item>
            <t-form-item lable="" name="ipv4_num.max" :required-mark="false"
              :rules="[ limitForm.flow.max === '' ? {} : calcReg(`IPv4${lang.auth_num}`, 0, 99999999) ]">
              <t-input-number v-model="limitForm.ipv4_num.max" :placeholder="lang.max_value_tip" theme="normal"
                :decimal-places="0" @blur="changeLimitRange($event,'ipv4_num','max')">
              </t-input-number>
            </t-form-item>
          </t-form-item> -->
          <t-form-item :label="`${lang.bw}（M）`" class="required limit-bw" v-if="showLimitItem('rule','bw')">
            <t-select v-model="limitForm.rule.bw.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <t-form-item lable="" name="rule.bw.min" :required-mark="false" :rules="calcReg(lang.bw,0,99999999)">
              <t-input-number v-model="limitForm.rule.bw.min" :placeholder="lang.min_value" theme="normal"
                :decimal-places="0" @blur="changeLimitRange($event,'bw','min','rule','rule')"></t-input-number>
            </t-form-item>
            <t-form-item lable="" name="rule.bw.max" :required-mark="false"
              :rules="[ limitForm.rule.bw.max === '' ? {} : calcReg(lang.bw, 0, 99999999) ]">
              <t-input-number v-model="limitForm.rule.bw.max" :placeholder="lang.max_value_tip" theme="normal"
                :decimal-places="0" @blur="changeLimitRange($event,'bw','max','rule','rule')">
              </t-input-number>
            </t-form-item>
          </t-form-item>
          <t-form-item :label="`${lang.cloud_flow}（G）`" class="required limit-bw" v-if="showLimitItem('rule','flow')">
            <t-select v-model="limitForm.rule.flow.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <t-form-item lable="" name="rule.flow.min" :required-mark="false"
              :rules="calcReg(lang.cloud_flow,0,99999999)">
              <t-input-number v-model="limitForm.rule.flow.min" :placeholder="lang.min_value" theme="normal"
                :decimal-places="0" @blur="changeLimitRange($event,'flow','min','rule')"></t-input-number>
            </t-form-item>
            <t-form-item lable="" name="rule.flow.max" :required-mark="false"
              :rules="[ limitForm.rule.flow.max === '' ? {} : calcReg(lang.cloud_flow, 0, 99999999) ]">
              <t-input-number v-model="limitForm.rule.flow.max" :placeholder="lang.max_value_tip" theme="normal"
                :decimal-places="0" @blur="changeLimitRange($event,'flow','max','rule')">
              </t-input-number>
            </t-form-item>
          </t-form-item>
          <t-form-item :label="lang.opt_system" class="required limit-bw" v-if="showLimitItem('rule','image')">
            <t-select v-model="limitForm.rule.image.opt" class="short">
              <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
              <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
            </t-select>
            <t-form-item name="rule.image.id">
              <t-cascader :placeholder="lang.select+lang.system_classify" v-model="limitForm.rule.image.id"
                :options="calcCascadeImage" multiple clearable :min-collapsed-num="1"
                :keys="{ label: 'name', value: 'id' }">
              </t-cascader>
            </t-form-item>
          </t-form-item>
        </div>
        <!-- 结果 -->
        <div class="limit-item result-con" v-show="ruleLimit.length > 0">
          <p>{{lang.mf_result}}：</p>
          <div class="check-box">
            <t-checkbox-group v-model="resultLimit">
              <t-checkbox :key="item.type" :value="item.type" :label="item.name" v-for="item in calcResultCheckbox"
                :disabled="disabeldCheck('result',item.type)">
              </t-checkbox>
            </t-checkbox-group>
          </div>
          <!-- 型号 -->
          <t-form-item :label="lang.mf_model" class="required limit-bw" v-if="showLimitItem('result','model_config')">
            <div class="result-item" v-for="(item,index) in limitForm.result.model_config" :key="index">
              <t-select v-model="limitForm.result.model_config[index].opt" class="short"
                :disabled="limitForm.result.model_config.length > 1">
                <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
                <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
              </t-select>
              <t-form-item :name="`result.model_config[${index}].id`">
                <t-select v-model="limitForm.result.model_config[index].id" :placeholder="lang.select+lang.mf_model"
                  multiple :min-collapsed-num="1">
                  <t-option :key="area.id" :value="area.id" :label="area.name" v-for="area in modelList">
                  </t-option>
                </t-select>
              </t-form-item>
              <t-icon name="minus-circle" class="sub" @click="subResult('model_config', index)"></t-icon>
              <t-icon name="add-circle" @click="addResult('model_config')"
                v-show="index === limitForm.result.model_config.length - 1"></t-icon>
            </div>
            <t-icon name="add-circle" @click="addResult('model_config')"
              v-show="limitForm.result.model_config.length === 0"></t-icon>
          </t-form-item>
          <t-form-item :label="`${lang.bw}（M）`" class="required limit-bw" v-if="showLimitItem('result','bw')">
            <div class="result-item" v-for="(item,index) in limitForm.result.bw" :key="index">
              <t-select v-model="limitForm.result.bw[index].opt" class="short"
                :disabled="limitForm.result.bw.length > 1">
                <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
                <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
              </t-select>
              <t-form-item lable="" :name="`result.bw[${index}].min`" :required-mark="false"
                :rules="calcReg(lang.bw,0,99999999)">
                <t-input-number v-model="limitForm.result.bw[index].min" :placeholder="lang.min_value" theme="normal"
                  :decimal-places="0" @blur="changeLimitRange($event,'bw','min','result',index)"></t-input-number>
              </t-form-item>
              <t-form-item lable="" :name="`result.bw[${index}].max`" :required-mark="false"
                :rules="[ limitForm.rule.bw.max === '' ? {} : calcReg(lang.bw, 0, 99999999) ]">
                <t-input-number v-model="limitForm.result.bw[index].max" :placeholder="lang.max_value_tip"
                  theme="normal" :decimal-places="0" @blur="changeLimitRange($event,'bw','max','result',index)">
                </t-input-number>
              </t-form-item>
              <t-icon name="minus-circle" class="sub" @click="subResult('bw', index)"></t-icon>
              <t-icon name="add-circle" @click="addResult('bw')"
                v-show="index === limitForm.result.bw.length - 1"></t-icon>
            </div>
            <t-icon name="add-circle" @click="addResult('bw')" v-show="limitForm.result.bw.length === 0"></t-icon>
          </t-form-item>
          <t-form-item :label="`${lang.cloud_flow}（G）`" class="required limit-bw" v-if="showLimitItem('result','flow')">
            <div class="result-item" v-for="(item,index) in limitForm.result.flow" :key="index">
              <t-select v-model="limitForm.result.flow[index].opt" class="short"
                :disabled="limitForm.result.flow.length > 1">
                <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
                <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
              </t-select>
              <t-form-item lable="" :name="`result.flow[${index}].min`" :required-mark="false"
                :rules="calcReg(lang.cloud_flow,0,99999999)">
                <t-input-number v-model="limitForm.result.flow[index].min" :placeholder="lang.min_value" theme="normal"
                  :decimal-places="0" @blur="changeLimitRange($event,'flow','min','result',index)"></t-input-number>
              </t-form-item>
              <t-form-item lable="" :name="`result.flow[${index}].max`" :required-mark="false"
                :rules="[ limitForm.rule.flow.max === '' ? {} : calcReg(lang.cloud_flow, 0, 99999999) ]">
                <t-input-number v-model="limitForm.result.flow[index].max" :placeholder="lang.max_value_tip"
                  theme="normal" :decimal-places="0" @blur="changeLimitRange($event,'flow','max','result',index)">
                </t-input-number>
              </t-form-item>
              <t-icon name="minus-circle" class="sub" @click="subResult('flow', index)"></t-icon>
              <t-icon name="add-circle" @click="addResult('flow')"
                v-show="index === limitForm.result.flow.length - 1"></t-icon>
            </div>
            <t-icon name="add-circle" @click="addResult('flow')" v-show="limitForm.result.flow.length === 0"></t-icon>
          </t-form-item>
          <t-form-item :label="lang.opt_system" class="required limit-bw" v-if="showLimitItem('result','image')">
            <div class="result-item" v-for="(item,index) in limitForm.result.image" :key="index">
              <t-select v-model="limitForm.result.image[index].opt" class="short"
                :disabled="limitForm.result.image.length > 1">
                <t-option key="eq" value="eq" :label="lang.mf_eq"></t-option>
                <t-option key="neq" value="neq" :label="lang.mf_neq"></t-option>
              </t-select>
              <t-form-item :name="`result.image[${index}].id`">
                <t-cascader :placeholder="lang.select+lang.opt_system" v-model="limitForm.result.image[index].id"
                  :options="calcCascadeImage" multiple clearable :min-collapsed-num="1"
                  :keys="{ label: 'name', value: 'id' }">
                </t-cascader>
              </t-form-item>
              <t-icon name="minus-circle" class="sub" @click="subResult('image', index)"></t-icon>
              <t-icon name="add-circle" @click="addResult('image')"
                v-show="index === limitForm.result.image.length - 1"></t-icon>
            </div>
            <t-icon name="add-circle" @click="addResult('image')" v-show="limitForm.result.image.length === 0"></t-icon>
          </t-form-item>
        </div>
        <div class="com-f-btn">
          <t-button theme="primary" type="submit" :loading="submitLoading"
            :disabled="ruleLimit.length < 1 || resultLimit.length < 1">{{lang.hold}}
          </t-button>
          <t-button theme="default" variant="base" @click="limitModel = false">{{lang.cancel}}</t-button>
        </div>
      </t-form>
    </t-dialog>
    <!-- 删除提示框 -->
    <t-dialog theme="warning" :header="delTit" :visible.sync="delVisible" class="deleteDialog">
      <p class="des" v-if="delType==='cycle'">{{lang.delete_tip}}</p>
      <template slot="footer">
        <t-button theme="primary" @click="sureDelete" :loading="submitLoading">{{lang.sure}}</t-button>
        <t-button theme="default" @click="delVisible=false">{{lang.cancel}}</t-button>
      </template>
    </t-dialog>

    <t-dialog theme="warning" :header="isLocalSystem ? lang.get_system : lang.get_local_system"
      :visible.sync="pullOsVisible" class="deleteDialog">
      <div>
        {{lang.get_local_system_tip1}}{{isLocalSystem ? lang.get_local_system_tip3 :
        lang.get_local_system_tip2}},{{lang.get_local_system_tip4}}{{isLocalSystem
        ? lang.get_local_system_tip2 :
        lang.get_local_system_tip3}}{{lang.get_local_system_tip5}}<span
          style="color: var(--td-error-color);">{{lang.get_local_system_tip6}}</span>{{lang.get_local_system_tip7}}
        <span style="color: var(--td-error-color);">{{isLocalSystem ? lang.get_local_system_tip9 :
          lang.get_local_system_tip8}}</span>
      </div>
      <template slot="footer">
        <t-button theme="primary" @click="surePullOs" :loading="pullOsLoading">{{lang.sure}}</t-button>
        <t-button theme="default" @click="pullOsVisible=false">{{lang.cancel}}</t-button>
      </template>
    </t-dialog>
  </com-config>
</div>

<script src="/plugins/server/mf_dcim/template/admin/lang/index.js"></script>
<script src="/plugins/server/mf_dcim/template/admin/api/mf_dcim.js"></script>
<script src="/plugins/server/mf_dcim/template/admin/js/mf_dcim.js"></script>
