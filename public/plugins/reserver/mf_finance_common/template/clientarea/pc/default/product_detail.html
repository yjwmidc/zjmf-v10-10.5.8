<!-- 统计图表 -->
<!-- 页面独有样式 -->
<link rel="stylesheet" href="/plugins/reserver/mf_finance_common/template/clientarea/pc/default/css/cloudTop.css">
<link rel="stylesheet" href="/plugins/reserver/mf_finance_common/template/clientarea/pc/default/css/cloudDetail.css">

<!-- 自己的东西 -->
<div class="template" id="product_detail_cloud">
  <div id="mainLoading" class="pro-des" v-if="initLoading">
    <div class="ddr ddr1"></div>
    <div class="ddr ddr2"></div>
    <div class="ddr ddr3"></div>
    <div class="ddr ddr4"></div>
    <div class="ddr ddr5"></div>
  </div>
  <!-- 自己的东西 -->
  <div class="main-card">
    <div class="card-top">
      <div class="top-operation">
        <div class="operation-row1">
          <img @click="goBack" class="back-img"
            src="/plugins/reserver/mf_finance_dcim/template/clientarea/pc/default/img/finance/back.png" />
          <span class="top-product-name">{{hostData.product_name}}</span>
          <host-status :id="id" :status="hostData.status">
            <div class="host-status" :class="hostData.status">{{hostData.status_name}}</div>
          </host-status>
          <span class="up-authorization" @click="handelUpLicense" v-loading="upgradeLoading"
            v-if="hostData?.status && hostData.status === 'Active'">{{lang.common_cloud_btn16}}
          </span>
        </div>
        <div class="operation-row2">
          <div class="row2-left">
            <span class="name">{{hostData.name}}</span>
            <span class="ip">{{main_ip}}</span>
          </div>
          <div class="row2-right" v-show="hostData.status == 'Active' && !initLoading">
            <!-- 停用-->
            {foreach $addons as $addon}
            {if ($addon.name=='IdcsmartRefund')}
            <span class="refund" v-if="cloudData.host_data && cloudData.host_data.cancel_control">
              <span class="refund-status"
                v-if="refundData && refundData.status != 'Cancelled' && refundData.status != 'Reject'">{{refundStatus[refundData.status]}}</span>
              <span class="refund-stop-btn"
                v-if="refundData && (refundData.status=='Pending' || refundData.status=='Suspend' || refundData.status=='Suspending')"
                @click="quitRefund">{{lang.common_cloud_btn8}}</span>
              <span class="refund-btn" @click="showRefund"
                v-if="!refundData || (refundData && (refundData.status=='Reject')) || (refundData && (refundData.status=='Cancelled'))">{{lang.common_cloud_btn9}}</span>
            </span>
            {/if}
            {/foreach}
            <!-- 开关机 -->
            <span class="on-off">
              <img
                :src="'/plugins/reserver/mf_finance_common/template/clientarea/pc/default/img/cloudDetail/'+status+'.png'"
                :title="statusText" v-show="(status != 'operating') && (status != 'fault') && (status != 'pending')"
                slot="reference">
              <i class="el-icon-loading" :title="lang.common_cloud_text12"
                v-show="status == 'operating' || status == 'pending'"></i>
              <img
                :src="'/plugins/reserver/mf_finance_common/template/clientarea/pc/default/img/cloudDetail/'+status+'.png'"
                :title="statusText" v-show="status == 'fault'">
            </span>

          </div>
        </div>
        <div class="operation-row3" v-show="hostData.status == 'Active'">
          <!-- 有备注 -->
          <span class="yes-notes" v-if="hostData.notes" @click="doEditNotes">
            <i class="el-icon-edit notes-icon"></i>
            <span class="notes-text">{{hostData.notes}}</span>
          </span>
          <!-- 无备注 -->
          <span class="no-notes" v-else @click="doEditNotes">
            {{lang.cloud_add_notes + ' +'}}
          </span>

        </div>
      </div>
      {foreach $addons as $addon}
      {if ($addon.name=='IdcsmartRefund')}
      <div class="refund-msg">
        <!-- 停用成功 -->
        <div class="refund-success" v-if="refundData && refundData.status == 'Suspending'">
          ({{lang.common_cloud_tip6}}{{refundData.create_time |
          formateTime}}{{lang.common_cloud_tip7}}{{refundData.type=='Expire'?lang.common_cloud_tip8:lang.common_cloud_tip9}}，{{lang.common_cloud_tip13}}<span
            v-if="refundData.type=='Expire'">{{hostData.due_time | formateTime}}</span>{{refundData.type=='Expire'?
          lang.common_cloud_tip10:lang.common_cloud_tip11}} {{lang.common_cloud_tip12}})
        </div>
        <!-- 停用失败 -->
        <div class="refund-fail" v-if="refundData && refundData.status == 'Reject'">
          ({{lang.common_cloud_tip6}}{{refundData.create_time | formateTime}}{{lang.common_cloud_tip7}}
          {{refundData.type=='Expire'?lang.common_cloud_tip8:lang.common_cloud_tip9}} {{lang.common_cloud_tip14}}，
          <el-popover placement="top-start" trigger="hover">
            <span>{{refundData.reject_reason}}</span>
            <span class="reason-text" slot="reference">{{lang.common_cloud_text15}}</span>
          </el-popover>
          )
        </div>
      </div>
      {/if}
      {/foreach}
      <div class="top-msg">
        <!-- 实例信息 -->
        <div class="msg-l">
          <div class="l-t">
            <div class="l-t-l">
              <span class="l-t-l-text">{{lang.appstore_text301}}</span>
            </div>
          </div>
          <div class="l-b">
            <div class="row" v-for="(item,index) in configDetails" :key="index">
              <div class="label">{{item.name}}：</div>
              <div class="value">
                <p @mouseenter="e=>checkWidth(e,index)" @mouseout="hideTip(index)" v-if="!item.show" class="over-text">
                  {{item.sub_name}}
                </p>
                <el-tooltip class="item" effect="dark" :content="item.sub_name" placement="top" v-else>
                  <p class="over-text">{{item.sub_name}}</p>
                </el-tooltip>
              </div>
            </div>
            <!-- 附加信息 -->
            <template v-if="cloudData.host_data">
              <div class="row">
                <div class="label">{{lang.common_cloud_label14}}：</div>
                <div class="value" :title="cloudData.host_data.username">{{cloudData.host_data.username}}</div>
              </div>
              <div class="row">
                <div class="label">{{lang.common_cloud_label13}}：</div>
                <div class="value">{{cloudData.host_data.port}}</div>
              </div>
              <div class="row">
                <div class="label">{{lang.login_pass}}：</div>
                <div class="value">
                  <span v-show="isShowPass"> {{cloudData.host_data.password}} </span>
                  <span v-show="!isShowPass"> {{calcPassword(cloudData.host_data.password)}} </span>
                </div>
                <img class="eyes"
                  :src="isShowPass?'/plugins/reserver/mf_finance_common/template/clientarea/pc/default/img/cloud/pass-show.png':'/plugins/reserver/mf_finance_common/template/clientarea/pc/default/img/cloud/pass-hide.png'"
                  @click="isShowPass=!isShowPass" />
                <i class="el-icon-document-copy"
                  style="font-size: 14px; margin-left: 3px; cursor: pointer; color: #0052D9;"
                  @click="copyPass(cloudData.host_data.password)"></i>
              </div>
            </template>
            <div class="row" v-for="(item,index) in self_defined_field" :key="item.id">
              <div class="label">{{item.field_name}}:</div>
              <div class="value">
                <span v-if="item.field_type === 'password'">
                  <span v-if="!item.hidenPass && item.value">{{item.value.replace(/./g, '*')}}</span>
                  <span v-else>{{item.value || '--'}}</span>
                </span>
                <span v-else-if="item.field_type === 'textarea'" class="word-pre">{{item.value || '--'}}</span>
                <span v-else>{{item.value || '--'}}</span>
              </div>
              <img class="eyes" v-if="item.field_type === 'password' && item.value"
                :src="item.hidenPass ? '/plugins/reserver/mf_finance_common/template/clientarea/pc/default/img/cloud/pass-show.png' : '/plugins/reserver/mf_finance_common/template/clientarea/pc/default/img/cloud/pass-hide.png'"
                @click="item.hidenPass=! item.hidenPass" />
              <i class="el-icon-document-copy"
                v-if="(item.field_type === 'password' || item.field_type === 'link') && item.value"
                style="font-size: 14px; margin-left: 3px; cursor: pointer; color: #0052D9;"
                @click="copyPass(item.value)"></i>
            </div>
          </div>
        </div>
        <!-- 付款信息 -->
        <div class="msg-r">
          <div class="r-t">
            <div class="r-t-l">
              <span class="r-t-l-text">{{lang.cloud_pay_title}}</span>
            </div>
            <!-- 续费 -->
            {foreach $addons as $addon}
            {if ($addon.name=='IdcsmartRenew')}
            <div class="r-t-r"
              v-show="hostData.billing_cycle !== 'onetime' && hostData.billing_cycle !== 'free' && hostData.status == 'Active'">
              <span>{{lang.common_cloud_text16}}：</span>
              <!-- <el-switch v-model="isShowPayMsg" active-color="#0052D9" @change="autoRenewChange">
              </el-switch> -->
              <auto-renew v-if="hasAutoRenew" :id="id" :is-auto-renew="isShowPayMsg" @update="getRenewStatus">
              </auto-renew>
              <el-popover placement="top" trigger="hover">
                <div class="sure-remind">
                  {{lang.common_cloud_tip15}}
                </div>
                <div class="help" slot="reference">?</div>
              </el-popover>
            </div>
            {/if}
            {/foreach}
          </div>
          <div class="r-b">
            <div class="row">
              <div class="row-l">
                <div class="label">{{lang.cloud_due_time}}:</div>
                <div class="value" :class="isRead?'red':''">{{hostData.due_time | formateTime}}</div>
              </div>
              <div class="row-r">
                <div class="label">{{lang.cloud_creat_time}}:</div>
                <div class="value">{{hostData.active_time | formateTime}}</div>
              </div>
            </div>
            <div class="row">
              <div class="row-l">
                <div class="label">{{lang.cloud_pay_style}}:</div>
                <div class="value">{{hostData.billing_cycle_name}}</div>
              </div>
              <div class="row-r">
                <div class="label">{{lang.cloud_first_pay}}:</div>
                <div class="value">{{commonData.currency_prefix + hostData.first_payment_amount +
                  commonData.currency_suffix}}</div>
              </div>
            </div>
            <div class="row">
              <div class="row-l">
                <div class="label">{{lang.cloud_re_text}}:</div>
                <div class="value">{{commonData.currency_prefix + hostData.renew_amount + commonData.currency_suffix}}
                </div>
                {foreach $addons as $addon}
                {if ($addon.name=='IdcsmartRenew')}
                <span v-show="hostData.status == 'Active' || hostData.status == 'Suspended'" v-loading="renewBtnLoading"
                  class="renew-btn" @click="showRenew" v-if="(!refundData || refundData || (refundData && refundData.status=='Cancelled') || (refundData && refundData.status=='Reject')) &&
                  (hostData.billing_cycle !== 'onetime' && hostData.billing_cycle !== 'free')">
                  {{lang.cloud_re_btn}}
                </span>
                <span v-show="hostData.status == 'Active'" class="renew-btn-disable" v-else>{{lang.cloud_re_btn}}</span>
                {/if}
                {/foreach}
              </div>
              <div class="row-r">
                <div class="label">{{lang.cloud_code}}:</div>
                <div class="value" :title="codeString">{{codeString?codeString:'--'}}</div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <el-tabs class="tabs" v-model="activeName" @tab-click="handleClick"
        v-show="hostData.status == 'Active' && !initLoading">
        <!-- 统计图表 -->
        <template v-if="chartData.length > 0">
          <el-tab-pane :label="lang.common_cloud_tab1" name="1">
            <el-select class="time-select" v-model="chartSelectValue" @change="chartSelectChange">
              <el-option value='1' :label="lang.common_cloud_tab12"></el-option>
              <el-option value='2' :label="lang.common_cloud_tab13"></el-option>
              <el-option value='3' :label="lang.common_cloud_tab14"></el-option>
            </el-select>
            <div class="echart-main">
              <div class="echart-item" v-for="(item,index) in chartData" :key="index" v-loading="item.loading">
                <el-select v-if="item.select.length > 0" v-model="item.selectValue" @change="getChartList">
                  <el-option v-for="items in item.select" :key="items.value" :value="items.value"
                    :label="items.name"></el-option>
                </el-select>
                <div :id="`${index}-echart`" class="my-echart"></div>
              </div>
            </div>
          </el-tab-pane>
        </template>
        <template v-if="powerList.length > 0">
          <el-tab-pane :label="lang.common_cloud_tab2" name="2">
            <!-- 管理 -->
            <div class="manage-content">
              <div class="manage-item">
                <div class="item-top">
                  <el-select v-model="powerStatus">
                    <el-option v-for="item in powerList" :key="item.func" :value="item.func"
                      :label="item.name"></el-option>
                  </el-select>
                  <div class="item-top-btn" @click="showPowerDialog">
                    {{lang.common_cloud_btn10}}
                  </div>
                </div>
                <div class="item-bottom">
                  <div class="bottom-row">{{lang.common_cloud_tip16}}</div>
                </div>
              </div>
              <div class="manage-item" v-for="item in consoleList" :key="item.func">
                <div class="item-top-btn" @click="handelConsole(item)">
                  {{item.name}}
                </div>
                <div class="item-bottom">
                  <template v-if="item.func === 'crack_pass'">
                    <div class="bottom-row">{{lang.common_cloud_tip19}}</div>
                    <div class="bottom-row">{{lang.common_cloud_tip20}}</div>
                  </template>
                  <template v-if="item.func === 'reinstall'">
                    <div class="bottom-row">{{lang.common_cloud_tip23}}</div>
                  </template>
                  <template v-if="item.func === 'vnc'">
                    <div class="bottom-row">{{lang.common_cloud_tip17}}</div>
                    <div class="bottom-row">{{lang.common_cloud_tip18}}</div>
                  </template>
                </div>
              </div>

            </div>
          </el-tab-pane>
        </template>
        <el-tab-pane v-for="(item,index) in client_area" :label="item.name" :name="index + 3 + ''"
          :key="index + item.name">
          <div :id="`arae-${index + 3 + ''}`" :key="index + item.name"></div>
        </el-tab-pane>
        <!-- 日志 -->
        <el-tab-pane :label="lang.common_cloud_tab6" name="log">
          <div class="log">
            <div class="main_table">
              <el-table v-loading="logLoading" :data="logDataList" style="width: 100%; margin-bottom: 0.2rem">
                <el-table-column prop="id" :label="lang.common_cloud_label32" width="400" align="left">
                </el-table-column>
                <el-table-column prop="create_time" width="400" :label="lang.common_cloud_label33" align="left">
                  <template slot-scope="scope">
                    <span>{{scope.row.create_time | formateTime}}</span>
                  </template>
                </el-table-column>
                <el-table-column prop="description" :label="lang.common_cloud_label34" min-width="400" align="left"
                  :show-overflow-tooltip="true">
                </el-table-column>
              </el-table>
              <pagination :page-data="logParams" v-if="logParams.total" @sizechange="logSizeChange"
                @currentchange="logCurrentChange">
              </pagination>
            </div>
          </div>
        </el-tab-pane>
      </el-tabs>


      <!-- 修改备注弹窗 -->
      <div class="notes-dialog">
        <el-dialog width="6.2rem" :visible.sync="isShowNotesDialog" :show-close=false @close="notesDgClose">
          <div class="dialog-title">
            {{hostData.notes?lang.common_cloud_title7:lang.common_cloud_title8}}
          </div>
          <div class="dialog-main">
            <div class="label">{{lang.common_cloud_label29}}</div>
            <el-input class="notes-input" v-model="notesValue"></el-input>
          </div>
          <div class="dialog-footer">
            <div class="btn-ok" @click="subNotes">{{lang.common_cloud_btn28}}</div>
            <div class="btn-no" @click="notesDgClose">{{lang.common_cloud_btn29}}</div>
          </div>
        </el-dialog>
      </div>


      <!-- 重装系统弹窗 -->
      <div class="reinstall-dialog">
        <el-dialog width="6.2rem" :visible.sync="isShowReinstallDialog" :show-close=false @close="reinstallDgClose">
          <div class="dialog-title">
            {{lang.common_cloud_title9}}
          </div>
          <div class="dialog-main">
            <div class="label">{{lang.common_cloud_label6}}</div>
            <div class="os-content">
              <!-- 镜像组选择框 -->
              <el-select class="os-select os-group-select" v-model="reinstallData.osGroupId"
                @change="osSelectGroupChange">
                <img class="os-group-img" :src="osIcon" slot="prefix" alt="">
                <el-option v-for="item in osData.subs" :key='item.os' :value="item.os" :label="item.os">
                  <div class="option-label">
                    <img class="option-img"
                      :src="'/plugins/reserver/mf_finance_common/template/clientarea/pc/default/img/remf_finance_common/' + item.os + '.svg'"
                      alt="">
                    <span class="option-text">{{item.os}}</span>
                  </div>
                </el-option>
              </el-select>
              <!-- 镜像实际选择框 -->
              <el-select class="os-select" v-model="reinstallData.osId" @change="osSelectChange">
                <el-option v-for="item in osSelectData" :key="item.id" :value="item.id"
                  :label="item.option_name"></el-option>
              </el-select>
            </div>
            <div class="alert">
              <el-alert :title="errText" type="error" show-icon :closable="false" v-show="errText">
              </el-alert>
            </div>
          </div>
          <div class="dialog-footer">
            <div class="btn-ok" @click="doReinstall" v-loading="reinstallLoading">{{lang.common_cloud_btn28}}</div>
            <div class="btn-no" @click="reinstallDgClose">{{lang.common_cloud_btn29}}</div>
          </div>
        </el-dialog>
      </div>


      <!-- 续费弹窗 -->
      <div class="renew-dialog">
        <el-dialog width="6.9rem" :visible.sync="isShowRenew" :show-close=false @close="renewDgClose">
          <div class="dialog-title">
            {{lang.common_cloud_title10}}
          </div>
          <div class="dialog-main">
            <div class="renew-content">
              <div class="renew-item" :class="renewActiveId===index?'renew-active':''"
                v-for="(item,index) in renewPageData" :key="index" @click="renewItemChange(item,index)">
                <div class="item-top">{{item.customfield?.multi_language?.billing_cycle || item.billing_cycle}}</div>
                <div class="item-bottom" v-if="isShowPromo && renewParams.isUseDiscountCode">
                  {{commonData.currency_prefix + item.base_price}}
                </div>
                <div class="item-bottom" v-else>{{commonData.currency_prefix + item.price}}</div>
                <div class="item-origin-price"
                  v-if="item.price*1 < item.base_price*1 && !renewParams.isUseDiscountCode">
                  {{commonData.currency_prefix + item.base_price}}
                </div>
                <i class="el-icon-check check" v-show="renewActiveId===index"></i>
              </div>
            </div>
            <div class="pay-content">
              <div class="pay-price">
                <div class="money" v-loading="renewLoading">
                  <span class="text">{{lang.common_cloud_label11}}:</span>
                  <span>{{commonData.currency_prefix}}{{renewParams.totalPrice | filterMoney}}</span>
                  <el-popover placement="top-start" width="200" trigger="hover"
                    v-if="(isShowLevel && renewParams.clDiscount*1 > 0) || (isShowPromo && renewParams.isUseDiscountCode) || ( isShowCash && renewParams.customfield.voucher_get_id)">
                    <div class="show-config-list">
                      <p v-if="isShowLevel && renewParams.clDiscount*1 > 0">
                        {{lang.shoppingCar_tip_text2}}：{{commonData.currency_prefix}} {{ renewParams.clDiscount |
                        filterMoney}}
                      </p>
                      <p v-if="isShowPromo && renewParams.isUseDiscountCode">
                        {{lang.shoppingCar_tip_text4}}：{{commonData.currency_prefix}} {{ renewParams.code_discount |
                        filterMoney }}
                      </p>
                      <p v-if="isShowCash && renewParams.customfield.voucher_get_id">
                        {{lang.shoppingCar_tip_text5}}：{{commonData.currency_prefix}}
                        {{ renewParams.cash_discount | filterMoney}}
                      </p>
                    </div>
                    <i class="el-icon-warning-outline total-icon" slot="reference"></i>
                  </el-popover>
                  <p class="original-price"
                    v-if="renewParams.customfield.promo_code && renewParams.totalPrice != renewParams.base_price">
                    {{commonData.currency_prefix}} {{ renewParams.base_price | filterMoney}}
                  </p>
                  <p class="original-price"
                    v-if="!renewParams.customfield.promo_code && renewParams.totalPrice != renewParams.original_price">
                    {{commonData.currency_prefix}} {{ renewParams.original_price | filterMoney}}
                  </p>
                  <div class="code-box">
                    <!-- 代金券 -->
                    <cash-coupon ref="cashRef" v-show="isShowCash && !cashObj.code"
                      :currency_prefix="commonData.currency_prefix" @use-cash="reUseCash" scene='renew'
                      :product_id="[product_id]" :price="renewParams.original_price"></cash-coupon>
                    <!-- 优惠码 -->
                    <discount-code v-show="isShowPromo && !renewParams.customfield.promo_code"
                      @get-discount="getRenewDiscount(arguments)" scene='renew' :product_id="product_id"
                      :amount="renewParams.base_price" :billing_cycle_time="renewParams.duration"></discount-code>
                  </div>
                  <div class="code-number-text">
                    <div class="discount-codeNumber" v-show="renewParams.customfield.promo_code">{{
                      renewParams.customfield.promo_code }}<i class="el-icon-circle-close remove-discountCode"
                        @click="removeRenewDiscountCode()"></i></div>
                    <div class="cash-codeNumber" v-show="cashObj.code">{{ cashObj.code }}<i
                        class="el-icon-circle-close remove-discountCode" @click="reRemoveCashCode()"></i></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="dialog-footer">
            <div class="btn-ok" @click="subRenew">{{lang.common_cloud_btn30}}</div>
            <div class="btn-no" @click="renewDgClose">{{lang.common_cloud_btn29}}</div>
          </div>
        </el-dialog>
      </div>


      <!-- 停用弹窗（删除实例） -->
      <div class="refund-dialog">
        <el-dialog width="6.8rem" :visible.sync="isShowRefund" :show-close=false @close="refundDgClose">
          <div class="dialog-title">
            {{refundPageData.allow_refund == 1?lang.common_cloud_title11:lang.common_cloud_title12}}
          </div>
          <div class="dialog-main">
            <div class="label">{{lang.common_cloud_label35}}</div>
            <div class="host-content">
              <div class="host-item" v-for="(item, index) in refundPageData.configs" :key="index">
                <div class="left">{{item.name}}:</div>
                <div class="right">
                  <div class="right-row">
                    <div class="right-row-item">{{item.value}}</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="label">{{lang.common_cloud_label39}}</div>
            <el-select v-if="refundPageData.reason_custom == 0" v-model="refundParams.suspend_reason" multiple>
              <el-option v-for="item in refundPageData.reasons" :key="item.id" :value="item.id"
                :label="item.content"></el-option>
            </el-select>
            <el-input v-else v-model="refundParams.suspend_reason"></el-input>
            <div class="label">{{lang.common_cloud_label40}}</div>
            <el-select v-model="refundParams.type">
              <el-option value="Expire" :label="lang.common_cloud_label41"></el-option>
              <el-option value="Immediate" :label="lang.common_cloud_label42"></el-option>
            </el-select>
            <div class="label" v-if="refundPageData.allow_refund == 1">{{lang.common_cloud_label43}}</div>
            <div class="amount-content" v-if="refundPageData.allow_refund == 1">
              {{commonData.currency_prefix}}{{refundParams.type=='Immediate'?refundPageData.host.amount:'0.00'}}
            </div>
          </div>
          <div class="dialog-footer">
            <span class="refund-tip" v-show="refundPageData.allow_refund === 0">{{lang.refund_tip}}</span>
            <div class="btn-ok" @click="subRefund">{{refundPageData.allow_refund == 1? lang.common_cloud_btn31:
              lang.common_cloud_btn32}}</div>
            <div class="btn-no" @click="refundDgClose">{{lang.common_cloud_btn29}}</div>
          </div>
        </el-dialog>
      </div>


      <!-- 重置密码弹窗 -->
      <div class="repass-dialog">
        <el-dialog width="6.8rem" :visible.sync="isShowRePass" :show-close=false @close="rePassDgClose">
          <div class="dialog-title">
            {{lang.common_cloud_title13}}
            <span class="second-title">{{lang.common_cloud_text23}}</span>
          </div>
          <div class="dialog-main">
            <div class="label">
              {{lang.common_cloud_label7}}
              <el-popover placement="top-start" width="200" trigger="hover" :content="lang.common_cloud_tip33">
                <i class="el-icon-question" slot="reference"></i>
              </el-popover>

            </div>
            <el-input class="pass-input" v-model="rePassData.password" :placeholder="lang.ticket_label12">
              <div class="pass-btn" slot="suffix" @click="autoPass">{{lang.common_cloud_btn1}}</div>
            </el-input>


            <div class="alert-err-text">
              <el-alert :title="errText" type="error" show-icon :closable="false" v-show="errText">
              </el-alert>
            </div>
          </div>
          <div class="dialog-footer">
            <div class="btn-ok" @click="rePassSub" v-loading="loading5">{{lang.common_cloud_btn28}}</div>
            <div class="btn-no" @click="rePassDgClose">{{lang.common_cloud_btn29}}</div>
          </div>
        </el-dialog>
      </div>


      <!-- 升降级弹窗 -->
      <div class="upgrade-dialog">
        <el-dialog class="up-License" :visible.sync="upLicenseDialogShow" width="12rem" class="up-License"
          :show-close="false" :close-on-click-modal="false">
          <div class="license-title">{{lang.common_cloud_btn16}}</div>
          <div class="license-box">
            <el-tabs v-model="licenseActive" @tab-click="handleTabClick">
              <el-tab-pane label="产品升降级" name="1" v-if="isShowProUpdate">
                <div class="lincense-div">
                  <!-- 升级列表 -->
                  <div class="can-upLincense">
                    <div class="lincense-text">{{lang.common_cloud_text230}}</div>
                    <div class="canUp-box">
                      <div class="canUp-content">
                        <div class="canUp-name" v-for="(item,index) in upgradeList" :key="index"
                          @click="selectUpItem(index)" :class="selectUpIndex === index ? 'select-content' : ''">
                          {{item.host}}
                        </div>
                      </div>
                      <div class="config-box">
                        <div class="l-config">
                          <!-- 周期 -->
                          <div class="config-item">
                            <div class="cycle">
                              <div class="item" v-for="(item,index) in upgradeList[selectUpIndex]?.cycle" :key="index"
                                @click="changeCycle(item,index)" :class="{'com-active': index === curCycle }">
                                <p class="name">{{item?.billingcycle_zh}}</p>
                                <p class="price">
                                  {{commonData.currency_prefix}}{{(item.price * 1).toFixed(2) | filterMoney}}
                                </p>
                                <i class="el-icon-check"></i>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </el-tab-pane>
              <el-tab-pane :label="lang.common_cloud_text231" name="2" v-if="isShowOptionUpdate">
                <div class="lincense-div">
                  <div class="now-lincense">
                    <div class="lincense-text">{{lang.common_cloud_text229}}</div>
                    <div class="lincense-content">
                      <div class="content-title">{{hostData.product_name}}</div>
                      <div class="content-box">
                        <div class="content-item" v-for="(item,index) in upgradeList" :key="index + 'upgradeConfig'">
                          <span class="l-name">{{item.option_name}}</span>
                          <span class="r-value">{{calcValue(item)}}{{item.unit}}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- 升级列表 -->
                  <div class="can-upLincense">
                    <div class="lincense-text">{{lang.common_cloud_text232}}</div>
                    <div class="canUp-box">
                      <div class="canUp-content">
                        <div class="canUp-name select-content">{{lang.common_cloud_text233}}</div>
                      </div>
                      <div class="config-box">
                        <div class="l-config">
                          <!-- <div class="description" v-html="calStr" v-if="calStr"></div> -->
                          <!-- 自定义配置项 -->
                          <div class="config-item" v-for="(item,index) in configoptions" :key="index">
                            <p class="config-tit">{{item.option_name}}</p>
                            <!-- 配置项 -->
                            <div class="config-way">
                              <!-- 下拉单选 -->
                              <el-select v-model="configForm[item.id]" :placeholder="lang.please_select"
                                v-if="item.option_type === 1" collapse-tags @change="changeItem(item)">
                                <el-option v-for="el in item.sub" :key="el.id" :label="el.option_name" :value="el.id"
                                  :disabled="calcDisable(el,item)">
                                </el-option>
                              </el-select>
                              <!-- 是否 -->
                              <el-switch v-model="configForm[item.id]" v-if="item.option_type === 3"
                                active-color="#0052D9" :active-value="1" :inactive-value="0"
                                @change="changeConfig(false)">
                              </el-switch>
                              <!-- 数量拖动 -->
                              <div class="slider" v-if="item.option_type === 4 || item.option_type === 7 || item.option_type === 9 || item.option_type === 11 ||
                                   item.option_type === 14 || item.option_type === 15 || item.option_type === 16 || item.option_type === 17
                                   || item.option_type === 18 || item.option_type === 19">
                                <span class="min">{{calcMin(item)}}</span>
                                <el-slider v-model="configForm[item.id]" @change="changeConfig(false)"
                                  :min="calcMin(item)" :max="item.qty_maximum">
                                </el-slider>
                                <span class="max">{{item.qty_maximum}}</span>
                                <el-input-number v-model="configForm[item.id]" :min="calcMin(item)"
                                  :max="item.qty_maximum" :controls="false" @change="changeConfig(false)">
                                </el-input-number>
                              </div>
                              <!-- 点击单选 -->
                              <div class="click-select"
                                v-if="item.option_type === 2 || item.option_type === 6 || item.option_type === 8 || item.option_type === 10 || item.option_type === 13">
                                <div class="item" v-for="el in item.sub" :key="el.id"
                                  :class="{'com-active': el.id === configForm[item.id]}"
                                  @click="changeClick(item.id, el)">
                                  {{el.option_name}}
                                  <i class="el-icon-check"></i>
                                </div>
                              </div>
                              <!-- 双下拉 操作系统-->
                              <div class="op-sysyem" v-if="item.option_type === 5">
                                <el-select v-model="curSystem" :placeholder="lang.please_select" collapse-tags
                                  class="system" @change="changeSystem(item)">
                                  <template slot="prefix">
                                    <img
                                      :src="`/plugins/reserver/mf_finance/template/clientarea/pc/default/img/remf_finance/${curSystem}.svg`"
                                      alt="" />
                                  </template>
                                  <el-option v-for="item in systemArr" :key="item.value" :label="item.label"
                                    :value="item.value">
                                    <img
                                      :src="`/plugins/reserver/mf_finance/template/clientarea/pc/default/img/remf_finance/${item.value}.svg`"
                                      alt="" class="system-icon" />
                                    {{item.label}}
                                  </el-option>
                                </el-select>
                                <el-select v-model="configForm[item.id]" :placeholder="lang.please_select" collapse-tags
                                  @change="changeConfig(false)">
                                  <el-option v-for="item in calcSystem(item)" :key="item.id" :label="item.version"
                                    :value="item.id">
                                  </el-option>
                                </el-select>
                              </div>

                              <!-- 数据中心 -->
                              <div class="click-select area" v-if="item.option_type === 12">
                                <div class="item" v-for="el in item.sub" :key="el.id"
                                  :class="{'com-active': el.area[0].id === configForm[item.id]}"
                                  @click="changeArea(item.id, el)">
                                  <img :src="`/upload/common/country/${el.country_code}.png`" alt="">
                                  {{el.option_name}}
                                  <i class="el-icon-check"></i>
                                </div>
                              </div>
                              <!-- 单选级联 -->
                              <div v-if="item.option_type === 20">
                                <div class="click-select">
                                  <div class="item" v-for="el in item.sub" :key="el.id"
                                    :class="{'com-active': el.id === cascaderObj[item.id]?.id}"
                                    @click="cascaderClick(item.id,el.id, item)">
                                    {{el.option_name}}
                                    <i class="el-icon-check"></i>
                                  </div>
                                </div>
                                <div class="son-box" v-if="item.option_type === 20" :key="cascaderNum">
                                  <div class="config-item" v-for="(son,ind) in item.sonData" :key="son.id">
                                    <p class="config-tit">{{son.option_name}}</p>
                                    <div class="click-select">
                                      <div class="item" v-for="el in son.sub" :key="el.id"
                                        :class="{'com-active': el.id === cascaderObj[item.id]?.son[son.id]}"
                                        @click="cascaderSonClick(item.id, son.id, el,ind)">
                                        {{el.option_name}}
                                        <i class="el-icon-check"></i>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <!-- 后缀单位 -->
                              <!-- <span class="unit">{{calcUnit(item)}}</span> -->
                              <span class="unit">{{item.unit}}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </el-tab-pane>
            </el-tabs>
          </div>

          <div class="dialog-footer">
            <div class="footer-top">
              <div class="money-text">{{lang.common_cloud_btn37}}：</div>
              <div class="money" v-loading="upgradePriceLoading">
                <span class="money-num">{{commonData.currency_prefix }} {{ upParams.totalPrice | filterMoney}}</span>
                <el-popover placement="top-start" width="200" trigger="hover"
                  v-if="isShowLevel || (isShowPromo && upParams.isUseDiscountCode) || isShowCash">
                  <div class="show-config-list">
                    <p v-if="isShowLevel">{{lang.shoppingCar_tip_text2}}：{{commonData.currency_prefix}} {{
                      upParams.clDiscount | filterMoney }}</p>
                    <p v-if="isShowPromo && upParams.isUseDiscountCode">
                      {{lang.shoppingCar_tip_text4}}：{{commonData.currency_prefix}} {{ upParams.code_discount |
                      filterMoney}}
                    </p>
                    <p v-if="isShowCash && upParams.customfield.voucher_get_id">
                      {{lang.shoppingCar_tip_text5}}：{{commonData.currency_prefix}}
                      {{ upParams.cash_discount | filterMoney}}
                    </p>
                  </div>
                  <i class="el-icon-warning-outline total-icon" slot="reference"></i>
                </el-popover>
                <p class="original-price" v-if="upParams.totalPrice != upParams.original_price">
                  {{commonData.currency_prefix}} {{ upParams.original_price | filterMoney}}
                </p>
                <div class="code-box">
                  <!-- 代金券 -->
                  <cash-coupon ref="cashRef" v-show="isShowCash && !cashObj.code"
                    :currency_prefix="commonData.currency_prefix" @use-cash="upUseCash" scene='upgrade'
                    :product_id="[product_id]" :price="upParams.original_price"></cash-coupon>
                  <!-- 优惠码 -->
                  <discount-code v-show="isShowPromo && !upParams.customfield.promo_code  "
                    @get-discount="getUpDiscount(arguments)" scene='upgrade' :product_id="product_id"
                    :amount="upParams.original_price" :billing_cycle_time="hostData.billing_cycle_time"></discount-code>
                </div>
                <div class="code-number-text">
                  <div class="discount-codeNumber" v-show="upParams.customfield.promo_code">{{
                    upParams.customfield.promo_code }}<i class="el-icon-circle-close remove-discountCode"
                      @click="removeUpDiscountCode()"></i></div>
                  <div class="cash-codeNumber" v-show="cashObj.code">{{ cashObj.code }}<i
                      class="el-icon-circle-close remove-discountCode" @click="upRemoveCashCode()"></i></div>
                </div>
              </div>
            </div>
            <div class="footer-bottom">
              <div class="btn-ok" @click="upgradeSub" v-loading="upLoading">{{lang.finance_btn6}}</div>
              <div class="btn-no" @click="upgradeDgClose">{{lang.finance_btn7}}</div>
            </div>
          </div>
          <!-- <div slot="footer" class="dialog-footer">
        <div class="footer-price">
          <div class="lincense-price">升级所需费用：<span class="blue-text" v-loading="upPriceLoading">{{commonData.currency_prefix}} {{upData.totalPrice | filterMoney}}</span></div>
          <div class="footer-btnbox">
            <el-button type="primary" @click="handelUpConfirm" :loading="upBtnLoading">确 定</el-button>
            <el-button @click="upLicenseDialogShow = false">取 消</el-button>
          </div>
        </div>
      </div> -->

        </el-dialog>

      </div>


      <!-- 电源操作确认弹窗 -->
      <div class="power-dialog">
        <el-dialog width="6.2rem" :visible.sync="isShowPowerChange" :show-close=false @close="powerDgClose">
          <div class="dialog-title">
            {{lang.common_cloud_text34}}{{powerTitle}}{{lang.common_cloud_text35}}
          </div>
          <div class="dialog-main">
            <div class="label">{{lang.common_cloud_text36}}</div>
            <div class="value">{{hostData.name}}</div>
          </div>
          <div class="dialog-footer">
            <div class="btn-ok" @click="toChangePower">{{lang.common_cloud_btn28}}</div>
            <div class="btn-no" @click="powerDgClose">{{lang.common_cloud_btn29}}</div>
          </div>
        </el-dialog>
      </div>

      <!-- 自动续费确认弹窗 -->
      <div class="power-dialog">
        <el-dialog width="6.2rem" :visible.sync="isShowAutoRenew" :show-close=false :close-on-click-modal=false>
          <div class="dialog-title">
            {{lang.common_cloud_text37}}{{isShowPayMsg?lang.common_cloud_text38:lang.common_cloud_text39}}{{lang.auto_renew}}
          </div>
          <div class="dialog-main">
            <div class="label">{{lang.common_cloud_text36}}</div>
            <div class="value">{{hostData.name}}</div>
          </div>
          <div class="dialog-footer">
            <div class="btn-ok" @click="doAutoRenew">{{lang.account_btn2}}</div>
            <div class="btn-no" @click="autoRenewDgClose">{{lang.subaccount_text32}}</div>
          </div>
        </el-dialog>
      </div>
      <!-- 安全验证 -->
      <safe-confirm ref="safeRef" :password.sync="client_operate_password" @confirm="hadelSafeConfirm"></safe-confirm>
      <pay-dialog ref="topPayDialog" @payok="paySuccess" @paycancel="payCancel"></pay-dialog>
    </div>
  </div>
</div>
<!-- =======页面独有======= -->
<script src="/plugins/reserver/mf_finance_common/template/clientarea/pc/default/api/cloud.js"></script>
<script src="/plugins/reserver/mf_finance_common/template/clientarea/pc/default/js/echarts.js"></script>
<script src="/plugins/reserver/mf_finance_common/template/clientarea/pc/default/lang/index.js"></script>
<script src="/plugins/reserver/mf_finance_common/template/clientarea/pc/default/js/cloudDetail.js"></script>
